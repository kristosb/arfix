(this.webpackJsonparfix=this.webpackJsonparfix||[]).push([[0],{25:function(e,t,i){},26:function(e,t,i){},32:function(e,t,i){},34:function(e,t,i){"use strict";i.r(t);var n=i(12),o=i.n(n),s=i(18),a=i.n(s),r=(i(25),i(26),i(1)),h=i(2),c=i(6),l=i(5),u=i(0),d=(i(27),i(28),i(9)),f=(i(16),i(19),i(10));var p=function(e,t){var i=new u.Vector3,n=e.x,o=e.y,s=e.z,a=t.x,r=t.y,h=t.z,c=t.w,l=c*n+r*s-h*o,d=c*o+h*n-a*s,f=c*s+a*o-r*n,p=-a*n-r*o-h*s;return i.x=l*c+p*-a+d*-h-f*-r,i.y=d*c+p*-r+f*-a-l*-h,i.z=f*c+p*-h+l*-r-d*-a,i},v=function(e,t,i){i.applyLocalForce(new d.Vec3(e.x,e.y,e.z),new d.Vec3(t.x,t.y,t.z))},g=function(){function e(t,i,n){Object(r.a)(this,e),this.scene=t,i||console.error("chassis mesh error"),n||console.error("controls data error"),this._lift=50,this._roll=0,this._rollLimit=2,this._yaw=0,this._yawLimit=2,this._pitch=0,this._pitchLimit=2,this._velocity=0,this._currentSpeed=0,this._enginePower=0,this._enginePowerLimit=1,this.enginePowerPrev=0,this.speedModifier=.03,this.collision=i,this.rudder=n.rudder,this.rotor=n.rotor,this.leftAileron=n.leftAileron,this.rightAileron=n.rightAileron,this.leftElevator=n.leftElevator,this.rightElevator=n.rightElevator,this._relativeBody=null,this._isTouchingGround=!1,this.addAnimations(),this.animationGroup.play(!1),this.animationGroup.speedRatio=1,this.controlsInitialize(),this.registerForces()}return Object(h.a)(e,[{key:"lift",get:function(){return this._lift},set:function(e){this._lift=e}},{key:"roll",get:function(){return this._roll},set:function(e){e>this._rollLimit&&(e=this._rollLimit),e<-this._rollLimit&&(e=-this._rollLimit),this._roll=e}},{key:"yaw",get:function(){return this._yaw},set:function(e){e>this._yawLimit&&(e=this._yawLimit),e<-this._yawLimit&&(e=-this._yawLimit),this._yaw=e}},{key:"pitch",get:function(){return this._pitch},set:function(e){e>this._pitchLimit&&(e=this._pitchLimit),e<-this._pitchLimit&&(e=-this._pitchLimit),this._pitch=e}},{key:"enginePower",get:function(){return this._enginePower},set:function(e){e>this._enginePowerLimit&&(e=this._enginePowerLimit),e<0&&(e=0),this._enginePower=e}},{key:"velocity",get:function(){return p(new u.Vector3(this.collision.velocity.x,this.collision.velocity.y,this.collision.velocity.z),u.Quaternion.Inverse(new u.Quaternion(this.collision.quaternion.x,this.collision.quaternion.y,this.collision.quaternion.z,this.collision.quaternion.w)))}},{key:"currentSpeed",get:function(){return 0}},{key:"rotation",get:function(){return new u.Quaternion(this.collision.quaternion.x,this.collision.quaternion.y,this.collision.quaternion.z,this.collision.quaternion.w).toEulerAngles()}},{key:"relativeBody",get:function(){return this._relativeBody},set:function(e){this._relativeBody=e}},{key:"isTouchingGround",get:function(){return this._isTouchingGround},set:function(e){this._isTouchingGround=e}},{key:"rotorSpin",value:function(e){e.rotation=new u.Vector3(0,0,Math.PI/2);var t=new u.Animation("wheelAnimation","rotation.z",15,u.Animation.ANIMATIONTYPE_FLOAT,u.Animation.ANIMATIONLOOPMODE_CYCLE);this.animationGroup=new u.AnimationGroup("airplane");var i=[];i.push({frame:0,value:0}),i.push({frame:15,value:-2*Math.PI*1}),t.setKeys(i),e.animations=[],e.animations.push(t),this.animationGroup.addTargetedAnimation(t,e)}},{key:"addAnimations",value:function(){this.rotorSpin(this.rotor)}},{key:"controlsInitialize",value:function(){this.rudderZeroRotation=new u.Quaternion,this.leftAileronZeroRotation=new u.Quaternion,this.rightAileronZeroRotation=new u.Quaternion,this.leftElevatorZeroRotation=new u.Quaternion,this.rightElevatorZeroRotation=new u.Quaternion,this.rudderZeroRotation.copyFrom(this.rudder.rotationQuaternion),this.leftAileronZeroRotation.copyFrom(this.leftAileron.rotationQuaternion),this.rightAileronZeroRotation.copyFrom(this.rightAileron.rotationQuaternion),this.leftElevatorZeroRotation.copyFrom(this.leftElevator.rotationQuaternion),this.rightElevatorZeroRotation.copyFrom(this.rightElevator.rotationQuaternion)}},{key:"meshRootPosition",value:function(e,t,i){this.collision.position.set(e,t,i)}},{key:"rudderControl",value:function(e){this.rudder.rotationQuaternion.copyFrom(this.rudderZeroRotation),this.rudder.rotate(u.Vector3.Up(),e)}},{key:"aileronControl",value:function(e){this.leftAileron.rotationQuaternion.copyFrom(this.leftAileronZeroRotation),this.leftAileron.rotate(u.Vector3.Left(),e),this.rightAileron.rotationQuaternion.copyFrom(this.rightAileronZeroRotation),this.rightAileron.rotate(u.Vector3.Left(),-e)}},{key:"elevatorControl",value:function(e){this.leftElevator.rotationQuaternion.copyFrom(this.leftElevatorZeroRotation),this.leftElevator.rotate(u.Vector3.Left(),e),this.rightElevator.rotationQuaternion.copyFrom(this.rightElevatorZeroRotation),this.rightElevator.rotate(u.Vector3.Left(),e)}},{key:"applyLiftForce",value:function(){var e=this.velocity.z*Math.abs(this.velocity.z)*1.5;v(new u.Vector3(0,e,0),new u.Vector3(0,0,0),this.collision)}},{key:"applyDragForce",value:function(){var e=this.velocity;v(new u.Vector3(e.x*Math.abs(e.x)*-20,e.y*Math.abs(e.y)*-100,e.z*Math.abs(e.z)*-1),new u.Vector3(0,0,-.02),this.collision)}},{key:"applyThrustForce",value:function(){v(new u.Vector3(0,0,3e3*this.speedModifier*this.enginePower),new u.Vector3(0,0,1),this.collision)}},{key:"applyRollForce",value:function(e){e&&(v(new u.Vector3(0,5*e*-this.velocity.z,0),new u.Vector3(1,0,0),this.collision),v(new u.Vector3(0,5*e*this.velocity.z,0),new u.Vector3(-1,0,0),this.collision))}},{key:"applyYawForce",value:function(e){e&&v(new u.Vector3(5*e*this.velocity.z,0,0),new u.Vector3(0,0,-1),this.collision)}},{key:"applyPitchForce",value:function(e){e&&v(new u.Vector3(0,5*e*this.velocity.z,0),new u.Vector3(0,0,-1),this.collision)}},{key:"applyPitchYawForce",value:function(e,t){(e||t)&&v(new u.Vector3(5*t*this.velocity.z,5*e*this.velocity.z,0),new u.Vector3(0,0,-1),this.collision)}},{key:"propellerSpeedUpdate",value:function(){this.enginePowerPrev!==this.enginePower&&(this.enginePower?this.animationGroup.play(!0):this.animationGroup.play(!1),this.animationGroup.speedRatio=4*this.enginePower),this.enginePowerPrev=this.enginePower}},{key:"resetControls",value:function(){this.aileronControl(this.roll*Math.PI/8),this.rudderControl(-this.yaw*Math.PI/8),this.elevatorControl(-this.pitch*Math.PI/8),this.pitch=0,this.yaw=0,this.roll=0}},{key:"registerForces",value:function(){var e=this;this.scene.onBeforeRenderObservable.add((function(){e.applyRollForce(e.roll),e.applyPitchYawForce(e.pitch,e.yaw),e.applyDragForce(),e.applyLiftForce(),e.applyThrustForce(),e.propellerSpeedUpdate(),e.resetControls()}))}}]),e}(),w=i(20),y=i(13),m=i(7);var b=function(e){Object(c.a)(i,e);var t=Object(l.a)(i);function i(e,n,o,s){var a;Object(r.a)(this,i),a=t.call(this,e),n||console.error("airplane modlel mesh error");n[0].translate(new u.Vector3.Up,.15,u.Space.WORLD),n[0].scaling=n[0].scaling.multiplyByFloats(1,1,1);var h=new u.Vector3(0,.2,.65).multiplyByFloats(1,1,1),c={suspensionStiffness:47,suspensionDamping:.3,suspensionCompression:4.4,suspensionRestLength:.3,rollInfluence:.01},l=Object(w.a)({},c);l.suspensionRestLength=.27,a.wheelsMesh=[n[18],n[19],n[20]],a.wheelsMesh.forEach((function(e){return n[0].removeChild(e)})),n[0].translate(new u.Vector3.Up,.75,u.Space.WORLD);var f=.1125;a.wheels=[{pos:a.wheelsMesh[0].position,radius:f,isFront:!0,params:c},{pos:a.wheelsMesh[1].position,radius:f,isFront:!0,params:c},{pos:a.wheelsMesh[2].position,radius:.05625,isFront:!1,params:l}],a.wheels.forEach((function(e){return e.pos.addInPlace(h)}));var p=function(e,t,i,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new u.Color3(.5,.6,.87),s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"box",a=u.MeshBuilder.CreateBox(s,{width:t.x,depth:t.y,height:t.z},e);a.rotationQuaternion=n,a.position=i;var r=new u.StandardMaterial("vehicleMassBox",e);return r.diffuseColor=new u.Color3(1,0,1),r.specularColor=o,r.emissiveColor=o,a.material=r,a}(e,new u.Vector3(2,2,.6).multiplyByFloats(1,1,1),new u.Vector3(0,1,0).subtractInPlace(h),new u.Vector3(0,0,0).toQuaternion(),new u.Color3(.1,.1,.1),"chassis");p.isVisible=!1,n[0].removeChild(n[11]),a.visualMeshes=[n[11]],a.visualMeshes.forEach((function(e){p.addChild(e)})),a.visualMeshes[0].receiveShadows=!0,a.visualMeshes[0].material.freeze(),a.controls={rotor:n[17],rudder:n[16],leftAileron:n[12],rightAileron:n[13],leftElevator:n[15],rightElevator:n[14]},Object.values(a.controls).forEach((function(e){n[0].removeChild(e),p.addChild(e)})),a.chassisBody=a.createBody(50,new u.Vector3(1,.3,1),new u.Vector3(0,.1,-.2)),a.powerWheelsIndex=[0,1],a.steeringWheelsIndex=[2],a.brakeWheelsIndex=[0,1,2],a.chassisMesh=p,n[0].dispose();var v=a.scene.getPhysicsEngine().getPhysicsPlugin().world;a.chassisBody.position=new d.Vec3(o.x,o.y,o.z);var g=s.toQuaternion();a.chassisBody.quaternion=new d.Quaternion(g.x,g.y,g.z,g.w),v.addBody(a.chassisBody);var m=Object(y.a)(a);return a.scene.registerBeforeRender((function(){m.chassisMesh.position.copyFrom(new u.Vector3(m.chassisBody.position.x,m.chassisBody.position.y,m.chassisBody.position.z)),m.chassisMesh.rotationQuaternion=new u.Quaternion(m.chassisBody.quaternion.x,m.chassisBody.quaternion.y,m.chassisBody.quaternion.z,m.chassisBody.quaternion.w)})),a}return Object(h.a)(i,[{key:"collidersCreate",value:function(e,t,i,n,o){var s=this,a=i;a.forEach((function(t){return e.removeChild(t)})),a.forEach((function(e){t.addChild(e),e.isVisible=o})),a.forEach((function(e){!function(e,t,i,n,o){if(null==t)return;t.checkCollisions=!1;var s=t.parent;!0===o&&(t.parent=null);t.physicsImpostor=new u.PhysicsImpostor(t,i,n,e),!0===o&&(t.parent=s)}(s.scene,e,n,{mass:0,friction:1,restitution:.1},!0)}))}},{key:"createBody",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,i=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0,o=new d.Material("Mat");o.friction=.8,e=new d.Box(new d.Vec3(i.x,i.y,i.z));var s=new d.Body({mass:t});return s.material=o,s.addShape(e,new d.Vec3(n.x,n.y,n.z)),s.angularDamping=.8,s}}]),i}(function(){function e(t){Object(r.a)(this,e),this._scene=t,this._chassisMesh=null,this._wheelsMesh=[],this._powerWheelsIndex=[],this._steeringWheelsIndex=[],this._brakeWheelsIndex=[]}return Object(h.a)(e,[{key:"scene",get:function(){return this._scene},set:function(e){this._scene=e}},{key:"chassisMesh",get:function(){return this._chassisMesh},set:function(e){this._chassisMesh=e}},{key:"wheelsMesh",get:function(){return this._wheelsMesh},set:function(e){this._wheelsMesh=e}},{key:"powerWheelsIndex",get:function(){return this._powerWheelsIndex},set:function(e){this._powerWheelsIndex=e}},{key:"steeringWheelsIndex",get:function(){return this._steeringWheelsIndex},set:function(e){this._steeringWheelsIndex=e}},{key:"brakeWheelsIndex",get:function(){return this._brakeWheelsIndex},set:function(e){this._brakeWheelsIndex=e}}]),e}());u.Mesh.prototype.getAbsoluteSize=function(){this.__size||(this.__size=u.Vector3.Zero());var e=this.scaling,t=this.getBoundingInfo();return this.__size.x=Math.abs(t.minimum.x-t.maximum.x)*e.x,this.__size.z=Math.abs(t.minimum.y-t.maximum.y)*e.y,this.__size.y=Math.abs(t.minimum.z-t.maximum.z)*e.z,this.__size};i(8);var x=i(4),M=i(3),k=function(){function e(t,i,n){Object(r.a)(this,e),this.bm=t,this._x=i,this._y=n,this.lineWidth=this.bm.lineWidth,this.globalLineWidth=this.bm.lineWidth,this._fontSize=12}return Object(h.a)(e,[{key:"lineWidth",get:function(){return this.localLineWidth},set:function(e){this.localLineWidth=e}},{key:"x",get:function(){return this._x},set:function(e){this._x=e}},{key:"y",get:function(){return this._y},set:function(e){this._y=e}},{key:"fontSize",get:function(){return this._fontSize},set:function(e){this._fontSize=e}},{key:"changeLocalLineWidth",value:function(){this.globalLineWidth=this.bm.lineWidth,this.bm.lineWidth=this.localLineWidth}},{key:"resetGlobalLineWidth",value:function(){this.bm.lineWidth=this.globalLineWidth}},{key:"draw",value:function(){}}]),e}(),S=function(e){Object(c.a)(i,e);var t=Object(l.a)(i);function i(e,n,o,s){var a;return Object(r.a)(this,i),(a=t.call(this,e,n,o)).txt="hello...",a.fontSize=s,a}return Object(h.a)(i,[{key:"text",set:function(e){this.txt=e}},{key:"draw",value:function(){this.bm.font="bold ".concat(this.fontSize,"px Arial"),this.bm.textAlign="start",this.bm.fillText(this.txt,this.x,this.y)}}]),i}(k);function V(e,t,i){return Array(t/i-e/i+1).fill().map((function(t,n){return e+n*i}))}function _(e){return e<0&&(e+=360),e>359&&(e-=360),e}function C(e){return e<-90&&(e=-180-e),e>90&&(e=180-e),e}function T(e,t){return e.map((function(e){return t(e)}))}var P=function(e){Object(c.a)(i,e);var t=Object(l.a)(i);function i(e,n,o){var s,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:40,h=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4;return Object(r.a)(this,i),(s=t.call(this,e,n/2-a*(h/2),o/6)).tickSpace=a,s._range=h,s.middle=n/2,s.width=n,s.height=o,s.tilt=0,s.tickHeight=15,s.scale=10,s.x=Math.floor(s.x)+.5,s.y=Math.floor(s.y)+.5,s}return Object(h.a)(i,[{key:"angle",get:function(){return this.tilt},set:function(e){this.tilt=e}},{key:"range",set:function(e){this._range=e}},{key:"rangeScale",set:function(e){this.scale=e}},{key:"draw",value:function(){var e=this;this.x=Math.floor(this.x)+.5,this.y=Math.floor(this.y)+.5;var t=Math.floor(this.tilt),n=Math.floor(10*this.tilt/this.scale)%10,o=Math.floor(10*(this.tilt/this.scale+.5))%10;this.scaleVals=V(Math.floor(this.tilt/this.scale)*this.scale-Math.floor(this.scale*this._range/2),Math.floor(this.tilt/this.scale)*this.scale+Math.floor(this.scale*this._range/2),this.scale),this.scaleVals=T(this.scaleVals,_),this.tilt=t+n/10,Object(x.a)(Object(M.a)(i.prototype),"changeLocalLineWidth",this).call(this),this.bm.beginPath();var s=this.x-n*this.tickSpace/10,a=this.x-o*this.tickSpace/10;this.scaleVals.forEach((function(t,i){e.bm.font="bold ".concat(e.fontSize,"px Arial"),e.bm.textAlign="start",e.bm.fillText(t.toString(),s-5,e.y-e.tickHeight-2),e.bm.moveTo(s,e.y),e.bm.lineTo(s,e.y-e.tickHeight),e.bm.moveTo(a,e.y),e.bm.lineTo(a,e.y-e.tickHeight/2),s+=e.tickSpace,a+=e.tickSpace})),this.bm.moveTo(this.middle,this.y+this.tickHeight),this.bm.lineTo(this.middle,this.y),this.bm.fillText(t.toString(),this.middle+4,this.y+this.tickHeight),this.bm.closePath(),this.bm.stroke(),Object(x.a)(Object(M.a)(i.prototype),"resetGlobalLineWidth",this).call(this)}}]),i}(k),z=function(e){Object(c.a)(i,e);var t=Object(l.a)(i);function i(e,n,o){var s;return Object(r.a)(this,i),(s=t.call(this,e,0,0)).width=n,s.height=o,s.middle=n/2,s.tilt=0,s.rot=0,s.tickHeight=100,s.tickSpace=40,s.scale=10,s.x=Math.floor(s.x)+.5,s.y=Math.floor(s.y)+.5,s._range=4,s.middleOffset=o-(o-s.tickSpace*s._range)/2+s.tickSpace,s}return Object(h.a)(i,[{key:"angle",set:function(e){this.tilt=e}},{key:"rotation",set:function(e){this.rot=e}},{key:"range",set:function(e){this._range=e}},{key:"rangeScale",set:function(e){this.scale=e}},{key:"draw",value:function(){var e=this;this.bm.save(),this.bm.translate(this.width/2,this.height/2),this.bm.rotate(Math.PI/180*this.rot),this.bm.translate(-this.width/2,-this.height/2);var t=Math.floor(this.tilt),n=Math.floor(10*this.tilt/this.scale)%10;this.scaleVals=V(Math.floor(this.tilt/this.scale)*this.scale-Math.floor(this.scale*this._range/2),Math.floor(this.tilt/this.scale)*this.scale+Math.floor(this.scale*this._range/2),this.scale),this.scaleVals=T(this.scaleVals,C),this.tilt=t+n/10;var o=0;o=n>=0?this.middleOffset+n*this.tickSpace/10:this.middleOffset+(10*this.tickSpace/10+n*this.tickSpace/10),Object(x.a)(Object(M.a)(i.prototype),"changeLocalLineWidth",this).call(this),this.scaleVals.forEach((function(t,i){e.bm.beginPath(),e.bm.font="bold ".concat(e.fontSize,"px Arial"),e.bm.textAlign="start";var n=1;t<0&&(e.bm.setLineDash([3*e.tickHeight/100,2*e.tickHeight/100]),n=-1),0!=t?(e.bm.moveTo(e.middle-e.tickHeight/2-e.lineWidth/2,o),e.bm.lineTo(e.middle-.3*e.tickHeight,o),e.bm.moveTo(e.middle+.3*e.tickHeight,o),e.bm.lineTo(e.middle+e.tickHeight/2+e.lineWidth/2,o),e.bm.moveTo(e.middle-e.tickHeight/2,o),e.bm.lineTo(e.middle-e.tickHeight/2,o+e.tickSpace/4*n),e.bm.moveTo(e.middle+e.tickHeight/2,o),e.bm.lineTo(e.middle+e.tickHeight/2,o+e.tickSpace/4*n),e.bm.fillText(t.toString(),e.middle-e.tickHeight/2-130+20*n,o+35-1*n)):(e.bm.moveTo(e.middle-.8*e.tickHeight,o),e.bm.lineTo(e.middle-.3*e.tickHeight,o),e.bm.moveTo(e.middle+.3*e.tickHeight,o),e.bm.lineTo(e.middle+.8*e.tickHeight,o)),o-=e.tickSpace,e.bm.closePath(),e.bm.stroke(),e.bm.setLineDash([])})),Object(x.a)(Object(M.a)(i.prototype),"resetGlobalLineWidth",this).call(this),this.bm.restore()}}]),i}(k);function F(e,t){t.width,t.height;var i,n=0,o=.05,s=new u.Vector3(0,0,0),a=0,r=0,h=0,c="rgba(\n        ".concat(163,",\n        ",255,",\n        ",0,",\n        ",255);window.drawCanvas=document.createElement("canvas"),window.drawCanvas.width=768,window.drawCanvas.height=768;var l=window.drawCanvas.getContext("2d");l.fillStyle=c,l.strokeStyle=c,l.lineWidth=5;var d={compass:new P(l,window.drawCanvas.width,window.drawCanvas.height,200,2),pitchLader:new z(l,window.drawCanvas.width,window.drawCanvas.height),speed:new S(l,0,window.drawCanvas.height-20,90),power:new S(l,0,window.drawCanvas.height-90,75),altitude:new S(l,window.drawCanvas.width-230,window.drawCanvas.height-20,90)};d.compass.tickHeight=60,d.compass.lineWidth=14,d.compass.fontSize=90,d.compass.angle=30,d.pitchLader.tickHeight=300,d.pitchLader.tickSpace=120,d.pitchLader.lineWidth=14,d.pitchLader.fontSize=90,d.pitchLader.range=2,Object.values(d).forEach((function(e){}));var f=new u.HtmlElementTexture("",window.drawCanvas,{scene:e}),p=new u.StandardMaterial("groundMat",e);p.emissiveTexture=f,p.disableLighting=!0,p.diffuseTexture=f,p.diffuseTexture.hasAlpha=!0,p.backFaceCulling=!1;var v=u.MeshBuilder.CreatePlane("hudPlane",{size:1.6});function g(){l.clearRect(0,0,window.drawCanvas.width,window.drawCanvas.height),d.speed.text=a,d.altitude.text=r,d.power.text=h,d.compass.angle=s.x,d.pitchLader.angle=s.y,d.pitchLader.rot=s.z,Object.values(d).forEach((function(e){e.draw()})),f.update()}function w(e){e.addChild(v),v.position=new u.Vector3(0,.8,0)}function y(e){v.parent=e}function m(e){e.lockedTarget=v}function b(e){s.copyFrom(e)}function x(e){a=(10*e).toFixed(1)}function M(e){r=e.toFixed(1)}function k(e){e>.99&&(e=.99),h=(100*e).toFixed(0)}function V(e){(i=e)-n>o&&(g(),n=i)}return v.material=p,f.update(),{update:V,draw:g,linkWithMesh:w,linkWithCamera:y,lockToCamera:m,setRotation:b,setSpeed:x,setAltitude:M,setPower:k}}var I=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Object(r.a)(this,e),this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}return Object(h.a)(e,[{key:"start",value:function(){this.startTime=B(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"timeIntervalCheck",value:function(e){return this.getElapsedTime()>=e&&(this.elapsedTime=0,!0)}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=B();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}]),e}();function B(){return("undefined"===typeof performance?Date:performance).now()}function O(e,t,i,n){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1e4,s=new f.SkyMaterial("skyMaterial",e);s.backFaceCulling=!1,s.distance=o/2,s.turbidity=44,s.inclination=0,s.alpha=.5,s.alphaMode=1,s.luminance=1.1;var a=0,r=u.MeshBuilder.CreateBox("skyBox",{width:o,depth:o,height:o},e);r.material=s,r.position.y=o/3;var h=new u.StandardMaterial("farClouds",e),c=new u.Texture("https://raw.githubusercontent.com/kristosb/arfix/b958a70382ccbf86294af1540cd1608e1af1e161/arfix/public/assets/textures/Skies0362_3_masked_S.png",e);h.diffuseTexture=c,h.backFaceCulling=!1,h.twoSidedLighting=!0,h.diffuseTexture.hasAlpha=!0,h.emissiveColor=new u.Color3(135/255,123/255,78/255),h.specularColor=new u.Color3(46/255,46/255,39/255);var l=new Array(6);l[0]=new u.Vector4(1,0,0,1),l[1]=new u.Vector4(1,0,0,1),l[2]=new u.Vector4(1,0,0,1),l[3]=new u.Vector4(1,0,0,1),l[4]=new u.Vector4(0,0,0,0),l[5]=new u.Vector4(0,0,0,0);var d=o/1024,p={width:1024*d+1,height:292*d+1,depth:1024*d+1,wrap:!0,faceUV:l},v=u.MeshBuilder.CreateBox("farCloudsBox",p,e);function g(){var e=m(n.position.y,[60,500],[2,0])+m(Math.abs(s.inclination),[0,.5],[0,2]);e>2&&(e=2),e<0&&(e=0),s.rayleigh=e}function w(){var e=new u.Vector3(0,0,0);s.useSunPosition=!1,e.copyFrom(s.sunPosition),e.normalize(),i.direction.copyFromFloats(e.x,e.y,e.z),t.direction.copyFromFloats(-e.x,-e.y,-e.z),i.intensity=m(Math.abs(s.inclination),[0,.5],[.8,.2]),t.intensity=m(Math.abs(s.inclination),[0,.5],[2.3,1.4]),console.log(t.direction)}function y(){s.cameraOffset.y=a+n.position.y/10,s.turbidity=m(Math.abs(s.inclination),[0,.5],[44,2]),g()}function m(e,t,i){return(e-t[0])*(i[1]-i[0])/(t[1]-t[0])+i[0]}function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.025,t=.48;s.inclination+=e,s.inclination>=t&&(s.inclination=t),s.inclination<=-t&&(s.inclination=-t),y(),w()}function x(t){for(var i=new u.SpriteManager("cloudsManager","http://www.babylonjs.com/Scenes/Clouds/cloud.png",1e3,256,e),n=0;n<100;n++){var o=new u.Sprite("clouds",i);o.position.x=Math.random()*t-t/2,o.position.y=150*Math.random()+150,o.position.z=Math.random()*t-t/2,o.size=60*Math.random()+50,0===Math.round(5*Math.random())&&(o.angle=90*Math.PI/180),0===Math.round(2*Math.random())&&(o.invertU=-1),0===Math.round(4*Math.random())&&(o.invertV=-1)}return i}function M(e){}function k(){return r}return v.material=h,v.position.y=70,b(0),{update:M,transitionSunInclination:b,makeClouds:x,getSkyMesh:k}}function L(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024,i=j(e,t),n=R(e,i),o=null,s=function i(){-1!==n.diffuseTexture._currentRefreshId?o=new E(t,e,n):window.setTimeout(i,10)};function a(){}function r(){return o}function h(e){}return s(),{update:a,setPosition:h,getMesh:r}}var E=function(){function e(t,i,n){Object(r.a)(this,e);var o=n.diffuseTexture.getSize().width,s=this.generateDistanceField(o,n.diffuseTexture,24,i),a=this.distortionFlow(.5,o,i),h=u.MeshBuilder.CreateGround("waterMesh",{width:t,height:t,subdivisions:4},i);h.material=new f.CustomMaterial("waterMaterial",i),h.material.backFaceCulling=!1,h.position.y=0;var c=new u.CustomProceduralTexture("waterBump","height2Normal",a._texture.baseWidth,i,!1,!0);c.wrapU=c.wrapV=1,c.setVector2("resolution",new u.Vector2(512,512)),c.setTexture("textureSampler",a),c.refreshRate=3,c.level=.5,c.vScale=20,c.uScale=20,h.material.bumpTexture=c,h.material.specularPower=60;var l=this.generateShallowWaterGradient(o,s,.9,i);h.material.diffuseTexture=l,h.material.diffuseTexture.uScale=-1,h.receiveShadows=!0}return Object(h.a)(e,[{key:"generateDistanceField",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:24,n=arguments.length>3?arguments[3]:void 0,o=Date.now(),s=i.toFixed(1).toString();u.Effect.ShadersStore[o+"SdfPixelShader"]="\n        varying vec2 vUV;\n        uniform sampler2D occlusionMap;\n        uniform float res;\n        \n        bool isIn(vec2 uv)\n        {\n            //vec4 texColor = texture(occlusionMap, uv);\n            float x = step(0.99,texture(occlusionMap, uv).r); //treshold the map\n            x = 1. -x;  //reverse color\n            //vec3 color = vec3(x,x,x);\n            if (x != 1.)\n                return false;\n            else\n                return true;\n        }\n\n        float squaredDistanceBetween(vec2 uv1, vec2 uv2)\n        {\n            vec2 delta = uv1 - uv2;\n            float dist = (delta.x * delta.x) + (delta.y * delta.y);\n            return dist;\n        }\n        void main(){\n            vec2 iResolution = vec2(res);\n            const float range = ".concat(s,";\n            const int iRange = int(range);\n            float halfRange = range / 2.0;\n            vec2 startPosition = vec2(gl_FragCoord.x - halfRange, gl_FragCoord.y - halfRange);\n            bool fragIsIn = isIn(vUV);\n            float squaredDistanceToEdge = (halfRange*halfRange)*2.0;\n\n            if (!fragIsIn)\n                for(int dx=0; dx < iRange; dx++)\n                {\n                    for(int dy=0; dy < iRange; dy++)\n                    {\n                        vec2 scanPositionUV = startPosition + vec2(dx, dy);\n                        \n                        bool scanIsIn = isIn(scanPositionUV / iResolution.xy);\n                        if (scanIsIn != fragIsIn)\n                        {\n                            float scanDistance = squaredDistanceBetween(vec2(gl_FragCoord.x,gl_FragCoord.y), scanPositionUV);\n                            //float scanDistance = squaredDistanceBetween(gl_FragCoord, scanPositionUV);\n                            if (scanDistance < squaredDistanceToEdge)\n                                squaredDistanceToEdge = scanDistance;\n                        }\n                    }\n                }\n            float normalised = squaredDistanceToEdge / ((halfRange*halfRange)*2.0);\n            float distanceToEdge = sqrt(normalised);\n            if (fragIsIn)\n                distanceToEdge = -distanceToEdge ;\n            normalised = 0.5 - distanceToEdge;\n\n            gl_FragColor = vec4(normalised, normalised, normalised, 1.0);\n            /*float x = step(0.99,texture2D(occlusionMap, vUV).r); //treshold the map\n            x = 1. -x;  //reverse color\n            vec3 color = vec3(x,x,x);*/\n\n            //vec3 color = vec3(0.,1.,0.);\n            //gl_FragColor = vec4(color, 1.0);\n\n        }\n        ");var a=new u.CustomProceduralTexture(o+"SdfDt",o+"Sdf",e,n,!1,!1);return a.refreshRate=0,a.setTexture("occlusionMap",t,n),a.setFloat("res",e),a}},{key:"generateShallowWaterGradient",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,n=arguments.length>3?arguments[3]:void 0,o=Date.now(),s=new u.Color3(.05,.098,.168),a=new u.Color3(.02,.72,.77),r=i.toFixed(1).toString();u.Effect.ShadersStore[o+"ShallowWaterPixelShader"]="\n        varying vec2 vUV;\n        uniform sampler2D depthField;\n        uniform float res;\n        uniform vec3 deep;\n        uniform vec3 shallow;\n        void main(){\n            vec2 iResolution = vec2(res);\n            float depth = smoothstep(0.,".concat(r,",texture(depthField, vUV).r);\n            vec3 gradient = mix(deep,shallow, depth);\n            gl_FragColor = vec4(gradient,1.0);\n        }\n        ");var h=new u.CustomProceduralTexture(o+"ShallowWaterDt",o+"ShallowWater",e,n,!1,!1);return h.refreshRate=0,h.setTexture("depthField",t,n),h.setFloat("res",e),h.setColor3("deep",s),h.setColor3("shallow",a),h}},{key:"distortionFlow",value:function(e,t,i){var n=Date.now(),o=e.toFixed(1).toString();u.Effect.ShadersStore[n+"DistortionFlowPixelShader"]="\n        varying vec2 vUV;\n        uniform sampler2D textureSampler;\n        //uniform sampler2D flowMap;\n        uniform float uTime;\n\n        vec2 flowUV (vec2 uv, float time) {\n            return uv + time;\n        }\n        //https://www.shadertoy.com/view/MtfBRN\n        void main(){\n            vec2 uv = vec2(vUV.x,-vUV.y);\n            float intensity = ".concat(o,";\n            float timescale = uTime *.0174;\n            //vec2 distortion = (texture2D(flowMap, -uv).rg -1.3) * intensity;\n            float flow_t0 = fract(timescale);\n            float flow_t1 = fract(timescale + .5);\n            float alternate = abs((flow_t0 -.5) * 10.);\n\n            vec4 samp0 = texture2D(textureSampler, uv + flow_t0); \n            vec4 samp1 = texture2D(textureSampler, uv - flow_t1); \n            vec4 Flow = mix(samp0, samp1, alternate);\n            gl_FragColor = vec4(1.,Flow.g,1.,1.);\n        }\n        ");var s=new u.CustomProceduralTexture(n+"DistortionFlowDt",n+"DistortionFlow",t||256,i,!1,!1);s.wrapU=s.wrapV=1,s.refreshRate=3,s.onGeneratedObservable.add((function(){s.setFloat("uTime",s._time)})),s.setFloat("uTime",0);var a=new u.Texture("https://raw.githubusercontent.com/kristosb/assets/main/WavesDt.png");return s.setTexture("textureSampler",a),s.uScale=1,s.vScale=1,s}},{key:"scene",get:function(){return this.params.scene}},{key:"res",get:function(){return this.params.res}}]),e}();function j(e,t){var i=new u.FreeCamera("camWaterMask",new u.Vector3(0,-10,0),e);i.setTarget(u.Vector3.Zero());var n=t/2;return i.mode=u.Camera.ORTHOGRAPHIC_CAMERA,i.orthoTop=n,i.orthoBottom=-n,i.orthoLeft=-n,i.orthoRight=n,i.minZ=8,i.maxZ=15,i}function R(e,t){var i=e.enableDepthRenderer(t).getDepthMap();i.scale(.2);var n=i.getSize();i._refreshRate=0,console.log(n);var o=new u.StandardMaterial("waterOcclMask",e);return o.diffuseTexture=i,o.specularColor.copyFromFloats(0,0,0),t.dispose(),o}function W(e){var t=function(e,t){e.position=new u.Vector3(0,150,0);var i=new u.CascadedShadowGenerator(1024,e);return i.forceBackFacesOnly=!0,i.filteringQuality=u.ShadowGenerator.QUALITY_MEDIUM,i.lambda=1,i.shadowMaxZ=500,i.cascadeBlendPercentage=0,i.depthClamp=!1,i.splitFrustum(),i}(e);return{updateOnce:function(){},addMesh:function(e){t.getShadowMap().renderList.push(e)}}}u.Effect.ShadersStore.height2NormalPixelShader="varying vec2 vUV;\nuniform vec2 resolution;\nuniform sampler2D textureSampler;\n\nvoid main(){\n    vec2 unit = vec2(1.0)/resolution*2.;\n    float x = ((texture2D(textureSampler, vUV+(unit*vec2(-1.,0.))).g-texture2D(textureSampler, vUV+(unit*vec2(1.,0.))).g)+1.)*0.5;\n    float y = ((texture2D(textureSampler, vUV+(unit*vec2(0.,1.))).g-texture2D(textureSampler, vUV+(unit*vec2(0.,-1.))).g)+1.)*0.5;\n    float a = 1.;//texture(textureSampler, vUV).r;\n\n#if defined(invertDepth)\n    \tgl_FragColor = vec4(x, y, 1.0, a);\n#else\n\tgl_FragColor = vec4(1.0-x, y, 1.0, a);\n#endif\n\n}",u.Mesh.prototype.getAbsoluteSize=function(){this.__size||(this.__size=u.Vector3.Zero());var e=this.scaling,t=this.getBoundingInfo();return this.__size.x=Math.abs(t.minimum.x-t.maximum.x)*e.x,this.__size.y=Math.abs(t.minimum.y-t.maximum.y)*e.y,this.__size.z=Math.abs(t.minimum.z-t.maximum.z)*e.z,this.__size};var D=function(){function e(){Object(r.a)(this,e)}return Object(h.a)(e,null,[{key:"cannon2babylonVec3",value:function(e){var t=new u.Vector3;return t.copyFromFloats(e.x,e.y,e.z),t}},{key:"cannon2babylonQuat",value:function(e){return new u.Quaternion(e.x,e.y,e.z,e.w)}},{key:"babylon2cannonVec3",value:function(e){return new d.Vec3(e.x,e.y,e.z)}},{key:"babylon2cannonQuat",value:function(e){return new d.Quaternion(e.x,e.y,e.z,e.w)}}]),e}(),A=function(){function e(t,i){Object(r.a)(this,e),this.scene=t,this.vehicle=null,this.chassisBody=null,this.carData=i,this.chassisMesh=i.chassisMesh,this.wheelMeshes=i.wheelsMesh,this.powerWheels=i.powerWheelsIndex,this.steeringwheels=i.steeringWheelsIndex,this.breakWheels=i.brakeWheelsIndex,this.carDataBody=i.chassisBody,this.carDataWheelBodies=i.wheelBodies,this.createVehicle()}return Object(h.a)(e,[{key:"createVehicle",value:function(){var e=this.scene.getPhysicsEngine().getPhysicsPlugin().world;console.log("rotations"),this.chassisBody=this.carDataBody;var t={radius:.3,directionLocal:new d.Vec3(0,-1,0),suspensionStiffness:150,suspensionRestLength:.25,frictionSlip:5,dampingRelaxation:2.3,dampingCompression:4.5,maxSuspensionForce:2e5,rollInfluence:.01,axleLocal:new d.Vec3(-1,0,0),chassisConnectionPointLocal:new d.Vec3(1,1,0),maxSuspensionTravel:.25,customSlidingRotationalSpeed:-30,useCustomSlidingRotationalSpeed:!0};this.vehicle=new d.RaycastVehicle({chassisBody:this.chassisBody,indexUpAxis:1,indexRightAxis:0,indexForwardAxis:2});var i=this;this.carData.wheels.forEach((function(e,n){t.radius=e.radius,t.chassisConnectionPointLocal.copy(D.babylon2cannonVec3(new u.Vector3(e.pos.x,e.pos.y,e.pos.z))),i.vehicle.addWheel(t)})),this.vehicle.addToWorld(e),this.scene.registerBeforeRender((function(){for(var e=0;e<i.vehicle.wheelInfos.length;e++){i.vehicle.updateWheelTransform(e);var t=i.vehicle.wheelInfos[e].worldTransform;i.wheelMeshes[e].position.copyFrom(D.cannon2babylonVec3(t.position)),i.wheelMeshes[e].rotationQuaternion.copyFrom(D.cannon2babylonQuat(t.quaternion))}}))}},{key:"forward",value:function(e){var t=this;this.powerWheels.forEach((function(i){return t.vehicle.applyEngineForce(-e,i)}))}},{key:"backward",value:function(e){var t=this;this.powerWheels.forEach((function(i){return t.vehicle.applyEngineForce(e,i)}))}},{key:"right",value:function(e){var t=this;this.steeringwheels.forEach((function(i){return t.vehicle.setSteeringValue(e,i)}))}},{key:"left",value:function(e){var t=this;this.steeringwheels.forEach((function(i){return t.vehicle.setSteeringValue(-e,i)}))}},{key:"brake",value:function(e){var t=this;this.breakWheels.forEach((function(i){return t.vehicle.setBrake(e,i)}))}},{key:"unbrake",value:function(){var e=this;this.breakWheels.forEach((function(t){return e.vehicle.setBrake(0,t)}))}}]),e}(),Q=function(){function e(t,i,n){Object(r.a)(this,e),n=n||{};var o=new u.Vector3(260,4,350);this.vehicleMesh=u.MeshBuilder.CreateBox("yukaMesh",{width:12,height:3,depth:54},t),this.vehicleMesh.material=new f.GridMaterial("groundMaterial",t),this.vehicleMesh.position.copyFrom(o),this.vehicleMesh.position.z+=14,this.vehicleMesh.position.x-=4.3,this.vehicleMesh.physicsImpostor=new u.PhysicsImpostor(this.vehicleMesh,u.PhysicsImpostor.BoxImpostor,{mass:1e5,friction:1,restitution:.9},t),this.vehicleMesh.isVisible=!1,this.entityManager=new m.c,this.time=new m.o,this.vehicle=new m.q,this.vehicle.maxSpeed=1,this.vehicle.mass=.1;var s=new m.j;s.loop=!0,s.add(new m.p(290,0,340)),s.add(new m.p(100,0,350)),s.add(new m.p(0,0,300)),s.add(new m.p(20,0,180)),s.add(new m.p(140,0,140)),s.add(new m.p(300,0,200)),this.vehicle.position.copy(s.current()),this.vehicle.active=!1;var a=new m.e(s,20);(this.vehicle.steering.add(a),this.onPathBehavior=new m.i(s),this.vehicle.steering.add(this.onPathBehavior),this.entityManager.add(this.vehicle),s._waypoints.push(s._waypoints[0]),n.debug)&&(u.MeshBuilder.CreateLines("lines",{points:s._waypoints,updatable:!0}).color=u.Color3.Teal());this.onPathBehavior.active=!1,this.entityManager.update(this.time.update().getDelta()),i.position.copyFrom(o),i.position.y+=3.37,this.vehicleMesh.addChild(i),this.vehicleMesh.rotate(new u.Vector3.Up,-Math.PI/2),this.altOffset=new u.Vector3(0,-2.3,0),this.vehicle.rotation=new m.k(this.vehicleMesh.rotationQuaternion.x,this.vehicleMesh.rotationQuaternion.y,this.vehicleMesh.rotationQuaternion.z,this.vehicleMesh.rotationQuaternion.w)}return Object(h.a)(e,[{key:"update",value:function(){var e=this.time.update().getDelta();this.entityManager.update(e);var t=-(this.vehicleMesh.position.y+this.altOffset.y),i=new u.Vector3(this.vehicle.velocity.x,t,this.vehicle.velocity.z);this.vehicleMesh.physicsImpostor.setLinearVelocity(i),this.vehicleMesh.physicsImpostor.physicsBody.angularVelocity=new d.Vec3(0,0,0);var n=new d.Quaternion(this.vehicle.rotation.x,this.vehicle.rotation.y,this.vehicle.rotation.z,this.vehicle.rotation.w),o=(new d.Vec3,n.conjugate().mult(this.vehicleMesh.physicsImpostor.physicsBody.quaternion)),s=new d.Vec3;o.toEuler(s),this.vehicleMesh.physicsImpostor.physicsBody.angularVelocity=new d.Vec3(0,-s.y/10,0)}},{key:"pause",get:function(){return this.vehicle.active},set:function(e){this.vehicle.active=e}}]),e}(),U=function(){function e(t,i,n){Object(r.a)(this,e),n=n||{};var o=new u.Vector3(-100,100,-100),s=new u.Vector3(140,50,190).addInPlace(o);this.vehicleMesh=u.MeshBuilder.CreateBox("yukaMeshAirship",{width:12,height:10,depth:64},t),this.vehicleMesh.material=new f.GridMaterial("groundMaterialAirship",t),this.vehicleMesh.position.copyFrom(s),this.vehicleMesh.position.z+=-1,this.vehicleMesh.physicsImpostor=new u.PhysicsImpostor(this.vehicleMesh,u.PhysicsImpostor.BoxImpostor,{mass:1e5,friction:1,restitution:.9},t),this.vehicleMesh.isVisible=n.debug,this.entityManager=new m.c,this.time=new m.o,this.vehicle=new m.q,this.vehicle.maxSpeed=2,this.vehicle.mass=.1;var a=new m.j;a.loop=!0;var h=new m.p(o.x,o.y,o.z);a.add(new m.p(140,80,190).add(h)),a.add(new m.p(-50,130,200).add(h)),a.add(new m.p(-50,180,150).add(h)),a.add(new m.p(-30,130,30).add(h)),a.add(new m.p(-10,130,-10).add(h)),a.add(new m.p(150,100,50).add(h)),this.vehicle.position.copy(a.current()),this.vehicle.active=!1;var c=new m.e(a,20);(this.vehicle.steering.add(c),this.onPathBehavior=new m.i(a),this.vehicle.steering.add(this.onPathBehavior),this.entityManager.add(this.vehicle),a._waypoints.push(a._waypoints[0]),n.debug)&&(u.MeshBuilder.CreateLines("lines",{points:a._waypoints,updatable:!0}).color=u.Color3.Teal());this.onPathBehavior.active=!1,this.entityManager.update(this.time.update().getDelta()),i.scaling=new u.Vector3(7,7,7),i.position.copyFrom(s),i.position.y+=-20.6,i.rotate(new u.Vector3.Up,-Math.PI),this.vehicleMesh.addChild(i),this.vehicleMesh.rotate(new u.Vector3.Up,-Math.PI/2),this.altOffset=new u.Vector3(0,0,0),this.vehicle.rotation=new m.k(this.vehicleMesh.rotationQuaternion.x,this.vehicleMesh.rotationQuaternion.y,this.vehicleMesh.rotationQuaternion.z,this.vehicleMesh.rotationQuaternion.w)}return Object(h.a)(e,[{key:"update",value:function(){var e=this.time.update().getDelta();this.entityManager.update(e);var t=-(this.vehicleMesh.position.y-this.vehicle.position.y+this.altOffset.y),i=new u.Vector3(this.vehicle.velocity.x,t,this.vehicle.velocity.z);this.vehicleMesh.physicsImpostor.setLinearVelocity(i),this.vehicleMesh.physicsImpostor.physicsBody.angularVelocity=new d.Vec3(0,0,0);var n=new d.Quaternion(this.vehicle.rotation.x,this.vehicle.rotation.y,this.vehicle.rotation.z,this.vehicle.rotation.w),o=(new d.Vec3,n.conjugate().mult(this.vehicleMesh.physicsImpostor.physicsBody.quaternion)),s=new d.Vec3;o.toEuler(s),this.vehicleMesh.physicsImpostor.physicsBody.angularVelocity=new d.Vec3(0,-s.y/10,0)}},{key:"pause",get:function(){return this.vehicle.active},set:function(e){this.vehicle.active=e}}]),e}(),H=new m.h,q=new m.p,G=function(e){Object(c.a)(i,e);var t=Object(l.a)(i);function i(e){var n;return Object(r.a)(this,i),n=t.call(this),console.log("Limit Box"),n.limitBox=e,n.brakingWeight=.2,n.dBoxMinLength=4,n}return Object(h.a)(i,[{key:"calculate",value:function(e,t){var i=this.limitBox;e.worldMatrix.getInverse(H);this.dBoxMinLength,e.getSpeed(),e.maxSpeed,this.dBoxMinLength;if(q.copy(i.position).applyMatrix4(H),q.z<0){var n=i.boundingRadius-q.length();if(n<0){var o=20*-n;t.x=q.x*o,t.y=q.y*o/10,t.z=-10*o,t.applyRotation(e.rotation)}}var s=6*(1.5+e.rotation.toEuler(new m.p).x/(Math.PI/4));return e.maxSpeed=s,t}},{key:"toJSON",value:function(){var e=Object(x.a)(Object(M.a)(i.prototype),"toJSON",this).call(this);return e.brakingWeight=this.brakingWeight,e.dBoxMinLength=this.dBoxMinLength,e}},{key:"fromJSON",value:function(e){return Object(x.a)(Object(M.a)(i.prototype),"fromJSON",this).call(this,e),this.brakingWeight=e.brakingWeight,this.dBoxMinLength=e.dBoxMinLength,this}}]),i}(m.n),Z=function(){function e(t,i,n){var o=this;Object(r.a)(this,e),n=n||{},this.entityMatrix=new u.Matrix,this.entityManager=new m.c,this.time=new m.o;var s,a=new u.Vector3(150,35,240);s=function(e,t,i,n){var o=u.MeshBuilder.CreateBox("limitBox",{size:t},e),s=new u.StandardMaterial("meshMat",e);s.disableLighting=!0,s.emissiveColor=u.Color3.Red(),s.wireframe=!0,o.material=s,o.position.copyFrom(i),o.visibility=n;var a=new m.f;return a.position.copy(o.position),a.boundingRadius=1*o.getBoundingInfo().boundingSphere.radius,a}(t,100,new u.Vector3(a.x,a.y+50,a.z),n.debug),this.entityManager.add(s);var h=new m.a,c=new m.b,l=new m.l;h.weight=1.9,c.weight=2.5,l.weight=.15,this.enemy=new m.p,i.forEach((function(e){var t=e;t.position.copyFrom(a);var i=new m.q;i.maxSpeed=10,i.updateNeighborhood=!0,i.neighborhoodRadius=30,i.setRenderComponent(t,N),i.boundingRadius=t.getBoundingInfo().boundingSphere.radius,i.smoother=new m.m(20),i.position=new m.p(a.x,a.y,a.z),i.position.x=i.position.x-5*Math.random(),i.position.z=i.position.z-5*Math.random(),i.active=!1,i.steering.add(h),i.steering.add(c),i.steering.add(l);var n=new m.r(1,5,5);n.weight=1.2,i.steering.add(n);var r=new G(s);i.steering.add(r);var u=new m.d(o.enemy,5);u.weight=5,i.steering.add(u),o.entityManager.add(i)}))}return Object(h.a)(e,[{key:"update",value:function(){var e=this.time.update().getDelta();this.entityManager.update(e)}},{key:"pause",get:function(){return!1},set:function(e){this.entityManager.entities.forEach((function(t){return t.active=e}))}},{key:"enemyPosition",set:function(e){this.enemy.copy(new m.p(e.x,e.y,e.z))}}]),e}();function N(e,t){t.position=new u.Vector3(e.position.x,e.position.y,e.position.z),t.rotationQuaternion=new u.Quaternion(e.rotation.x,e.rotation.y,e.rotation.z,e.rotation.w)}m.r.prototype.calculate=function(e,t,i){var n=new m.p,o=this.jitter*i,s=new m.p;return s.x=m.g.randFloat(-1,1)*o,s.y=m.g.randFloat(-1,1)*o/10,s.z=m.g.randFloat(-1,1)*o,this._targetLocal.add(s),this._targetLocal.normalize(),this._targetLocal.multiplyScalar(this.radius),n.copy(this._targetLocal),n.z+=this.distance,n.applyMatrix4(e.worldMatrix),t.subVectors(n,e.position),t};var J=1,Y=2,K=3,X=4,$=5,ee=6,te=7,ie=8,ne=9,oe=10,se=11,ae=12,re=13,he=14,ce=function(){function e(){Object(r.a)(this,e),this.bluePrint=null,this.suspension=null,this.avionics=null,this.hud=null,this.clock=new I}return Object(h.a)(e,[{key:"position",get:function(){return this.bluePrint.chassisMesh.position},set:function(e){this.bluePrint.chassisMesh.setAbsolutePosition(e)}},{key:"ready",get:function(){return null!==this.suspension}},{key:"steer",value:function(e){switch(e){case J:this.avionics.pitch=-1;break;case Y:this.avionics.pitch=1;break;case K:this.avionics.yaw=-1,this.suspension.left(.5);break;case X:this.avionics.yaw=1,this.suspension.right(.5);break;case ie:this.suspension.left(0);break;case ne:this.suspension.right(0);break;case ae:this.avionics.yaw=-1;break;case re:this.avionics.yaw=1;break;case $:this.avionics.roll=-1;break;case ee:this.avionics.roll=1;break;default:console.log("vehicle invalid direction")}}},{key:"power",value:function(e){switch(e){case oe:this.avionics.enginePower=this.avionics.enginePower+.005,this.avionics.speedModifier=.12;break;case se:this.avionics.enginePower=this.avionics.enginePower-.005;break;default:console.log("vehicle invalid power")}}},{key:"brake",value:function(e){switch(e){case te:this.suspension.brake(5);break;case he:this.suspension.unbrake();break;default:console.log("vehicle invalid power")}}},{key:"update",value:function(){if(null!=this.avionics&&null!=this.hud){var e=this.clock.getElapsedTime();this.hud.setRotation(new u.Vector3(180+u.Tools.ToDegrees(this.avionics.rotation.y),-u.Tools.ToDegrees(this.avionics.rotation.x),u.Tools.ToDegrees(this.avionics.rotation.z))),this.hud.setSpeed(this.avionics.velocity.z),this.hud.setPower(this.avionics.enginePower),this.hud.setAltitude(this.avionics.collision.position.y),this.hud.update(e)}}}]),e}();function le(e){e.width,e.height;var t=new u.Engine(e,!0,{preserveDrawingBuffer:!0,stencil:!0});t.loadingUIText="Loading world and airplane...",t.loadingUIBackgroundColor="Purple",t.stopRenderLoop();var i=new u.Scene(t),n=!1,o=(function(){var e=new u.Vector3(0,-9.81,0),t=new u.CannonJSPlugin(!1,void 0,d);i.enablePhysics(e,t);i.getPhysicsEngine();i.physicsEnabled=!1,t.setTimeStep(1/30)}(),new u.PhysicsViewer(i),function(t){var n=new u.FollowCamera("followcamera",new u.Vector3(0,0,-100),i);return n.heightOffset=1,n.cameraAcceleration=.05,n.maxCameraSpeed=1800,n.inertia=20,n.radius=-5,n.attachControl(e,!1),i.activeCamera=n,n}()),s=function(e){var t=new u.DirectionalLight("light",new u.Vector3(.7,-.3,.7),e);t.position=new u.Vector3(50,100,100),t.intensity=2.3,t.setEnabled(!0);var i=new u.HemisphericLight("ambient",new u.Vector3(-.7,.3,-.7),e);return i.position=new u.Vector3(0,55,5),i.intensity=.8,i.diffuse=new u.Color3(.96,.97,.93),i.groundColor=new u.Color3(.1,.1,.1),i.setEnabled(!0),{sunLight:t,ambientlight:i}}(i),a=800,r=null,h=null,c=null,l=null,f=new O(i,s.sunLight,s.ambientlight,o,a);f.makeClouds(a),o.maxZ=1120;var p=null,v=new I;p=new W(s.sunLight);var w={};["w","s","a","d","q","e","p","o","m","n","1","2","k","b","9","0"].forEach((function(e){return w[e]={type:!1,keyState:"up"}}));var y=new u.AssetsManager(i),m=y.addMeshTask("world task","","/arfix/assets//","achil_2.glb"),x=y.addMeshTask("airplane","","/arfix/assets/","airplane-ww2-collision-scaled.glb"),M=y.addMeshTask("nimitz","","/arfix/assets/","nimitz_single_mesh.glb"),k=y.addMeshTask("bird","","/arfix/assets/","flying-gull.glb"),S=y.addMeshTask("airship","","/arfix/assets/","titan_parts_joined_uvmapped.glb");m.onSuccess=function(e){var t=e.loadedMeshes;t[0].removeChild(t[1]);var i=t[1];i.setParent(null),t[0].dispose(),i.scaling=i.scaling.multiplyByFloats(8,8,8),i.position.y=-1.2,i.name="terrain",i.material.freeze(),i.freezeWorldMatrix(),i.doNotSyncBoundingInfo=!0,p.addMesh(i),i.receiveShadows=!0,console.log("world finished")};var V=new ce;function _(e,t){w[e].type&&t()}function C(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:function(){};w[e].type?"up"==w[e].keyState?(w[e].keyState="down",t()):(w[e].keyState="hold",n()):"up"!=w[e].keyState&&(w[e].keyState="up",i())}return x.onSuccess=function(t){V.bluePrint=new b(i,t.loadedMeshes,new u.Vector3(275,6.5,364),new u.Vector3(0,-Math.PI/2,0)),V.suspension=new A(i,V.bluePrint),V.avionics=new g(i,V.bluePrint.chassisBody,V.bluePrint.controls),V.hud=new F(i,e),V.hud.linkWithMesh(V.bluePrint.chassisMesh),o.lockedTarget=V.bluePrint.chassisMesh,V.position=new u.Vector3(-10,5.7,-5),p.addMesh(V.bluePrint.visualMeshes[0]),console.log("airplane finished")},M.onSuccess=function(e){var t=e.loadedMeshes[0];r=new Q(i,t)},S.onSuccess=function(e){var t=e.loadedMeshes[0];h=new U(i,t,{debug:!1})},k.onSuccess=function(e){var t=e.loadedMeshes[1];t.scaling=new u.Vector3(.012,.012,.012),t.rotationQuaternion=new u.Vector3(0,-Math.PI/4,0).toQuaternion(),t.bakeCurrentTransformIntoVertices(),console.log("gull",t);for(var n=[],o=0;o<20;o++){var s=t.createInstance("gull_"+o.toString());n.push(s)}c=new Z(i,n)},y.onFinish=function(e){!function(e){e.actionManager=new u.ActionManager(e),e.actionManager.registerAction(new u.ExecuteCodeAction(u.ActionManager.OnKeyDownTrigger,(function(e){w[e.sourceEvent.key]&&(w[e.sourceEvent.key].type="keydown"===e.sourceEvent.type)}))),e.actionManager.registerAction(new u.ExecuteCodeAction(u.ActionManager.OnKeyUpTrigger,(function(e){w[e.sourceEvent.key]&&(w[e.sourceEvent.key].type=!1)})))}(i),new L(i,a),l=new u.VideoRecorder(t),n=!0,console.log("manager finished")},y.load(),{update:function(){},onWindowResize:function(){t.resize()},animate:function(){t.runRenderLoop((function(){n&&v.timeIntervalCheck(.025)&&(V.ready&&(_("q",(function(){return V.steer($)})),_("e",(function(){return V.steer(ee)})),_("w",(function(){return V.steer(Y)})),_("s",(function(){return V.steer(J)})),C("d",(function(){return V.steer(K)}),(function(){return V.steer(ie)}),(function(){return V.steer(ae)})),C("a",(function(){return V.steer(X)}),(function(){return V.steer(ne)}),(function(){return V.steer(re)})),_("m",(function(){return V.power(oe)})),_("n",(function(){return V.power(se)})),C("b",(function(){return V.brake(te)}),(function(){return V.brake(he)}),(function(){return V.brake(te)}))),C("o",(function(){return i.debugLayer.show()})),C("1",(function(){f.transitionSunInclination(.025),p.updateOnce()})),C("2",(function(){f.transitionSunInclination(-.025),p.updateOnce()})),C("p",(function(){i.physicsEnabled=!i.physicsEnabled,r.pause=i.physicsEnabled,h.pause=i.physicsEnabled,c.pause=i.physicsEnabled})),C("9",(function(){u.VideoRecorder.IsSupported(t)&&(l.startRecording("test.webm",0),console.log("start rec"))})),C("0",(function(){u.VideoRecorder.IsSupported(t)&&(l.stopRecording(),console.log("stop rec"))})),V.update(),c.update(),c.enemyPosition=V.position,r.update(),h.update(),i.render())}))}}}i(32);var ue=i(11),de=function(e){Object(c.a)(i,e);var t=Object(l.a)(i);function i(){return Object(r.a)(this,i),t.apply(this,arguments)}return Object(h.a)(i,[{key:"componentDidMount",value:function(){!function(e){var t=function(e,t){var i=e.createElement("canvas");return t.appendChild(i),i}(document,e);t.style.width="100%",t.style.height="100%",t.width=t.offsetWidth,t.height=t.offsetHeight;var i=new le(t);function n(){t.style.width="100%",t.style.height="100%",t.width=t.offsetWidth,t.height=t.offsetHeight,Math.round(t.offsetWidth/2),Math.round(t.offsetHeight/2),i.onWindowResize()}window.onresize=n,n(),n(),i.animate()}(this.threeRootElement)}},{key:"render",value:function(){var e=this;return Object(ue.jsx)("div",{className:"viewer-viewer",ref:function(t){return e.threeRootElement=t}})}}]),i}(n.Component);var fe=function(){return Object(ue.jsx)("div",{className:"App",children:Object(ue.jsx)(de,{})})},pe=function(e){e&&e instanceof Function&&i.e(3).then(i.bind(null,35)).then((function(t){var i=t.getCLS,n=t.getFID,o=t.getFCP,s=t.getLCP,a=t.getTTFB;i(e),n(e),o(e),s(e),a(e)}))};a.a.render(Object(ue.jsx)(o.a.StrictMode,{children:Object(ue.jsx)(fe,{})}),document.getElementById("root")),pe()}},[[34,1,2]]]);
//# sourceMappingURL=main.95eec1a8.chunk.js.map