{"version":3,"sources":["Components/Viewer/babylonjs/Airplane.js","Components/Viewer/babylonjs/VehiclesData.js","Components/Viewer/babylonjs/GuiHudControls.js","Components/Viewer/babylonjs/HudControls.js","Components/Viewer/babylonjs/Hud.js","Components/Viewer/babylonjs/Clock.js","Components/Viewer/babylonjs/SkySimulator.js","Components/Viewer/babylonjs/OceanSimulator.js","Components/Viewer/babylonjs/sahdowManager.js","Components/Viewer/babylonjs/CannonUtils.js","Components/Viewer/babylonjs/Vehicle.js","Components/Viewer/babylonjs/BattleShip.js","Components/Viewer/babylonjs/Birds.js","Components/Viewer/babylonjs/SceneManager.js","Components/Viewer/babylonjs/babylonEntryPoint.js","Components/Viewer/Viewer.js","App.js","reportWebVitals.js","index.js"],"names":["vmult","v","q","target","BABYLON","x","y","z","qx","qy","qz","qw","w","ix","iy","iz","iw","applyLocalForce","localForce","localPoint","body","CANNON","AirplaneCannon","scene","chassis","controls","this","console","error","_lift","_roll","_rollLimit","_yaw","_yawLimit","_pitch","_pitchLimit","_velocity","_currentSpeed","_enginePower","_enginePowerLimit","enginePowerPrev","speedModifier","collision","rudder","rotor","leftAileron","rightAileron","leftElevator","rightElevator","_relativeBody","_isTouchingGround","addAnimations","animationGroup","play","speedRatio","controlsInitialize","registerForces","val","velocity","Inverse","quaternion","toEulerAngles","mesh","touching","rotation","Math","PI","animWheel","ANIMATIONTYPE_FLOAT","ANIMATIONLOOPMODE_CYCLE","wheelKeys","push","frame","value","setKeys","animations","addTargetedAnimation","rotorSpin","rudderZeroRotation","leftAileronZeroRotation","rightAileronZeroRotation","leftElevatorZeroRotation","rightElevatorZeroRotation","copyFrom","rotationQuaternion","position","set","rot","rotate","Up","Left","lift","abs","enginePower","dir","pitchForce","YawForce","aileronControl","roll","rudderControl","yaw","elevatorControl","pitch","that","onBeforeRenderObservable","add","applyRollForce","applyPitchYawForce","applyDragForce","applyLiftForce","applyThrustForce","propellerSpeedUpdate","resetControls","AirplaneWW2","meshAll","eulerRotation","translate","WORLD","scaling","multiplyByFloats","massOffset","settings","suspensionStiffness","suspensionDamping","suspensionCompression","suspensionRestLength","rollInfluence","rearWheelSettings","wheelsMesh","forEach","m","removeChild","radius","wheels","pos","isFront","params","addInPlace","size","color","name","box","CreateBox","width","depth","height","myMaterial","diffuseColor","specularColor","emissiveColor","material","makebox","subtractInPlace","toQuaternion","isVisible","visualMeshes","vm","addChild","receiveShadows","freeze","Object","values","chassisBody","createBody","powerWheelsIndex","steeringWheelsIndex","brakeWheelsIndex","chassisMesh","dispose","world","getPhysicsEngine","getPhysicsPlugin","initRotation","addBody","registerBeforeRender","oldRoot","newRoot","meshes","impostorType","coliderMeshesBox","cm","entity","impostor","options","reparent","checkCollisions","parent","physicsImpostor","createPhysicsImpostor","mass","friction","restitution","chassisShape","offset","mat","addShape","angularDamping","_scene","_chassisMesh","_wheelsMesh","_powerWheelsIndex","_steeringWheelsIndex","_brakeWheelsIndex","s","indices","prototype","getAbsoluteSize","__size","Zero","bounds","getBoundingInfo","minimum","maximum","hudControl","bm","_x","_y","lineWidth","globalLineWidth","_fontSize","localLineWidth","hudSimpleText","fontSize","txt","font","textAlign","fillText","range","start","end","inc","Array","fill","map","_","idx","limitCompass","limitPitchLadder","rangeClip","rangeArray","limit","compass","tickSpace","_range","middle","tilt","tickHeight","scale","floor","angle","rangeScale","tiltFloor","tiltRemd","tiltRemdHalf","scaleVals","beginPath","space","spaceHalf","toString","moveTo","lineTo","closePath","stroke","pitchLader","middleOffset","save","sign","setLineDash","restore","hudPanel","canvas","now","then","interval","angles","speed","altitude","power","style","window","drawCanvas","document","createElement","ctx","getContext","fillStyle","strokeStyle","hudElements","HUD2D","texture","emissiveTexture","disableLighting","diffuseTexture","hasAlpha","backFaceCulling","hudMesh","CreatePlane","draw","clearRect","text","update","linkWithMesh","linkWithCamera","cam","lockToCamera","lockedTarget","setRotation","eulerAngles","setSpeed","toFixed","setAltitude","a","setPower","p","time","Clock","autoStart","startTime","oldTime","elapsedTime","running","getElapsedTime","getDelta","diff","newTime","performance","Date","skySim","sunLight","ambientLight","followCam","skyboxMaterial","SkyMaterial","distance","turbidity","inclination","alpha","alphaMode","luminance","skybox","cloudMaterial","cloudTexture","twoSidedLighting","faceUV","cloudBoxSizeMult","cloudOptions","wrap","cloudBox","calcRaylight","rayligh","convertRange","rayleigh","setLightDirection","dirNorm","useSunPosition","sunPosition","normalize","direction","copyFromFloats","intensity","log","move","cameraOffset","r1","r2","transitionSunInclination","makeClouds","area","spriteManagerClouds","i","clouds","random","round","invertU","invertV","getSkyMesh","camWaterMask","maskProjectionCam","gmat","createMaskMaterial","ocean","checkDepthMapCreated","_currentRefreshId","ProceduralHeightMap","setTimeout","getMesh","setPosition","wsize","sdfRes","getSize","sdfTexture","generateDistanceField","flowHeight","distortionFlow","water","CreateGround","subdivisions","CustomMaterial","bumpTexture","_texture","baseWidth","wrapU","wrapV","setVector2","setTexture","refreshRate","level","vScale","uScale","specularPower","waterColorTexture","generateShallowWaterGradient","res","occlusionTexture","iter1","uid","iter","ShadersStore","setFloat","depfthField","clipDepth","deepColor","shallowColor","clip","setColor3","wspeed","onGeneratedObservable","_time","waveNoiseTexture","cameraOrth","setTarget","cameraZoom","mode","ORTHOGRAPHIC_CAMERA","orthoTop","orthoBottom","orthoLeft","orthoRight","minZ","maxZ","depthMap","enableDepthRenderer","getDepthMap","_refreshRate","groundMat","shadowlight","groundshadowGenerator","light","camera","csmShadowGenerator","forceBackFacesOnly","filteringQuality","QUALITY_MEDIUM","lambda","shadowMaxZ","cascadeBlendPercentage","depthClamp","splitFrustum","cascadingShadowGenerator","updateOnce","addMesh","getShadowMap","renderList","CannonUtils","cannonVector","babylonVector","cannonQuat","babylonQuat","Vehicle","carData","vehicle","wheelMeshes","powerWheels","steeringwheels","breakWheels","carDataBody","carDataWheelBodies","wheelBodies","createVehicle","directionLocal","frictionSlip","dampingRelaxation","dampingCompression","maxSuspensionForce","axleLocal","chassisConnectionPointLocal","maxSuspensionTravel","customSlidingRotationalSpeed","useCustomSlidingRotationalSpeed","indexUpAxis","indexRightAxis","indexForwardAxis","wheel","index","copy","babylon2cannonVec3","addWheel","addToWorld","wheelInfos","length","updateWheelTransform","t","worldTransform","cannon2babylonVec3","cannon2babylonQuat","force","applyEngineForce","setSteeringValue","setBrake","BattleShip","visualMesh","initPosition","vehicleMesh","GridMaterial","BoxImpostor","entityManager","YUKA","maxSpeed","path","loop","current","active","followPathBehavior","steering","onPathBehavior","_waypoints","debug","CreateLines","points","updatable","Teal","altOffset","delta","vy","meshVelocity","setLinearVelocity","physicsBody","angularVelocity","rotC","rotated","conjugate","mult","toEuler","inverse","localPositionOfLimitBox","LimitBoxBehavior","limitBox","brakingWeight","dBoxMinLength","worldMatrix","getInverse","getSpeed","applyMatrix4","vehicleSphereDitsance","boundingRadius","multiplier","applyRotation","json","Birds","entityMatrix","mesh1","meshMat","Red","wireframe","visibility","boundingSphere","setupLimitBox","alignmentBehavior","cohesionBehavior","separationBehavior","weight","enemy","updateNeighborhood","neighborhoodRadius","setRenderComponent","sync","smoother","wanderBehavior","LimitBehavior","fleeBehavior","entities","renderComponent","calculate","targetWorld","jitterThisTimeSlice","jitter","randomDisplacement","randFloat","_targetLocal","multiplyScalar","subVectors","DIR","vehicleParts","bluePrint","suspension","avionics","hud","clock","setAbsolutePosition","left","right","brake","unbrake","ToDegrees","engine","preserveDrawingBuffer","stencil","loadingUIText","loadingUIBackgroundColor","sceneLoaded","gravityVector","physicsPlugin","undefined","enablePhysics","physicsEnabled","buildGravity","followCamera","heightOffset","cameraAcceleration","maxCameraSpeed","inertia","attachControl","activeCamera","followCameraCreate","lights","setEnabled","ambientlight","diffuse","groundColor","buildLight","worldSize","nimitzCarrier","birdFlock","sky","SkySim","groundShadow","ShadowManager","inputMap","key","type","keyState","assetsManager","meshWorldTask","addMeshTask","process","meshAirplaneTask","meshCarrierTask","meshBirdTask","onSuccess","task","loadedMeshes","ground","setParent","freezeWorldMatrix","doNotSyncBoundingInfo","aircraft","keyAction","onKeyFunc","keyActionTrig","onKeyDownFunc","onKeyUpFunc","onKeyHoldFunc","Suspension","Airplane","HudPanel","nimitzMesh","Battleship","gullModel","birds","gull","clone","onFinish","actionManager","registerAction","OnKeyDownTrigger","evt","sourceEvent","OnKeyUpTrigger","registerActions","OceanSim","load","onWindowResize","resize","onMouseMove","animate","runRenderLoop","ready","steer","debugLayer","show","pause","enemyPosition","render","Viewer","container","appendChild","createCanvas","offsetWidth","offsetHeight","sceneManager","SceneManager","resizeCanvas","onresize","threeEntryPoint","threeRootElement","className","ref","element","Component","App","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.8468d60c.chunk.js","sourcesContent":["//import * as BABYLON from \"@babylonjs/core\";\nimport * as BABYLON from 'babylonjs';\nimport * as CANNON from 'cannon';\n\n// Use physics viewer to display impostors\nlet getChildRotation = function(child){ //return the rotation of a child of a parent object by using a temporary World Matrix\n    var scale = new BABYLON.Vector3(0, 0, 0);\n    var rotation = new BABYLON.Quaternion();\n    var translation = new BABYLON.Vector3(0,0,0);\n\n    var tempWorldMatrix = child.getWorldMatrix();\n    tempWorldMatrix.decompose(scale, rotation, translation);\n    return rotation;\n}\n\nvar vmult = function(v,q){\n    var target =  new BABYLON.Vector3();\n \n    var x = v.x,\n        y = v.y,\n        z = v.z;\n \n    var qx = q.x,\n        qy = q.y,\n        qz = q.z,\n        qw = q.w;\n \n    // q*v\n    var ix =  qw * x + qy * z - qz * y,\n    iy =  qw * y + qz * x - qx * z,\n    iz =  qw * z + qx * y - qy * x,\n    iw = -qx * x - qy * y - qz * z;\n \n    target.x = ix * qw + iw * -qx + iy * -qz - iz * -qy;\n    target.y = iy * qw + iw * -qy + iz * -qx - ix * -qz;\n    target.z = iz * qw + iw * -qz + ix * -qy - iy * -qx;\n \n    return target;\n};\nvar vectorToWorldFrame = function(localVector, quaternion){\n    var result = new BABYLON.Vector3();\n    result = vmult(localVector, quaternion);\n    return result;\n};\nvar pointToWorldFrame = function(localPoint,quaternion, position){\n    var result = new BABYLON.Vector3();\n    result = vmult(localPoint,quaternion);\n    result = result.add(position); //temp fix for v5 update\n    return result;\n};\n\n/*var applyLocalForce = function(localForce, localPoint, mesh){\n    var worldForce = new BABYLON.Vector3();\n    var worldPoint = new BABYLON.Vector3();\n \n    // Transform the force vector to world space\n    worldForce = vectorToWorldFrame(localForce, mesh.rotationQuaternion);\n    worldPoint = pointToWorldFrame(localPoint, mesh.rotationQuaternion, mesh.getAbsolutePosition());\n    mesh.physicsImpostor.applyForce(worldForce, worldPoint);\n};*/\nvar applyLocalForce = function(localForce, localPoint, body){\n\n    body.applyLocalForce(new CANNON.Vec3(localForce.x, localForce.y, localForce.z),\n                         new CANNON.Vec3(localPoint.x, localPoint.y, localPoint.z));\n\n};\n/*var applyLocalForce = function(localForce, localPoint, body){\n    var worldForce = new BABYLON.Vector3();\n    var worldPoint = new BABYLON.Vector3();\n \n    // Transform the force vector to world space\n    worldForce = vectorToWorldFrame(localForce, new BABYLON.Quaternion(body.quaternion.x, body.quaternion.y, body.quaternion.z,body.quaternion.w ));\n    worldPoint = pointToWorldFrame(localPoint, new BABYLON.Quaternion(body.quaternion.x, body.quaternion.y, body.quaternion.z,body.quaternion.w ),\n         new CANNON.Vec3(body.position.x,body.position.y,body.position.z));\n    body.applyForce(\n        new CANNON.Vec3( worldForce.x,worldForce.y,worldForce.z), \n        new CANNON.Vec3( worldPoint.x, worldPoint.y, worldPoint.z));\n};*/\nclass Airplane {\n    /**    \n     * Projects a point to a plane along a ray starting from the camera origin and directed towards the point. \n     * @param {BABYLON.Scene} scene      \n     * @param {BABYLON.Mesh} chassis\n     *  @param {{ rotor: BABYLON.Mesh,rudder: BABYLON.Mesh,leftAileron: BABYLON.Mesh,rightAileron: BABYLON.Mesh,leftElevator: BABYLON.Mesh,rightElevator: BABYLON.Mesh} }controls\n     *  \n     */\n    constructor(scene, chassis, controls){\n        this.scene = scene;\n        if(!chassis) console.error(\"chassis mesh error\");\n        if(!controls) console.error(\"controls data error\");\n        //this.animationGroup = null;\n        this._lift = 50;\n        this._roll = 0;\n        this._rollLimit = 2;\n        this._yaw = 0;\n        this._yawLimit = 2;\n        this._pitch = 0;\n        this._pitchLimit = 2;\n        this._velocity = 0;     // 3 axis\n        this._currentSpeed = 0; // 1 axis\n        this._enginePower = 0;\n        this._enginePowerLimit = 1;//1\n        this.enginePowerPrev = 0\n        this.speedModifier = 0.03;\n        this.collision = chassis;\n        this.rudder = controls.rudder;\n        this.rotor = controls.rotor;\n        this.leftAileron = controls.leftAileron;\n        this.rightAileron = controls.rightAileron;\n        this.leftElevator = controls.leftElevator;\n        this.rightElevator = controls.rightElevator;\n        this._relativeBody = null;\n        this._isTouchingGround = false;\n        this.addAnimations();\n        this.animationGroup.play(false);\n        this.animationGroup.speedRatio = 1;\n        this.controlsInitialize();\n        this.registerForces();\n    }\n\n    set lift(val){\n        this._lift = val;\n    }\n    get lift(){\n        return this._lift;\n    }\n    set roll(val){\n        if (val > this._rollLimit) val = this._rollLimit;\n        if (val < -this._rollLimit ) val = -this._rollLimit;\n        this._roll = val;\n    }\n    get roll(){\n        return this._roll;\n    }\n    set yaw(val){\n        if (val > this._yawLimit) val = this._yawLimit;\n        if (val < -this._yawLimit ) val = -this._yawLimit;\n        this._yaw = val;\n    }\n    get yaw(){\n        return this._yaw;\n    }\n    set pitch(val){\n        if (val > this._pitchLimit) val = this._pitchLimit;\n        if (val < -this._pitchLimit ) val = -this._pitchLimit;\n        this._pitch = val;\n    }\n    get pitch(){\n        return this._pitch;\n    }\n    set enginePower(val){\n        if (val > this._enginePowerLimit) val = this._enginePowerLimit;\n        if (val < 0 ) val = 0;\n        this._enginePower = val;\n    }\n    get enginePower(){\n        return this._enginePower;\n    }\n    get velocity(){ \n        var velocity = vmult(\n            this.collision.physicsImpostor.getLinearVelocity(),\n            BABYLON.Quaternion.Inverse(this.collision.rotationQuaternion));\n        return velocity;\n    }\n    get currentSpeed(){\n\t\t//const velocity = body.quaternion.inverse().vmult(body.velocity);\n\t\t//const currentSpeed = velocity.z;\n        return 0;\n    }\n    get rotation(){\n        return this.collision.rotationQuaternion.toEulerAngles();\n    }\n    set relativeBody(mesh){\n        this._relativeBody = mesh;\n    }\n    get relativeBody(){\n        return this._relativeBody;\n    }\n    set isTouchingGround(touching){\n        this._isTouchingGround= touching;\n    }\n    get isTouchingGround(){\n        return this._isTouchingGround;\n    }\n\n    rotorSpin(rotor){\n        rotor.rotation = new BABYLON.Vector3(0,  0, Math.PI/2,);\n        //rotor.rotation = new BABYLON.Vector3(0, Math.PI/2, 0);\n        const animWheel = new BABYLON.Animation(\"wheelAnimation\", \"rotation.z\", 15, BABYLON.Animation.ANIMATIONTYPE_FLOAT, BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE);\n        this.animationGroup = new BABYLON.AnimationGroup(\"airplane\");\n        const wheelKeys = []; \n        var enginePower = 1;\n        //At the animation key 0, the value of rotation.y is 0\n        wheelKeys.push({\n            frame: 0,\n            value: 0\n        });\n        //At the animation key 30, (after 1 sec since animation fps = 30) the value of rotation.y is 2PI for a complete rotation\n        wheelKeys.push({\n            frame: 15,\n            value: enginePower*(-2 * Math.PI)\n        });\n        //set the keys\n        animWheel.setKeys(wheelKeys);    \n        //Link this animation to a wheel\n        rotor.animations = [];\n        rotor.animations.push(animWheel);\n        this.animationGroup.addTargetedAnimation(animWheel,rotor );\n      }\n    addAnimations(){\n        this.rotorSpin(this.rotor);\n    }\n    controlsInitialize(){\n        this.rudderZeroRotation = new BABYLON.Quaternion();\n        this.leftAileronZeroRotation = new BABYLON.Quaternion();\n        this.rightAileronZeroRotation = new BABYLON.Quaternion();\n        this.leftElevatorZeroRotation = new BABYLON.Quaternion();\n        this.rightElevatorZeroRotation = new BABYLON.Quaternion();\n\n        this.rudderZeroRotation.copyFrom(this.rudder.rotationQuaternion);\n        this.leftAileronZeroRotation.copyFrom(this.leftAileron.rotationQuaternion);\n        this.rightAileronZeroRotation.copyFrom(this.rightAileron.rotationQuaternion);\n        this.leftElevatorZeroRotation.copyFrom(this.leftElevator.rotationQuaternion);\n        this.rightElevatorZeroRotation.copyFrom(this.rightElevator.rotationQuaternion);\n        \n    }\n    meshRootPosition(x,y,z){       \n        this.collision.setAbsolutePosition(x,y,z); \n    }\n    rudderControl(rot){\n        this.rudder.rotationQuaternion.copyFrom(this.rudderZeroRotation);\n        this.rudder.rotate(BABYLON.Vector3.Up(), rot);\n    }\n\n    aileronControl(rot){\n        this.leftAileron.rotationQuaternion.copyFrom(this.leftAileronZeroRotation);\n        this.leftAileron.rotate(BABYLON.Vector3.Left(), rot);\n        this.rightAileron.rotationQuaternion.copyFrom(this.rightAileronZeroRotation);\n        this.rightAileron.rotate(BABYLON.Vector3.Left(), -rot);\n    }\n    elevatorControl(rot){\n        this.leftElevator.rotationQuaternion.copyFrom(this.leftElevatorZeroRotation);\n        this.leftElevator.rotate(BABYLON.Vector3.Left(), rot);\n        this.rightElevator.rotationQuaternion.copyFrom(this.rightElevatorZeroRotation);\n        this.rightElevator.rotate(BABYLON.Vector3.Left(), rot);\n    }\n    applyLiftForce(){\n        let lift = this.velocity.z * Math.abs(this.velocity.z) * 1.5;\n        applyLocalForce(new BABYLON.Vector3(0,lift, 0), new BABYLON.Vector3(0, 0, 0), this.collision);\n    }\n    applyDragForce(){\n        var velocity = this.velocity;\n        applyLocalForce(new BABYLON.Vector3(\n            velocity.x * Math.abs(velocity.x) * -20,    //20\n            velocity.y * Math.abs(velocity.y) * -100,   //-100\n            velocity.z * Math.abs(velocity.z) * -1      //-1\n            ), new BABYLON.Vector3(0, 0, -0.02), this.collision); //-0.02\n    }\n    applyThrustForce(){\n        applyLocalForce(new BABYLON.Vector3( 0, 0, 3000 * this.speedModifier * this.enginePower), new BABYLON.Vector3(0, 0, 1), this.collision);\n    }\n    applyRollForce(dir){\n        if (dir) {\n            applyLocalForce(new BABYLON.Vector3(0, dir*5 * -this.velocity.z, 0), new BABYLON.Vector3(1, 0, 0), this.collision);\n            applyLocalForce(new BABYLON.Vector3(0, dir*5 * this.velocity.z, 0), new BABYLON.Vector3(-1, 0, 0), this.collision);\n        }\n    }\n    applyYawForce(dir){\n        if (dir) applyLocalForce(new BABYLON.Vector3( dir*5 * this.velocity.z, 0 , 0), new BABYLON.Vector3(0, 0, -1), this.collision);\n    }\n    applyPitchForce(dir){\n        if (dir) applyLocalForce(new BABYLON.Vector3( 0, 5*dir*this.velocity.z , 0), new BABYLON.Vector3(0, 0, -1), this.collision);       \n    }\n    applyPitchYawForce(pitchForce, YawForce){\n        if (pitchForce || YawForce) applyLocalForce(new BABYLON.Vector3( YawForce*5 * this.velocity.z, 5*pitchForce*this.velocity.z , 0), new BABYLON.Vector3(0, 0, -1), this.collision); \n    }\n    propellerSpeedUpdate(){\n        if (this.enginePowerPrev !== this.enginePower){\n            if(this.enginePower) this.animationGroup.play(true); else this.animationGroup.play(false);\n            this.animationGroup.speedRatio = this.enginePower*4;\n        }\n        this.enginePowerPrev = this.enginePower;\n    }\n    resetControls(){\n        this.aileronControl(this.roll*Math.PI/8);\n        this.rudderControl(-this.yaw*Math.PI/8);\n        this.elevatorControl(-this.pitch*Math.PI/8);\n        this.pitch = 0;\n        this.yaw = 0;\n        this.roll = 0;\n    }\n    applyRelativeBodyForce(){\n        var frameTime = Date.now();\n        var prevFrameTime = frameTime;\n        var delta = frameTime - prevFrameTime;\n        var force = new BABYLON.Vector3(0,0,0);\n        if(this.relativeBody && this.isTouchingGround){\n            //console.log(\"relative force\");\n            /*frameTime = Date.now();\n            delta = frameTime - prevFrameTime;\n    \n            var relativeVelocity = this.relativeBody.getPhysicsImpostor().getLinearVelocity();\n            //var ms = this.relativeBody.getPhysicsImpostor().mass;\n            const coeff = 1*this.relativeBody.getPhysicsImpostor().mass/delta;\n            force = force.copyFrom(relativeVelocity);\n            force = force.multiplyByFloats(coeff,coeff,coeff);\n\n            var worldPoint = new BABYLON.Vector3();\n            worldPoint = pointToWorldFrame(new BABYLON.Vector3(0,0,0), this.collision.rotationQuaternion, this.collision.getAbsolutePosition());\n            this.collision.physicsImpostor.applyForce(force, worldPoint);*/\n        }\n    }\n    registerForces(){\n        var that = this;\n        //this.scene.registerBeforeRender(function () {\n        this.scene.onBeforeRenderObservable.add(() => {\n            that.applyRollForce(that.roll);\n            //that.applyYawForce(that.yaw);\n            //that.applyPitchForce(that.pitch);\n            that.applyPitchYawForce(that.pitch, that.yaw);\n            that.applyDragForce();\n            that.applyLiftForce(); \n            that.applyThrustForce();\n            that.propellerSpeedUpdate();\n            //that.applyRelativeBodyForce();\n            that.resetControls();\n        });\n    }\n\n    \n}\n/////////// CANON ///////////\nexport default class AirplaneCannon {\n    /**    \n     * Projects a point to a plane along a ray starting from the camera origin and directed towards the point. \n     * @param {BABYLON.Scene} scene      \n     * @param {BABYLON.Mesh} chassis\n     *  @param {{ rotor: BABYLON.Mesh,rudder: BABYLON.Mesh,leftAileron: BABYLON.Mesh,rightAileron: BABYLON.Mesh,leftElevator: BABYLON.Mesh,rightElevator: BABYLON.Mesh} }controls\n     *  \n     */\n    constructor(scene, chassis, controls){\n        this.scene = scene;\n        if(!chassis) console.error(\"chassis mesh error\");\n        if(!controls) console.error(\"controls data error\");\n        //this.animationGroup = null;\n        this._lift = 50;\n        this._roll = 0;\n        this._rollLimit = 2;\n        this._yaw = 0;\n        this._yawLimit = 2;\n        this._pitch = 0;\n        this._pitchLimit = 2;\n        this._velocity = 0;     // 3 axis\n        this._currentSpeed = 0; // 1 axis\n        this._enginePower = 0;\n        this._enginePowerLimit = 1;//1\n        this.enginePowerPrev = 0\n        this.speedModifier = 0.03;\n        this.collision = chassis;\n        this.rudder = controls.rudder;\n        this.rotor = controls.rotor;\n        this.leftAileron = controls.leftAileron;\n        this.rightAileron = controls.rightAileron;\n        this.leftElevator = controls.leftElevator;\n        this.rightElevator = controls.rightElevator;\n        this._relativeBody = null;\n        this._isTouchingGround = false;\n        this.addAnimations();\n        this.animationGroup.play(false);\n        this.animationGroup.speedRatio = 1;\n        this.controlsInitialize();\n        this.registerForces();\n        //console.log(\"cb=\", this.collision);\n    }\n\n    set lift(val){\n        this._lift = val;\n    }\n    get lift(){\n        return this._lift;\n    }\n    set roll(val){\n        if (val > this._rollLimit) val = this._rollLimit;\n        if (val < -this._rollLimit ) val = -this._rollLimit;\n        this._roll = val;\n    }\n    get roll(){\n        return this._roll;\n    }\n    set yaw(val){\n        if (val > this._yawLimit) val = this._yawLimit;\n        if (val < -this._yawLimit ) val = -this._yawLimit;\n        this._yaw = val;\n    }\n    get yaw(){\n        return this._yaw;\n    }\n    set pitch(val){\n        if (val > this._pitchLimit) val = this._pitchLimit;\n        if (val < -this._pitchLimit ) val = -this._pitchLimit;\n        this._pitch = val;\n    }\n    get pitch(){\n        return this._pitch;\n    }\n    set enginePower(val){\n        if (val > this._enginePowerLimit) val = this._enginePowerLimit;\n        if (val < 0 ) val = 0;\n        this._enginePower = val;\n    }\n    get enginePower(){\n        return this._enginePower;\n    }\n    get velocity(){ \n        var velocity = vmult(\n            //this.collision.physicsImpostor.getLinearVelocity(),\n            new BABYLON.Vector3(this.collision.velocity.x,\n                                this.collision.velocity.y,\n                                this.collision.velocity.z),\n            BABYLON.Quaternion.Inverse(new BABYLON.Quaternion(  this.collision.quaternion.x,\n                this.collision.quaternion.y,\n                this.collision.quaternion.z,\n                this.collision.quaternion.w,\n                )));\n        return velocity;\n    }\n    get currentSpeed(){\n\t\t//const velocity = body.quaternion.inverse().vmult(body.velocity);\n\t\t//const currentSpeed = velocity.z;\n        return 0;\n    }\n    get rotation(){\n        return new BABYLON.Quaternion(  this.collision.quaternion.x,\n                                        this.collision.quaternion.y,\n                                        this.collision.quaternion.z,\n                                        this.collision.quaternion.w,\n                                        ).toEulerAngles();\n    }\n    set relativeBody(mesh){\n        this._relativeBody = mesh;\n    }\n    get relativeBody(){\n        return this._relativeBody;\n    }\n    set isTouchingGround(touching){\n        this._isTouchingGround= touching;\n    }\n    get isTouchingGround(){\n        return this._isTouchingGround;\n    }\n\n    rotorSpin(rotor){\n        rotor.rotation = new BABYLON.Vector3(0,  0, Math.PI/2,);\n        //rotor.rotation = new BABYLON.Vector3(0, Math.PI/2, 0);\n        const animWheel = new BABYLON.Animation(\"wheelAnimation\", \"rotation.z\", 15, BABYLON.Animation.ANIMATIONTYPE_FLOAT, BABYLON.Animation.ANIMATIONLOOPMODE_CYCLE);\n        this.animationGroup = new BABYLON.AnimationGroup(\"airplane\");\n        const wheelKeys = []; \n        var enginePower = 1;\n        //At the animation key 0, the value of rotation.y is 0\n        wheelKeys.push({\n            frame: 0,\n            value: 0\n        });\n        //At the animation key 30, (after 1 sec since animation fps = 30) the value of rotation.y is 2PI for a complete rotation\n        wheelKeys.push({\n            frame: 15,\n            value: enginePower*(-2 * Math.PI)\n        });\n        //set the keys\n        animWheel.setKeys(wheelKeys);    \n        //Link this animation to a wheel\n        rotor.animations = [];\n        rotor.animations.push(animWheel);\n        this.animationGroup.addTargetedAnimation(animWheel,rotor );\n      }\n    addAnimations(){\n        this.rotorSpin(this.rotor);\n    }\n    controlsInitialize(){\n        this.rudderZeroRotation = new BABYLON.Quaternion();\n        this.leftAileronZeroRotation = new BABYLON.Quaternion();\n        this.rightAileronZeroRotation = new BABYLON.Quaternion();\n        this.leftElevatorZeroRotation = new BABYLON.Quaternion();\n        this.rightElevatorZeroRotation = new BABYLON.Quaternion();\n\n        this.rudderZeroRotation.copyFrom(this.rudder.rotationQuaternion);\n        this.leftAileronZeroRotation.copyFrom(this.leftAileron.rotationQuaternion);\n        this.rightAileronZeroRotation.copyFrom(this.rightAileron.rotationQuaternion);\n        this.leftElevatorZeroRotation.copyFrom(this.leftElevator.rotationQuaternion);\n        this.rightElevatorZeroRotation.copyFrom(this.rightElevator.rotationQuaternion);\n        \n    }\n    meshRootPosition(x,y,z){       \n        this.collision.position.set(x,y,z); \n    }\n    rudderControl(rot){\n        this.rudder.rotationQuaternion.copyFrom(this.rudderZeroRotation);\n        this.rudder.rotate(BABYLON.Vector3.Up(), rot);\n    }\n\n    aileronControl(rot){\n        this.leftAileron.rotationQuaternion.copyFrom(this.leftAileronZeroRotation);\n        this.leftAileron.rotate(BABYLON.Vector3.Left(), rot);\n        this.rightAileron.rotationQuaternion.copyFrom(this.rightAileronZeroRotation);\n        this.rightAileron.rotate(BABYLON.Vector3.Left(), -rot);\n    }\n    elevatorControl(rot){\n        this.leftElevator.rotationQuaternion.copyFrom(this.leftElevatorZeroRotation);\n        this.leftElevator.rotate(BABYLON.Vector3.Left(), rot);\n        this.rightElevator.rotationQuaternion.copyFrom(this.rightElevatorZeroRotation);\n        this.rightElevator.rotate(BABYLON.Vector3.Left(), rot);\n    }\n    applyLiftForce(){\n        let lift = this.velocity.z * Math.abs(this.velocity.z) * 1.5;\n        applyLocalForce(new BABYLON.Vector3(0,lift, 0), new BABYLON.Vector3(0, 0, 0), this.collision);\n    }\n    applyDragForce(){\n        var velocity = this.velocity;\n        applyLocalForce(new BABYLON.Vector3(\n            velocity.x * Math.abs(velocity.x) * -20,    //20\n            velocity.y * Math.abs(velocity.y) * -100,   //-100\n            velocity.z * Math.abs(velocity.z) * -1      //-1\n            ), new BABYLON.Vector3(0, 0, -0.02), this.collision); //-0.02\n    }\n    applyThrustForce(){\n        applyLocalForce(new BABYLON.Vector3( 0, 0, 3000 * this.speedModifier * this.enginePower), new BABYLON.Vector3(0, 0, 1), this.collision);\n    }\n    applyRollForce(dir){\n        if (dir) {\n            applyLocalForce(new BABYLON.Vector3(0, dir*5 * -this.velocity.z, 0), new BABYLON.Vector3(1, 0, 0), this.collision);\n            applyLocalForce(new BABYLON.Vector3(0, dir*5 * this.velocity.z, 0), new BABYLON.Vector3(-1, 0, 0), this.collision);\n        }\n    }\n    applyYawForce(dir){\n        if (dir) applyLocalForce(new BABYLON.Vector3( dir*5 * this.velocity.z, 0 , 0), new BABYLON.Vector3(0, 0, -1), this.collision);\n    }\n    applyPitchForce(dir){\n        if (dir) applyLocalForce(new BABYLON.Vector3( 0, 5*dir*this.velocity.z , 0), new BABYLON.Vector3(0, 0, -1), this.collision);       \n    }\n    applyPitchYawForce(pitchForce, YawForce){\n        if (pitchForce || YawForce) applyLocalForce(new BABYLON.Vector3( YawForce*5 * this.velocity.z, 5*pitchForce*this.velocity.z , 0), new BABYLON.Vector3(0, 0, -1), this.collision); \n    }\n    propellerSpeedUpdate(){\n        if (this.enginePowerPrev !== this.enginePower){\n            if(this.enginePower) this.animationGroup.play(true); else this.animationGroup.play(false);\n            this.animationGroup.speedRatio = this.enginePower*4;\n        }\n        this.enginePowerPrev = this.enginePower;\n    }\n    resetControls(){\n        this.aileronControl(this.roll*Math.PI/8);\n        this.rudderControl(-this.yaw*Math.PI/8);\n        this.elevatorControl(-this.pitch*Math.PI/8);\n        this.pitch = 0;\n        this.yaw = 0;\n        this.roll = 0;\n    }\n    registerForces(){\n        var that = this;\n        //this.scene.registerBeforeRender(function () {\n        this.scene.onBeforeRenderObservable.add(() => {\n            that.applyRollForce(that.roll);\n            that.applyPitchYawForce(that.pitch, that.yaw);\n            that.applyDragForce();\n            that.applyLiftForce(); \n            that.applyThrustForce();\n            that.propellerSpeedUpdate();\n            that.resetControls();\n        });\n    }\n\n    \n}\n","import * as BABYLON from 'babylonjs';\n//import * as Ammo from 'ammojs';\nimport * as CANNON from 'cannon';\nimport { Vector3 } from 'yuka';\n//import * as CANNON from 'cannon';\nclass VehicleData {\n    constructor(scene){\n        this._scene = scene;\n        this._chassisMesh = null;\n        this._wheelsMesh = [];\n        this._powerWheelsIndex = [];\n        this._steeringWheelsIndex = [];\n        this._brakeWheelsIndex = [];    \n    }\n    get scene(){\n        return this._scene;\n    }\n    set scene(s){\n        this._scene = s;\n    }\n    get chassisMesh(){\n        return this._chassisMesh;\n    }\n    set chassisMesh(mesh){\n        this._chassisMesh = mesh;\n    }\n    get wheelsMesh(){\n        return this._wheelsMesh;\n    }\n    set wheelsMesh(mesh){\n        this._wheelsMesh = mesh;\n    }\n    get powerWheelsIndex(){\n        return this._powerWheelsIndex;\n    }\n    set powerWheelsIndex(indices){\n        this._powerWheelsIndex = indices;\n    }\n    get steeringWheelsIndex(){\n        return this._steeringWheelsIndex;\n    }\n    set steeringWheelsIndex(indices){\n        this._steeringWheelsIndex = indices;\n    }\n    get brakeWheelsIndex(){\n        return this._brakeWheelsIndex;\n    }\n    set brakeWheelsIndex(indices){\n        this._brakeWheelsIndex = indices;\n    }\n}\n\nfunction makebox(scene, size, position, rotation, color = new BABYLON.Color3(0.5, 0.6, 0.87), name= \"box\"){\n    var box =  BABYLON.MeshBuilder.CreateBox(name, {width:size.x,depth:size.y,height:size.z}, scene);\n    box.rotationQuaternion = rotation;\n    box.position = position;\n    var myMaterial = new BABYLON.StandardMaterial(\"vehicleMassBox\", scene);\n    myMaterial.diffuseColor = new BABYLON.Color3(1, 0, 1);\n    myMaterial.specularColor = color;\n    myMaterial.emissiveColor = color;\n    box.material = myMaterial;\n    return box;\n} \n\nfunction createWheelMesh(scene, diameter, width, position){\n    //Wheel Material \n    var wheelMaterial = new BABYLON.StandardMaterial(\"wheelMaterial\", scene);\n    var wheelTexture = new BABYLON.Texture(\"http://i.imgur.com/ZUWbT6L.png\", scene);\n    wheelMaterial.diffuseTexture = wheelTexture;\n\n    //Set color for wheel tread as black\n    var faceColors = [];\n    faceColors[1] = new BABYLON.Color3(0, 0, 0);\n\n    //set texture for flat face of wheel \n    var faceUV = [];\n    faceUV[0] = new BABYLON.Vector4(0, 0, 1, 1);\n    faceUV[2] = new BABYLON.Vector4(0, 0, 1, 1);\n\n    //create wheel front inside and apply material\n    var wheelMesh = BABYLON.MeshBuilder.CreateCylinder(\"wheelMesh\", {\n        diameter: diameter,\n        height: width,\n        tessellation: 24,\n        faceColors: faceColors,\n        faceUV: faceUV\n    }, scene);\n    wheelMesh.material = wheelMaterial;\n\n    wheelMesh.rotateAround(\n        new BABYLON.Vector3(0,0,0),\n        new BABYLON.Vector3(0,0,1),\n        -Math.PI/2\n        );\n    wheelMesh.bakeCurrentTransformIntoVertices();\n    wheelMesh.position.addInPlace(position);\n    return wheelMesh;\n}\n\n\nexport class AirplaneWW2 extends VehicleData{\n    /**    \n     * Airplane mesh data and physics body\n     * @param {BABYLON.Scene} scene      \n     * @param {[BABYLON.Mesh]} meshAll\n     * @param {[BABYLON.Vector3]} position\n     * @param {[BABYLON.Vector3]} eulerRotation\n     */\n     constructor(scene, meshAll, position, eulerRotation){\n        super(scene);\n        if(!meshAll) console.error(\"airplane modlel mesh error\");\n        var scale = 1;\n        meshAll[0].translate(new BABYLON.Vector3.Up(),0.15,BABYLON.Space.WORLD);\n        meshAll[0].scaling= meshAll[0].scaling.multiplyByFloats(scale,scale,scale);// = new Vector3(1,1,1);\n        const massOffset = new BABYLON.Vector3(0, 0.2, 0.65).multiplyByFloats(scale,scale,scale);\n        const mass = 50;\n        const isColiderVisible = false;\n        var settings = {\n            suspensionStiffness: 47,//27\n            suspensionDamping: 0.3,//03\n            suspensionCompression: 4.4,//4.4\n            suspensionRestLength: 0.3,//0.3\n            rollInfluence: 0.01, //0.01\n        }\n        var rearWheelSettings = { ...settings };\n        rearWheelSettings.suspensionRestLength = 0.27;\n        this.wheelsMesh = [\n            meshAll[18], meshAll[19], meshAll[20]\n        ];  \n        this.wheelsMesh.forEach(m=>meshAll[0].removeChild(m));\n        meshAll[0].translate(new BABYLON.Vector3.Up(),0.75,BABYLON.Space.WORLD);\n\n        const radius = 0.225/2;//0.225/2;\n        // (widht, heigth, length) of a car\n        this.wheels =\n            [\n                {pos: this.wheelsMesh[0].position, radius: radius, isFront: true, params: settings},\n                {pos: this.wheelsMesh[1].position, radius: radius, isFront: true, params: settings},\n                {pos: this.wheelsMesh[2].position, radius: radius/2, isFront: false, params: rearWheelSettings},\n            ];\n        this.wheels.forEach(x=>x.pos.addInPlace(massOffset));\n\n        const bodySize = new BABYLON.Vector3(2, 2, 0.6).multiplyByFloats(scale,scale,scale);//0.3\n\n        //chassis offset only visual because of the root mass offset\n        //chassis is the volume that represents weight, its used for vehicle physisc but not collisions\n        var chassis = makebox(scene, bodySize, new BABYLON.Vector3(0, 1, 0).subtractInPlace(massOffset), new BABYLON.Vector3(0,0,0).toQuaternion(),new BABYLON.Color3(.1, .1, .1), \"chassis\");\n        chassis.isVisible = false;       \n        // body visuals\n        meshAll[0].removeChild(meshAll[11]);\n        this.visualMeshes = [meshAll[11]];//[rootVisualMesh];\n        //add all meshes to chassis\n        this.visualMeshes.forEach(vm=>{chassis.addChild(vm)});\n        this.visualMeshes[0].receiveShadows = true;\n        //optimization\n        this.visualMeshes[0].material.freeze();\n\n        this.controls = {   rotor: meshAll[17],\n                            rudder: meshAll[16],\n                            leftAileron: meshAll[12],\n                            rightAileron: meshAll[13],\n                            leftElevator: meshAll[15],\n                            rightElevator: meshAll[14]\n                        };   \n        Object.values( this.controls).forEach(m=>{\n            meshAll[0].removeChild(m);\n            chassis.addChild(m);\n        } );  \n        \n        /*this.collidersCreate(meshAll[0],chassis,\n                            [meshAll[1],meshAll[2], meshAll[3], meshAll[4], meshAll[5]],\n                            BABYLON.PhysicsImpostor.BoxImpostor,\n                            isColiderVisible);*/\n        /*this.collidersCreate(meshAll[0],chassis,\n                            [meshAll[6], meshAll[7], meshAll[8], meshAll[9], meshAll[10]],\n                            BABYLON.PhysicsImpostor.CapsuleImpostor,\n                            isColiderVisible);*/\n       // createPhysicsImpostor(this.scene, chassis, BABYLON.PhysicsImpostor.NoImpostor, { mass: mass, friction: 1,restitution:0.1}, true);\n        //console.log(\"body\", chassis.physicsImpostor.physicsBody);\n        //chassis.physicsImpostor.physicsBody.angularDamping = 0.6;//cannon\n        //chassis.physicsImpostor.physicsBody.setDamping(0.01, 0.6);\n        this.chassisBody = this.createBody(mass, new BABYLON.Vector3(1,0.3,1),new BABYLON.Vector3(0,0.1,-0.2));\n        this.powerWheelsIndex = [0,1];\n        this.steeringWheelsIndex = [2];\n        this.brakeWheelsIndex = [0,1,2];\n        this.chassisMesh = chassis;\n        meshAll[0].dispose();       //not needed anymore since we had do assign a new mesh root for raycast vehicle\n        var world = this.scene.getPhysicsEngine().getPhysicsPlugin().world;\n        this.chassisBody.position = new CANNON.Vec3(position.x, position.y, position.z);\n        var initRotation = eulerRotation.toQuaternion();\n        this.chassisBody.quaternion = new CANNON.Quaternion(initRotation.x,initRotation.y,initRotation.z,initRotation.w);\n        world.addBody(this.chassisBody);\n        \n        //console.log(world);\n        var that = this;\n        this.scene.registerBeforeRender(function () {\n            that.chassisMesh.position.copyFrom( new BABYLON.Vector3( that.chassisBody.position.x,\n                                                                     that.chassisBody.position.y,\n                                                                     that.chassisBody.position.z,\n                                                ));\n            //that.chassisMesh.rotation = new BABYLON.Quaternion(\n            that.chassisMesh.rotationQuaternion = new BABYLON.Quaternion(\n                that.chassisBody.quaternion.x,\n                that.chassisBody.quaternion.y,\n                that.chassisBody.quaternion.z,\n                that.chassisBody.quaternion.w\n            );\n        });\n    }\n    collidersCreate(oldRoot, newRoot, meshes, impostorType, isVisible){\n        var coliderMeshesBox = meshes;\n        coliderMeshesBox.forEach(m=>oldRoot.removeChild(m));\n        coliderMeshesBox.forEach(cm=>{\n            newRoot.addChild(cm);\n            cm.isVisible = isVisible;\n        });\n        coliderMeshesBox.forEach(cm=>{createPhysicsImpostor(this.scene, cm, impostorType, { mass: 0, friction: 1,restitution: 0.1}, true)});    //    restitution:0.1   \n    }\n    createBody(mass = 50, size, offset){\n        var chassisShape;\n        var mat = new CANNON.Material('Mat');\n\t\tmat.friction = 0.8;\n        chassisShape = new CANNON.Box(new CANNON.Vec3(size.x, size.y, size.z));\n        var chassisBody = new CANNON.Body({ mass: mass });\n        chassisBody.material = mat;\n        chassisBody.addShape(chassisShape, new CANNON.Vec3(offset.x, offset.y, offset.z));\n        chassisBody.angularDamping = 0.8;\n        return chassisBody;\n    }\n\n}\n\n\n\n\nfunction createPhysicsImpostor(scene, entity, impostor, options, reparent) {\n    if (entity == null) return;\n    entity.checkCollisions = false;\n    const parent = entity.parent;\n    if (reparent === true) entity.parent = null;\n    entity.physicsImpostor = new BABYLON.PhysicsImpostor(entity, impostor, options, scene);\n    //console.log(entity.physicsImpostor.physicsBody);\n    if (reparent === true) entity.parent = parent;\n};\n\nBABYLON.Mesh.prototype.getAbsoluteSize = function() {\n    if(!this.__size){\n        this.__size = BABYLON.Vector3.Zero();\n    }\n    let scaling = this.scaling;\n    //console.log(scaling);\n    let bounds = this.getBoundingInfo();\n    this.__size.x = Math.abs(bounds.minimum.x - bounds.maximum.x)*scaling.x;\n    this.__size.z = Math.abs(bounds.minimum.y - bounds.maximum.y)*scaling.y;\n    this.__size.y = Math.abs(bounds.minimum.z - bounds.maximum.z)*scaling.z;\n\n    return this.__size;\n};","import * as BABYLON from 'babylonjs';\nimport * as GUI from 'babylonjs-gui';\n\nclass hudControl {\n    constructor( x, y){\n       this._x = x;\n       this._y = y;\n    }\n   set x(x){\n       this._x = x;\n   }\n   get x(){\n       return this._x;\n   }\n   set y(y){\n       this._y = y;\n   }\n   get y(){\n       return this._y;\n   }\n    draw(){\n\n    }\n}\n\nexport class crosshair extends hudControl{\n    constructor( width, height) {\n        super(width / 2,height / 2);\n        this.width = width;\n        this.height = height;\n        this.lines = [new GUI.Line(),new GUI.Line()];\n        this.lines.forEach(line=>{\n            line.lineWidth = 2;\n            line.color = \"green\";\n        });\n\n    }\n\n    draw(){\n        // remove aliasing\n        this.x = Math.floor(this.x) + 0.5;\n        this.y = Math.floor(this.y) + 0.5;\n\n        this.lines[0].x1 = this.x;\n        this.lines[0].y1 = this.y - 10;\n        this.lines[0].x2 = this.x;\n        this.lines[0].y2 = this.y + 10;\n\n        this.lines[1].x1 = this.x - 10;\n        this.lines[1].y1 = this.y;\n        this.lines[1].x2 = this.x + 10;\n        this.lines[1].y2 = this.y;\n\n    }\n  }\n\n  export class hudSimpleText extends hudControl{\n    constructor( x, y, fontSize =12) {\n        super(x,y);\n        this.txt = \"hello...\"\n        this.fontSize = fontSize;\n        this.element = new GUI.TextBlock();\n        this.element.top = x;\n        this.element.left = y;\n        this.element.color = \"green\";\n        this.element.fontSize = fontSize;\n        this.element.height = \"30px\";\n    }\n    set text(txt){\n        this.element.text = txt;\n    }\n    draw(){\n\n    }\n  }\n//////////\nfunction range(start, end, inc) {\n    //console.log(start,end);\n    return Array(end/inc - (start/inc) + 1).fill().map((_, idx) => start+ idx*inc);\n  }\n  function limitCompass(x){\n    if(x<0) x = x+ 360;\n    if(x>359) x = x -360;\n    return x;\n  }\n  function limitPitchLadder(x){\n    if(x<-90) x = -180-x;\n    if(x>90) x = 180-x ;\n    return x;\n  }\n  function rangeClip(rangeArray,limit){\n    return rangeArray.map(x=>limit(x));\n  }\n  /*function rangeClip360(rangeArray){\n    return rangeArray.map(x=>limit(x));\n  }*/\nexport class compass extends hudControl{\n    constructor( width, height, tickSpace =40, rangeC = 4) {   \n        super(width/2- 40*(4/2),height / 7);\n        this.tickSpace = tickSpace;\n        this._range = rangeC;\n        //this.middle =  this.tickSpace*(this._range/2);\n        this.middle = width/2;\n        this.width = width;\n        this.height = height;\n        this.tilt = 0;\n        this.tickHeight = 15;\n        \n        this.scale = 10;\n        //this.scaleVals = range(10/this.scale,50/this.scale,this.scale);\n        //console.log(this.scaleVals);\n        this.x = Math.floor(this.x) + 0.5;\n        this.y = Math.floor(this.y) + 0.5;\n        const fontSize = 12;\n        this.elements = [];//new GUI.Line()\n        this.elements.push(new GUI.TextBlock());\n        this.elements[this.elements.length-1].color = \"green\";\n        this.elements[this.elements.length-1].fontSize = fontSize;\n        this.elements[this.elements.length-1].height = \"10px\";\n        this.elements[this.elements.length-1].width = \"20px\";\n        this.elements[this.elements.length-1].horizontalAlignment = GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;\n        this.elements[this.elements.length-1].verticalAlignment = GUI.Control.VERTICAL_ALIGNMENT_TOP;\n        this.elements.push(new GUI.Line());\n        this.elements[this.elements.length-1].lineWidth = 2;\n        this.elements[this.elements.length-1].color = \"green\";\n\n        this.scaleVals = range(\n            Math.floor(this.tilt/this.scale)*this.scale-Math.floor(this.scale*this._range/2),\n            Math.floor(this.tilt/this.scale)*this.scale+ Math.floor(this.scale*this._range/2),\n            this.scale);\n        this.scaleVals = rangeClip(this.scaleVals,limitCompass);\n        this.scaleVals.forEach((x,i)=>{\n            this.elements.push(new GUI.TextBlock());\n            this.elements[this.elements.length-1].color = \"green\";\n            this.elements[this.elements.length-1].fontSize = fontSize;\n            this.elements[this.elements.length-1].height = \"10px\";\n            this.elements[this.elements.length-1].width = \"20px\";\n            this.elements[this.elements.length-1].horizontalAlignment = GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;\n            this.elements[this.elements.length-1].verticalAlignment = GUI.Control.VERTICAL_ALIGNMENT_TOP;\n            this.elements.push(new GUI.Line());\n            this.elements[this.elements.length-1].lineWidth = 2;\n            this.elements[this.elements.length-1].color = \"green\";\n            this.elements.push(new GUI.Line());\n            this.elements[this.elements.length-1].lineWidth = 2;\n            this.elements[this.elements.length-1].color = \"green\";\n        });  \n        //console.log(this.elements.length);\n    }\n    set angle(angle){\n        this.tilt = angle;\n    }\n    set range(range){\n        this._range = range;\n    }\n    set rangeScale(rangeScale){\n        this.scale = rangeScale;\n    }\n    draw(){\n        var tiltFloor = Math.floor(this.tilt);\n        var tiltRemd = Math.floor(this.tilt * 10/this.scale) % 10;\n        var tiltRemdHalf = Math.floor((this.tilt/this.scale+0.5) * 10) % 10;\n        this.scaleVals = range(\n            Math.floor(this.tilt/this.scale)*this.scale-Math.floor(this.scale*this._range/2),\n            Math.floor(this.tilt/this.scale)*this.scale+ Math.floor(this.scale*this._range/2),\n            this.scale);\n        this.scaleVals = rangeClip(this.scaleVals,limitCompass);\n        this.tilt = tiltFloor + tiltRemd/10;\n\n        var elemIdx = 2;\n        var space = this.x-tiltRemd*this.tickSpace/10;\n        var spaceHalf = this.x-tiltRemdHalf*this.tickSpace/10;\n        this.scaleVals.forEach((val,idx)=>{\n            this.elements[elemIdx].left = space-5;\n            this.elements[elemIdx].top = this.y-this.tickHeight-10;\n            this.elements[elemIdx].text = val.toString();\n            elemIdx = elemIdx +1;\n            this.elements[elemIdx].x1 = space;\n            this.elements[elemIdx].y1 = this.y;\n            this.elements[elemIdx].x2 = space;\n            this.elements[elemIdx].y2 = this.y-this.tickHeight;\n            elemIdx = elemIdx +1;\n            this.elements[elemIdx].x1 = spaceHalf;\n            this.elements[elemIdx].y1 = this.y;\n            this.elements[elemIdx].x2 = spaceHalf;\n            this.elements[elemIdx].y2 = this.y-this.tickHeight/2;\n            elemIdx = elemIdx +1;\n            space += this.tickSpace;\n            spaceHalf += this.tickSpace;\n        });\n        this.elements[0].left = this.middle;\n        this.elements[0].top = this.y+15;\n        this.elements[0].text = tiltFloor.toString();\n        this.elements[1].x1 = this.middle;\n        this.elements[1].y1 = this.y+15;\n        this.elements[1].x2 = this.middle;\n        this.elements[1].y2 = this.y+15 -this.tickHeight;\n        //console.log(\"location\",this.middle + 4, this.y+15);\n    }\n}\n\nexport class pitchLader extends hudControl {\n    constructor(width, height){\n        super(0,0);\n        this.width = width;\n        this.height = height;\n        const containerWidth = 200;\n        const containerHeight = 200;\n        this.middle = containerWidth/2;//width/2;\n        this.tilt = 0;\n        this.rot = 0;\n        this.tickHeight = 100;\n        this.tickSpace = 40;\n        this.scale = 10;\n        this._range = 4;\n        this.middleOffset = containerHeight-(containerHeight -this.tickSpace*this._range)/2;//this.tickSpace*this._range;//height -(height - this.tickSpace*this._range )/2;\n        const fontSize = 12;\n        this.elements = [];\n        this.scaleVals = range(\n            Math.floor(this.tilt/this.scale)*this.scale - Math.floor(this.scale*this._range/2),\n            Math.floor(this.tilt/this.scale)*this.scale + Math.floor(this.scale*this._range/2),\n            this.scale);\n        this.scaleVals = rangeClip(this.scaleVals, limitPitchLadder);\n        this.scaleVals.forEach((x,i)=>{\n            this.elements.push(new GUI.TextBlock());\n            this.elements[this.elements.length-1].color = \"green\";\n            this.elements[this.elements.length-1].fontSize = fontSize;\n            this.elements[this.elements.length-1].height = \"10px\";\n            this.elements[this.elements.length-1].width = \"20px\";\n            this.elements[this.elements.length-1].horizontalAlignment = GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;\n            this.elements[this.elements.length-1].verticalAlignment = GUI.Control.VERTICAL_ALIGNMENT_TOP;\n            this.elements.push(new GUI.Line());\n            this.elements[this.elements.length-1].lineWidth = 2;\n            this.elements[this.elements.length-1].color = \"green\";\n            this.elements.push(new GUI.Line());\n            this.elements[this.elements.length-1].lineWidth = 2;\n            this.elements[this.elements.length-1].color = \"green\";\n            this.elements.push(new GUI.Line());\n            this.elements[this.elements.length-1].lineWidth = 2;\n            this.elements[this.elements.length-1].color = \"green\";\n            this.elements.push(new GUI.Line());\n            this.elements[this.elements.length-1].lineWidth = 2;\n            this.elements[this.elements.length-1].color = \"green\";\n        }); \n        this.root = new GUI.Rectangle();\n        this.root.verticalAlignment = GUI.Control.VERTICAL_ALIGNMENT_TOP;\n        this.root.horizontalAlignment = GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;\n        this.root.widthInPixels = containerWidth;\n        this.root.heightInPixels = containerHeight;\n        this.root.left = width/2 - containerWidth/2;\n        this.root.top = (height -(height - containerHeight )/2) -containerHeight;\n        this.root.thickness = 1; \n        //this.root.addControl(line);\n        this.elements.forEach(el=>this.root.addControl(el));\n    }\n    set angle(angle){\n        this.tilt = angle;\n    }\n    set rotation(rotation){\n        this.rot = rotation;\n    }\n    set range(range){\n        this._range = range;\n    }\n    set rangeScale(rangeScale){\n        this.scale = rangeScale;\n    }\n    draw(){\n        var tiltFloor = Math.floor(this.tilt);\n        var tiltRemd = Math.floor(this.tilt * 10/this.scale) % 10;\n        this.scaleVals = range(\n            Math.floor(this.tilt/this.scale)*this.scale - Math.floor(this.scale*this._range/2),\n            Math.floor(this.tilt/this.scale)*this.scale + Math.floor(this.scale*this._range/2),\n            this.scale);\n        this.scaleVals = rangeClip(this.scaleVals, limitPitchLadder);\n        this.tilt = tiltFloor + tiltRemd/10;      \n        var space = 0;\n        if (tiltRemd >=0) \n            space = this.middleOffset +tiltRemd*this.tickSpace/10;\n        else \n            space = this.middleOffset + (10*this.tickSpace/10 +tiltRemd*this.tickSpace/10);\n        var elemIdx = 0;\n        this.scaleVals.forEach((val,idx)=>{\n            var sign = 1;\n            if (val<0) {\n                //this.bm.setLineDash([3, 2]);\n                this.elements[elemIdx+1].dash = [5, 10];\n                this.elements[elemIdx+2].dash = [5, 10];\n                this.elements[elemIdx+3].dash = [5, 10];\n                this.elements[elemIdx+4].dash = [5, 10];\n                sign = -1;\n            }else{\n                this.elements[elemIdx+1].dash = [];\n                this.elements[elemIdx+2].dash = [];\n                this.elements[elemIdx+3].dash = [];\n                this.elements[elemIdx+4].dash = [];\n            }\n            this.elements[elemIdx].left = this.middle - this.tickHeight/2 -25;\n            this.elements[elemIdx].top = space+8*sign;\n            this.elements[elemIdx].text = val.toString();\n            elemIdx = elemIdx +1;\n            this.elements[elemIdx].x1 = this.middle - this.tickHeight/2;\n            this.elements[elemIdx].y1 = space;\n            this.elements[elemIdx].x2 = this.middle - this.tickHeight*0.3;\n            this.elements[elemIdx].y2 = space;\n            elemIdx = elemIdx +1;\n            this.elements[elemIdx].x1 = this.middle + this.tickHeight*0.3;\n            this.elements[elemIdx].y1 = space;\n            this.elements[elemIdx].x2 = this.middle + this.tickHeight/2;\n            this.elements[elemIdx].y2 = space;\n            elemIdx = elemIdx +1;\n            this.elements[elemIdx].x1 = this.middle - this.tickHeight/2;\n            this.elements[elemIdx].y1 = space;\n            this.elements[elemIdx].x2 = this.middle - this.tickHeight/2;\n            this.elements[elemIdx].y2 = space+10*sign;\n            elemIdx = elemIdx +1;\n            this.elements[elemIdx].x1 = this.middle + this.tickHeight/2;\n            this.elements[elemIdx].y1 = space;\n            this.elements[elemIdx].x2 = this.middle + this.tickHeight/2;\n            this.elements[elemIdx].y2 = space+10*sign;\n            elemIdx = elemIdx +1;\n            space -= this.tickSpace;\n        });\n        this.root.rotation = (Math.PI / 180) * this.rot;\n       /* this.bm.save();\n        this.bm.translate(this.width/2, this.height/2);\n        this.bm.rotate((Math.PI / 180) * this.rot); // rotate\n        this.bm.translate(-this.width/2, -this.height/2);\n\n        var tiltFloor = Math.floor(this.tilt);\n        var tiltRemd = Math.floor(this.tilt * 10/this.scale) % 10;\n        this.scaleVals = range(\n            Math.floor(this.tilt/this.scale)*this.scale - Math.floor(this.scale*this._range/2),\n            Math.floor(this.tilt/this.scale)*this.scale + Math.floor(this.scale*this._range/2),\n            this.scale);\n        this.scaleVals = rangeClip(this.scaleVals, limitPitchLadder);\n        this.tilt = tiltFloor + tiltRemd/10;\n        \n        var space = 0;\n        if (tiltRemd >=0) \n            space = this.middleOffset +tiltRemd*this.tickSpace/10;\n        else \n            space = this.middleOffset + (10*this.tickSpace/10 +tiltRemd*this.tickSpace/10);\n\n        super.changeLocalLineWidth();\n\n        this.scaleVals.forEach((val,idx)=>{\n            this.bm.beginPath();\n            this.bm.font = `bold ${12}px Arial`;\n            this.bm.textAlign = 'start';\n            var sign = 1;\n            if (val<0) {\n                this.bm.setLineDash([3, 2]);\n                sign = -1;\n            }\n            if (val != 0){\n                this.bm.moveTo(this.middle - this.tickHeight/2, space);\n                this.bm.lineTo(this.middle - this.tickHeight*0.3, space); \n                this.bm.moveTo(this.middle + this.tickHeight*0.3, space);\n                this.bm.lineTo(this.middle + this.tickHeight/2, space); \n                this.bm.moveTo(this.middle - this.tickHeight/2, space);\n                this.bm.lineTo(this.middle - this.tickHeight/2, space+10*sign); \n                this.bm.moveTo(this.middle + this.tickHeight/2, space);\n                this.bm.lineTo(this.middle + this.tickHeight/2, space+10*sign); \n                this.bm.fillText(val.toString(), this.middle - this.tickHeight/2 -25, space+8*sign);\n            }else{\n                this.bm.moveTo(this.middle - this.tickHeight*0.8, space);\n                this.bm.lineTo(this.middle - this.tickHeight*0.3, space); \n                this.bm.moveTo(this.middle + this.tickHeight*0.3, space);\n                this.bm.lineTo(this.middle + this.tickHeight*0.8, space); \n            }\n            space -= this.tickSpace;\n            this.bm.closePath();\n            this.bm.stroke();\n            this.bm.setLineDash([]);\n        });\n        \n        super.resetGlobalLineWidth(); \n        this.bm.restore();*/\n    }\n}"," class hudControl {\n     constructor(bm, x, y){\n        this.bm = bm;\n        this._x = x;\n        this._y = y;\n        this.lineWidth = this.bm.lineWidth;\n        this.globalLineWidth = this.bm.lineWidth;\n        this._fontSize = 12;\n     }\n     set lineWidth(lineWidth){\n        this.localLineWidth = lineWidth;\n    }\n    get lineWidth(){\n        return this.localLineWidth;\n    }\n    set x(x){\n        this._x = x;\n    }\n    get x(){\n        return this._x;\n    }\n    set y(y){\n        this._y = y;\n    }\n    get y(){\n        return this._y;\n    }\n    set fontSize(size){\n        this._fontSize = size;\n    }\n    get fontSize(){\n        return this._fontSize;\n    }\n    changeLocalLineWidth(){\n        this.globalLineWidth = this.bm.lineWidth;\n        this.bm.lineWidth = this.localLineWidth;\n    }\n    resetGlobalLineWidth(){\n        this.bm.lineWidth = this.globalLineWidth;\n    }\n     draw(){\n\n     }\n }\n\n\nexport class hudSimpleText extends hudControl{\n    constructor(bm, x, y, fontSize) {\n        super(bm,x,y);\n        this.txt = \"hello...\"\n        this.fontSize = fontSize;\n    }\n    set text(txt){\n        this.txt = txt;\n    }\n    draw(){\n        this.bm.font = `bold ${this.fontSize}px Arial`;\n        this.bm.textAlign = 'start';\n        this.bm.fillText(this.txt, this.x, this.y);\n    }\n  }\n\n  function wrapText(context, text, x, y, maxWidth, lineHeight) {\n    var words = text.split(' ');\n    var line = '';\n\n    for(var n = 0; n < words.length; n++) {\n      var testLine = line + words[n] + ' ';\n      var metrics = context.measureText(testLine);\n      var testWidth = metrics.width;\n      if (testWidth > maxWidth && n > 0) {\n        context.fillText(line, x, y);\n        line = words[n] + ' ';\n        y += lineHeight;\n      }\n      else {\n        line = testLine;\n      }\n    }\n    context.fillText(line, x, y);\n  }\n\n  export class hudWrappedText extends hudControl{\n    constructor(bm, x, y, fontSize) {\n        super(bm,x,y);\n        this.txt = \"hello...\"\n        this.fontSize = fontSize;\n    }\n    set text(txt){\n        this.txt = txt;\n    }\n    draw(){\n        this.bm.font = `bold ${this.fontSize}px Arial`;\n        wrapText(this.bm, this.txt, this.x, this.y, 100, this.fontSize+2);\n    }\n  }\n\n\n\n  \nexport class hudBorder extends hudControl{\n    constructor(bm, width, height) {\n        super(bm,0,0);\n        this.width = width;\n        this.height = height;\n    }  \n    draw(){\n        super.changeLocalLineWidth();\n        this.bm.strokeRect(0,0,this.width, this.height);\n        super.resetGlobalLineWidth();\n    }\n\n  }\n \nexport class crosshair extends hudControl{\n    constructor(bm, width, height) {\n        super(bm,width / 2,height / 2);\n        this.width = width;\n        this.height = height;\n        \n    }\n\n    draw(){\n        // remove aliasing\n        this.x = Math.floor(this.x) + 0.5;\n        this.y = Math.floor(this.y) + 0.5;\n        super.changeLocalLineWidth();\n        this.bm.strokeWidth = 2;\n        this.bm.beginPath();\n        this.bm.moveTo(this.x, this.y - 10);\n        this.bm.lineTo(this.x, this.y + 10);\n        this.bm.moveTo(this.x - 10,  this.y);\n        this.bm.lineTo(this.x + 10,  this.y);\n        this.bm.closePath();\n        this.bm.stroke();\n        super.resetGlobalLineWidth();\n        //console.log(\"crosshair\", this.x, this.y);\n    }\n  }\n\n  export class horizon extends hudControl{\n    constructor(bm, width, height) {\n        super(bm,width / 2,height / 2);\n        this.width = width;\n        this.height = height;\n        this.tilt = 0;\n    }\n    set angle(angle){\n        this.tilt = angle;\n    }\n    draw(){\n        // remove aliasing\n        this.x = Math.floor(this.x) + 0.5;\n        this.y = Math.floor(this.y) + 0.5;\n        this.bm.save();\n        //this.bm.clearRect(0,0,this.width,this.height);\n        this.bm.translate(this.width/2, this.height/2)\n        this.bm.rotate((Math.PI / 180) * this.tilt); // rotate\n        this.bm.translate(-this.width/2, -this.height/2)\n        super.changeLocalLineWidth();\n        this.bm.strokeWidth = 1;\n        this.bm.beginPath();\n        this.bm.moveTo(this.x-20, this.y);\n        this.bm.lineTo(this.x-10, this.y);\n        this.bm.moveTo(this.x-10, this.y);\n        this.bm.lineTo(this.x, this.y -10 );\n        this.bm.moveTo(this.x, this.y -10 );\n        this.bm.lineTo(this.x+10, this.y);\n        this.bm.moveTo(this.x+10,  this.y);\n        this.bm.lineTo(this.x+20,  this.y);\n        this.bm.closePath();\n        this.bm.stroke();\n        super.resetGlobalLineWidth();\n        \n        this.bm.restore();\n    }\n  }\n\n  function range(start, end, inc) {\n    //console.log(start,end);\n    return Array(end/inc - (start/inc) + 1).fill().map((_, idx) => start+ idx*inc);\n  }\n  function limitCompass(x){\n    if(x<0) x = x+ 360;\n    if(x>359) x = x -360;\n    return x;\n  }\n  function limitPitchLadder(x){\n    if(x<-90) x = -180-x;\n    if(x>90) x = 180-x ;\n    return x;\n  }\n  function rangeClip(rangeArray,limit){\n    return rangeArray.map(x=>limit(x));\n  }\n  function rangeClip360(rangeArray,limit){\n    return rangeArray.map(x=>limit(x));\n  }\n  export class compass extends hudControl{\n    constructor(bm, width, height, tickSpace =40, range = 4) {   \n        super(bm,width/2- tickSpace*(range/2),height / 6);\n        this.tickSpace = tickSpace;\n        this._range = range;\n        //this.middle =  this.tickSpace*(this._range/2);\n        this.middle = width/2;\n        this.width = width;\n        this.height = height;\n        this.tilt = 0;\n        this.tickHeight = 15;\n        \n        this.scale = 10;\n        //this.scaleVals = range(10/this.scale,50/this.scale,this.scale);\n        //console.log(this.scaleVals);\n        this.x = Math.floor(this.x) + 0.5;\n        this.y = Math.floor(this.y) + 0.5;\n        //console.log(this.x);\n        \n    }\n    set angle(angle){\n        this.tilt = angle;\n    }\n    get angle(){\n        return this.tilt;\n    }\n    set range(range){\n        this._range = range;\n    }\n    set rangeScale(rangeScale){\n        this.scale = rangeScale;\n    }\n    draw(){\n        this.x = Math.floor(this.x) + 0.5;\n        this.y = Math.floor(this.y) + 0.5;\n        var tiltFloor = Math.floor(this.tilt);\n        var tiltRemd = Math.floor(this.tilt * 10/this.scale) % 10;\n        var tiltRemdHalf = Math.floor((this.tilt/this.scale+0.5) * 10) % 10;\n        this.scaleVals = range(\n            Math.floor(this.tilt/this.scale)*this.scale-Math.floor(this.scale*this._range/2),\n            Math.floor(this.tilt/this.scale)*this.scale+ Math.floor(this.scale*this._range/2),\n            this.scale);\n        this.scaleVals = rangeClip(this.scaleVals,limitCompass);\n        this.tilt = tiltFloor + tiltRemd/10;\n\n        super.changeLocalLineWidth();\n        this.bm.beginPath();\n        \n        var space = this.x-tiltRemd*this.tickSpace/10;\n        var spaceHalf = this.x-tiltRemdHalf*this.tickSpace/10;\n        this.scaleVals.forEach((val,idx)=>{\n            this.bm.font = `bold ${this.fontSize}px Arial`;\n            this.bm.textAlign = 'start';\n            this.bm.fillText(val.toString(), space-5, this.y-this.tickHeight-2);\n            this.bm.moveTo(space, this.y);\n            this.bm.lineTo(space, this.y-this.tickHeight); \n            this.bm.moveTo(spaceHalf, this.y);\n            this.bm.lineTo(spaceHalf, this.y-this.tickHeight/2); \n            space += this.tickSpace;\n            spaceHalf += this.tickSpace;\n        });\n        //var middle =  this.tickSpace*(this._range/2);\n        this.bm.moveTo(this.middle, this.y+this.tickHeight);\n        this.bm.lineTo(this.middle, this.y); \n        this.bm.fillText(tiltFloor.toString(), this.middle+4, this.y+this.tickHeight);\n        this.bm.closePath();\n        this.bm.stroke();\n        super.resetGlobalLineWidth(); \n    }\n  }\nexport class pitchLader extends hudControl {\n    constructor(bm, width, height){\n        super(bm,0,0);\n        this.width = width;\n        this.height = height;\n        this.middle = width/2;\n        this.tilt = 0;\n        this.rot = 0;\n        this.tickHeight = 100;\n        this.tickSpace = 40;\n        this.scale = 10;\n        this.x = Math.floor(this.x) + 0.5;\n        this.y = Math.floor(this.y) + 0.5;\n        this._range = 4;\n        this.middleOffset = height -(height - this.tickSpace*this._range )/2 +this.tickSpace;\n    }\n    set angle(angle){\n        this.tilt = angle;\n    }\n    set rotation(rotation){\n        this.rot = rotation;\n    }\n    set range(range){\n        this._range = range;\n    }\n    set rangeScale(rangeScale){\n        this.scale = rangeScale;\n    }\n    draw(){\n        this.bm.save();\n        this.bm.translate(this.width/2, this.height/2);\n        this.bm.rotate((Math.PI / 180) * this.rot); // rotate\n        this.bm.translate(-this.width/2, -this.height/2);\n\n        var tiltFloor = Math.floor(this.tilt);\n        var tiltRemd = Math.floor(this.tilt * 10/this.scale) % 10;\n        this.scaleVals = range(\n            Math.floor(this.tilt/this.scale)*this.scale - Math.floor(this.scale*this._range/2),\n            Math.floor(this.tilt/this.scale)*this.scale + Math.floor(this.scale*this._range/2),\n            this.scale);\n        this.scaleVals = rangeClip(this.scaleVals, limitPitchLadder);\n        this.tilt = tiltFloor + tiltRemd/10;\n        \n        var space = 0;\n        if (tiltRemd >=0) \n            space = this.middleOffset +tiltRemd*this.tickSpace/10;\n        else \n            space = this.middleOffset + (10*this.tickSpace/10 +tiltRemd*this.tickSpace/10);\n\n        super.changeLocalLineWidth();\n\n        this.scaleVals.forEach((val,idx)=>{\n            this.bm.beginPath();\n            this.bm.font = `bold ${this.fontSize}px Arial`;\n            this.bm.textAlign = 'start';\n            var sign = 1;\n            if (val<0) {\n                this.bm.setLineDash([3*this.tickHeight/100, 2*this.tickHeight/100]); //3,2\n                sign = -1;\n            }\n            if (val != 0){\n                this.bm.moveTo(this.middle - this.tickHeight/2-this.lineWidth/2, space);\n                this.bm.lineTo(this.middle - this.tickHeight*0.3, space); \n                this.bm.moveTo(this.middle + this.tickHeight*0.3, space);\n                this.bm.lineTo(this.middle + this.tickHeight/2+this.lineWidth/2, space); \n                this.bm.moveTo(this.middle - this.tickHeight/2, space);\n                this.bm.lineTo(this.middle - this.tickHeight/2, space+this.tickSpace/4 *sign); \n                this.bm.moveTo(this.middle + this.tickHeight/2, space);\n                this.bm.lineTo(this.middle + this.tickHeight/2, space+this.tickSpace/4*sign); \n                this.bm.fillText(val.toString(), this.middle - this.tickHeight/2 -130 +20*sign, space+35-1*sign); //25 8\n            }else{\n                this.bm.moveTo(this.middle - this.tickHeight*0.8, space);\n                this.bm.lineTo(this.middle - this.tickHeight*0.3, space); \n                this.bm.moveTo(this.middle + this.tickHeight*0.3, space);\n                this.bm.lineTo(this.middle + this.tickHeight*0.8, space); \n            }\n            space -= this.tickSpace;\n            this.bm.closePath();\n            this.bm.stroke();\n            this.bm.setLineDash([]);\n        });\n        \n        super.resetGlobalLineWidth(); \n        this.bm.restore();\n    }\n}\n\n\n\nexport default { hudSimpleText, hudWrappedText, hudBorder, crosshair, horizon, compass, pitchLader }\n","//import * as THREE from 'three';\nimport * as BABYLON from 'babylonjs';\nimport { compass } from './GuiHudControls';\nimport * as HUD2D from './HudControls';\n//import IMU from './Imu.js';\nfunction isMobileCheck() {\n    return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);\n}\n\nexport default function hudPanel(scene,canvas,planeSize = 0.5){\n\n    //var size = 600;\n    //if (window.innerHeight < size) \n    //size = window.innerHeight;\n    const screenDimensions = {\n        width: canvas.width,\n        height: canvas.height\n    }\n    //console.log(screenDimensions);\n    var elapsed, now;\n    var then = 0;\n    var interval=0.05;\n    var angles = new BABYLON.Vector3(0,0,0);\n    var speed = 0;\n    var altitude = 0;\n    var power = 0;\n    //console.log('win inner height'+window.innerHeight);\n    var style = `rgba(\n        ${0xa3},\n        ${0xff},\n        ${0x00},\n        ${0xFF}`;\n    window.drawCanvas = document.createElement(\"canvas\");\n    window.drawCanvas.width = 768;\n    window.drawCanvas.height = 768;\n    var ctx = window.drawCanvas.getContext(\"2d\");\n    ctx.fillStyle = style;\n    ctx.strokeStyle = style;\n    //ctx.globalAlpha = 0.75;\n    //ctx.imageSmoothingEnabled = true; //maybe use when zooming\n    ctx.lineWidth = 5;\n    var hudElements = {\n        //info: new HUD2D.hudSimpleText(ctx, window.drawCanvas.width/2 -30, window.drawCanvas.height - 150,128),\n        //border: new HUD2D.hudBorder(ctx,window.drawCanvas.width,window.drawCanvas.height),\n        //crosshair: new HUD2D.crosshair(ctx,window.drawCanvas.width,window.drawCanvas.height),\n        //horizon: new HUD2D.horizon(ctx,window.drawCanvas.width,window.drawCanvas.height),\n        compass: new HUD2D.compass(ctx,window.drawCanvas.width,window.drawCanvas.height,200,2),\n        pitchLader: new HUD2D.pitchLader(ctx,window.drawCanvas.width,window.drawCanvas.height),\n        speed: new HUD2D.hudSimpleText(ctx, 0, window.drawCanvas.height-20,90),\n        power: new HUD2D.hudSimpleText(ctx, 0, window.drawCanvas.height-90,75),\n        altitude: new HUD2D.hudSimpleText(ctx, window.drawCanvas.width-230, window.drawCanvas.height-20,90)\n        //msgs: new HUD2D.hudWrappedText(hudBitmap,10,60,12)\n    };\n    //hudElements.compass.tickSpace = 100;\n    hudElements.compass.tickHeight = 60;\n    hudElements.compass.lineWidth = 14;\n    hudElements.compass.fontSize = 90;\n    hudElements.compass.angle = 30;\n\n    hudElements.pitchLader.tickHeight = 300;\n    hudElements.pitchLader.tickSpace = 120;\n    hudElements.pitchLader.lineWidth = 14;\n    hudElements.pitchLader.fontSize = 90;\n    hudElements.pitchLader.range = 2;\n\n   \n\n    Object.values(hudElements).forEach(val => {\n        //val.fontSize = 128;\n        //val.draw(); \n    });\n    var texture = new BABYLON.HtmlElementTexture(\"\", window.drawCanvas, {\n        scene\n    });\n    var material = new BABYLON.StandardMaterial(\"groundMat\", scene);\n    material.emissiveTexture = texture;\n    material.disableLighting = true;\n    material.diffuseTexture = texture;\n    material.diffuseTexture.hasAlpha = true;\n    material.backFaceCulling = false;\n    //material.disableLighting = true;\n    var hudMesh = BABYLON.MeshBuilder.CreatePlane(\"hudPlane\", {size:1.6});\n    hudMesh.material = material;\n\n    texture.update();\n    function draw() {\n        ctx.clearRect(0,0,window.drawCanvas.width,window.drawCanvas.height );\n        \n        hudElements.speed.text = speed;\n        hudElements.altitude.text = altitude;\n        hudElements.power.text = power;\n        hudElements.compass.angle = angles.x;\n        hudElements.pitchLader.angle = angles.y;\n        hudElements.pitchLader.rot = angles.z;\n        //console.log(hudElements.compass.angle );\n        // redraw\n        Object.values(hudElements).forEach(val => {val.draw()});\n        texture.update();\n        //texture.needsUpdate = true;\n        //if (imuData.updated) console.log(`compass = ${imuData.compass}, yaw = ${imuData.yaw},pitch = ${imuData.pitch},roll = ${imuData.roll}`);\n      }\n    /**    \n     * attach the hud to a vehicle     \n     * @param {BABYLON.Mesh} mesh\n     */\n    function linkWithMesh(mesh){\n        mesh.addChild(hudMesh);\n        hudMesh.position = new BABYLON.Vector3(0,0.8,0);//(0,1.2,0);\n    }\n    /**    \n     * attach the hud to a vehicle     \n     * @param {BABYLON.Camera} cam\n     */\n    function linkWithCamera(cam){\n        //hudMesh.translate(BABYLON.Vector3.Up(),20, BABYLON.Space.WORLD);// = new BABYLON.Vector3(0,0.1,2);\n        hudMesh.parent = cam;\n        //hudMesh.position = new BABYLON.Vector3(0,0.1,2);\n    }\n    /**    \n     * attach the hud to a vehicle     \n     * @param {BABYLON.Camera} cam\n     */\n    function lockToCamera(cam){\n        cam.lockedTarget = hudMesh;\n    }\n    function flipHoriz(drawing){\n        //drawing.translate(screenDimensions.width/2,0);\n        //drawing.scale(-1, 1);\n    }\n    function setRotation(eulerAngles){\n        angles.copyFrom(eulerAngles);\n    }\n    function setSpeed(s){\n        speed = (s*10).toFixed(1);\n    }\n    function setAltitude(a){\n        altitude = a.toFixed(1);\n    }\n    function setPower(p){\n        if(p>0.99) p=0.99;\n        power = (p*100).toFixed(0);\n    }\n\tfunction update(time) {\n        //then = now;\n        now = time;\n        elapsed = now - then;\n        if (elapsed > interval){\n            draw();\n            //console.log(time);\n            then = now;\n        }\n    }\n    return {\n        update,\n        draw,\n        linkWithMesh,\n        linkWithCamera,\n        lockToCamera,\n        setRotation,\n        setSpeed,\n        setAltitude,\n        setPower\n    }\n}","class Clock {\n\n\tconstructor( autoStart = true ) {\n\n\t\tthis.autoStart = autoStart;\n\n\t\tthis.startTime = 0;\n\t\tthis.oldTime = 0;\n\t\tthis.elapsedTime = 0;\n\n\t\tthis.running = false;\n\n\t}\n\n\tstart() {\n\n\t\tthis.startTime = now();\n\n\t\tthis.oldTime = this.startTime;\n\t\tthis.elapsedTime = 0;\n\t\tthis.running = true;\n\n\t}\n\n\tstop() {\n\n\t\tthis.getElapsedTime();\n\t\tthis.running = false;\n\t\tthis.autoStart = false;\n\n\t}\n\n\tgetElapsedTime() {\n\n\t\tthis.getDelta();\n\t\treturn this.elapsedTime;\n\n\t}\n\n\tgetDelta() {\n\n\t\tlet diff = 0;\n\n\t\tif ( this.autoStart && ! this.running ) {\n\n\t\t\tthis.start();\n\t\t\treturn 0;\n\n\t\t}\n\n\t\tif ( this.running ) {\n\n\t\t\tconst newTime = now();\n\n\t\t\tdiff = ( newTime - this.oldTime ) / 1000;\n\t\t\tthis.oldTime = newTime;\n\n\t\t\tthis.elapsedTime += diff;\n\n\t\t}\n\n\t\treturn diff;\n\n\t}\n\n}\n\nfunction now() {\n\n\treturn ( typeof performance === 'undefined' ? Date : performance ).now(); // see #10732\n\n}\n\nexport { Clock };","import * as BABYLON from \"babylonjs\";\nimport { SkyMaterial } from \"babylonjs-materials\";\n /**    \n *  Simulates the sky with the sun \n * @param {BABYLON.Scene} scene      \n * @param {BABYLON.Light} sunLight\n * @param {BABYLON.Light} ambientLight  \n * @param {BABYLON.Camera} followCam \n * @param num size      \n */\nexport default function skySim(scene, sunLight, ambientLight, followCam, size = 10000){\n    var elapsed, now;\n    var then = 0;\n    var interval= 0.05;\n\n    //ambientLight.intensity = 2;\n    //ambientLight.diffuse = new BABYLON.Color3(0.96, 0.97, 0.93);\n\t//ambientLight.groundColor = new BABYLON.Color3(0, 0, 0);\n    //sunLight.intensity = 2;\n    \n\t// Sky material\n\tvar skyboxMaterial = new SkyMaterial(\"skyMaterial\", scene);\n    skyboxMaterial.backFaceCulling = false;\n    skyboxMaterial.distance = size/2;\n    skyboxMaterial.turbidity = 44;\n    skyboxMaterial.inclination = 0;\n    skyboxMaterial.alpha = 0.5;\n    skyboxMaterial.alphaMode = 1; \n    skyboxMaterial.luminance = 1.1;\n    const offset = 0;\n\t// Sky mesh (box)\n    var skybox = BABYLON.MeshBuilder.CreateBox(\"skyBox\", {width:size, depth:size, height:size}, scene);\n    skybox.material = skyboxMaterial;\n    skybox.position.y = size/3;\n\t//sunLight.position =  skyboxMaterial.sunPosition;\n\n    var cloudMaterial = new BABYLON.StandardMaterial(\"farClouds\", scene);\n    var cloudTexture = new BABYLON.Texture(\"https://raw.githubusercontent.com/kristosb/arfix/b958a70382ccbf86294af1540cd1608e1af1e161/arfix/public/assets/textures/Skies0362_3_masked_S.png\", scene);\n    cloudMaterial.diffuseTexture = cloudTexture;\n    cloudMaterial.backFaceCulling = false;\n    cloudMaterial.twoSidedLighting = true;\n    cloudMaterial.diffuseTexture.hasAlpha = true;\n    cloudMaterial.emissiveColor = new BABYLON.Color3(135/255, 123/255, 78/255);\n    cloudMaterial.specularColor = new BABYLON.Color3(46/255, 46/255, 39/255);\n    \n    var faceUV = new Array(6);\n\n    faceUV[0] = new BABYLON.Vector4(1, 0, 0, 1);\n    faceUV[1] = new BABYLON.Vector4(1, 0, 0, 1);\n    faceUV[2] = new BABYLON.Vector4(1, 0, 0, 1);\n    faceUV[3] = new BABYLON.Vector4(1, 0, 0, 1);\n    faceUV[4] = new BABYLON.Vector4(0, 0, 0, 0);\n    faceUV[5] = new BABYLON.Vector4(0, 0, 0, 0);\n    const cloudBoxSizeMult = (size/1024);\n    var cloudOptions = {\n        width: 1024*cloudBoxSizeMult+1,\n        height: 292*cloudBoxSizeMult+1,\n        depth: 1024*cloudBoxSizeMult+1,\n        wrap:true,\n        faceUV: faceUV\n    };\n    //console.log(\"cloud\",cloudOptions.width, cloudBoxSizeMult, size);\n    var cloudBox = BABYLON.MeshBuilder.CreateBox('farCloudsBox', cloudOptions, scene);\n    cloudBox.material = cloudMaterial;\n    cloudBox.position.y = 70;\n    transitionSunInclination(0);\n\n    function calcRaylight(){\n        var rayligh = convertRange(followCam.position.y,[60,500],[2,0])+convertRange(Math.abs(skyboxMaterial.inclination),[0,0.5],[0,2]);\n        if (rayligh>2) rayligh = 2;\n        if (rayligh<0) rayligh = 0;\n        skyboxMaterial.rayleigh = rayligh;\n    }\n    function setLightDirection(){\n        var dirNorm = new BABYLON.Vector3(0,0,0);\n        //console.log(\"inc\",skyboxMaterial.inclination);\n        skyboxMaterial.useSunPosition = false;\n        dirNorm.copyFrom(skyboxMaterial.sunPosition);\n        //dirNorm.subtractInPlace(new BABYLON.Vector3(0,400,0));\n        //console.log(\"dir\",dirNorm);\n        dirNorm.normalize();\n        //console.log(\"dirsub\",dirNorm);\n        ambientLight.direction.copyFromFloats(dirNorm.x, dirNorm.y, dirNorm.z);//copyFrom(dirNorm);\n        sunLight.direction.copyFromFloats(-dirNorm.x, -dirNorm.y, -dirNorm.z);\n        ambientLight.intensity = convertRange(Math.abs(skyboxMaterial.inclination),[0,0.5],[0.8,0.2]);\n        sunLight.intensity = convertRange(Math.abs(skyboxMaterial.inclination),[0,0.5],[2.3,1.4]);;\n        //if(dirNorm.y<0) ambientLight.intensity = 1; else ambientLight.intensity = 2;\n        console.log(sunLight.direction);\n    }\n    // evening  luminance =0.1 and decrease turbo = 5\n\tfunction move(){\n        skyboxMaterial.cameraOffset.y =  offset + followCam.position.y/10;\n        skyboxMaterial.turbidity  = convertRange(Math.abs(skyboxMaterial.inclination),[0,0.5],[44,2]);\n        calcRaylight();\n        \n    };\n    function convertRange( value, r1, r2 ) { \n        return ( value - r1[ 0 ] ) * ( r2[ 1 ] - r2[ 0 ] ) / ( r1[ 1 ] - r1[ 0 ] ) + r2[ 0 ];\n    }  \n    function transitionSunInclination( interval = 0.025){\n        const limit = 0.48;\n        skyboxMaterial.inclination += interval;\n        if (skyboxMaterial.inclination >= limit) skyboxMaterial.inclination = limit;\n        if (skyboxMaterial.inclination <= -limit) skyboxMaterial.inclination = -limit;\n        //console.log(skyboxMaterial.inclination);\n        move();\n        setLightDirection();\n    }\n    function makeClouds(area){\n        var spriteManagerClouds = new BABYLON.SpriteManager(\"cloudsManager\", \"http://www.babylonjs.com/Scenes/Clouds/cloud.png\", 1000, 256, scene);\n        //spriteManagerClouds.texture.\n        //spriteManagerClouds.blendMode\n        //BABYLON.Scalar.RandomRange(0.4, 1)\n        for (var i = 0; i < 100; i++) {\n              var clouds = new BABYLON.Sprite(\"clouds\", spriteManagerClouds);\n              //clouds.color = new BABYLON.Color3(0.87, 0.93, 0.91);\n              clouds.position.x = Math.random() * area - area/2;\n              clouds.position.y = Math.random() * 150 + 150;\n              clouds.position.z = Math.random() * area - area/2; \n              clouds.size = Math.random() * 60 +50;\n              if (Math.round(Math.random() * 5) === 0) {\n                  clouds.angle = Math.PI * 90 / 180;            \n              }\n          if (Math.round(Math.random() * 2) === 0) {\n            clouds.invertU = -1;\n          }\n          if (Math.round(Math.random() * 4) === 0) {\n            clouds.invertV = -1;\n          }\n          }\n    return spriteManagerClouds;\n    }\n    \n    function update(time) {\n       /* now = time;\n        elapsed = now - then;\n        if (elapsed > interval){\n            move();\n            //console.log(time);\n            then = now;\n        }*/\n    }\n    function getSkyMesh(){\n        return skybox;\n    }\n    return {\n        update,\n        transitionSunInclination,\n        makeClouds,\n        getSkyMesh\n    }\n}\n","import * as BABYLON from 'babylonjs';\nimport { CustomMaterial } from \"babylonjs-materials\";\n\n /**    \n *  Simulates the oacean with moving waves\n * @param {BABYLON.Scene} scene      \n * @param num size      \n */\n /* export default function scene(scene, camera, size = 1024, ground) {\n\n\t// Water\n    // Our built-in 'ground' shape.\n    var waterMesh = BABYLON.MeshBuilder.CreateGround(\"water\", { width: size, height: size, subdivisions: 64 }, scene);\n    //waterMesh.scaling = new BABYLON.Vector3(size/2, 5, size/2);\n    //waterMesh.rotation.y = Math.PI*2;\n    //waterMesh.position.y = -10.8;\n    // stylized water shader\n    BABYLON.Effect.ShadersStore[\"customVertexShader\"]= \"\\r\\n\"+   \n    \"precision highp float;\\r\\n\"+\n\n    // Attributes\n    \"attribute vec3 position;\\r\\n\"+\n    \"attribute vec2 uv;\\r\\n\"+\n\n    // Uniforms\n    \"uniform mat4 worldViewProjection;\\r\\n\"+\n    \"uniform float time;\\r\\n\"+\n\n    // Varying\n    \"varying vec3 vPosition;\\r\\n\"+\n    \"varying vec4 vClipSpace;\\r\\n\"+\n\n    \"void main(void) {\\r\\n\"+\n        \"float scale = 1.0;\\r\\n\"+\n        // calc new position\n        \"float newY = 0.02*(sin(position.x * 1.0 / scale + time * 1.0));\\r\\n\"+\n        // new model position\n        \"vec3 newPositionM = vec3(position.x,newY,position.z);\\r\\n\"+\n        \"gl_Position = worldViewProjection * vec4(newPositionM, 1.0);\\r\\n\"+\n        //\"gl_Position = worldViewProjection * vec4(position, 1.0);\\r\\n\"+\n        // grab vertex position in world space\n        \"vPosition = position;\\r\\n\"+\n        // grab vertex position in view space\n        \"vClipSpace = gl_Position;\\r\\n\"+\n    \"}\\r\\n\";\n\n    BABYLON.Effect.ShadersStore[\"customFragmentShader\"]=\"\\r\\n\"+\n    \"precision highp float;\\r\\n\"+\n\n    // Varyings\n    \"varying vec3 vPosition;\\r\\n\"+\n    // world distance, camera to water\n    \"varying vec4 vClipSpace;\\r\\n\"+\n\n    // Uniforms\n    \"uniform sampler2D depthTex;\\r\\n\"+\n    \"uniform sampler2D refractionSampler;\\r\\n\"+\n    \"uniform float camMinZ;\\r\\n\"+\n    \"uniform float camMaxZ;\\r\\n\"+\n    \"uniform float maxDepth;\\r\\n\"+\n    // water colors\n    \"uniform vec4 wDeepColor;\\r\\n\"+\n    \"uniform vec4 wShallowColor;\\r\\n\"+\n    \"uniform float time;\\r\\n\"+\n    \"uniform float wNoiseScale;\\r\\n\"+\n    \"uniform float wNoiseOffset;\\r\\n\"+\n    \"uniform float fNoiseScale;\\r\\n\"+\n\n    \"float mod289(float x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\\r\\n\"+\n    \"vec4 mod289(vec4 x){return x - floor(x * (1.0 / 289.0)) * 289.0;}\\r\\n\"+\n    \"vec4 perm(vec4 x){return mod289(((x * 34.0) + 1.0) * x);}\\r\\n\"+\n\n    \"float noise(vec3 p){\\r\\n\"+\n        \"vec3 a = floor(p);\\r\\n\"+\n        \"vec3 d = p - a;\\r\\n\"+\n        \"d = d * d * (3.0 - 2.0 * d);\\r\\n\"+\n\n        \"vec4 b = a.xxyy + vec4(0.0, 1.0, 0.0, 1.0);\\r\\n\"+\n        \"vec4 k1 = perm(b.xyxy);\\r\\n\"+\n        \"vec4 k2 = perm(k1.xyxy + b.zzww);\\r\\n\"+\n\n        \"vec4 c = k2 + a.zzzz;\\r\\n\"+\n        \"vec4 k3 = perm(c);\\r\\n\"+\n        \"vec4 k4 = perm(c + 1.0);\\r\\n\"+\n\n        \"vec4 o1 = fract(k3 * (1.0 / 41.0));\\r\\n\"+\n        \"vec4 o2 = fract(k4 * (1.0 / 41.0));\\r\\n\"+\n\n        \"vec4 o3 = o2 * d.z + o1 * (1.0 - d.z);\\r\\n\"+\n        \"vec2 o4 = o3.yw * d.x + o3.xz * (1.0 - d.x);\\r\\n\"+\n\n        \"return o4.y * d.y + o4.x * (1.0 - d.y);\\r\\n\"+\n    \"}\\r\\n\"+\n\n    \"void main(void) {\\r\\n\"+\n        // init baseColor\n        \"vec4 baseColor = vec4(0.0);\\r\\n\"+\n        // generate noise value\n        \"float waveNoise = noise(vec3(0., time, 0.)+vPosition*wNoiseScale)*wNoiseOffset;\\r\\n\"+\n        // remap frag screen space coords to ndc (-1 to +1)\n        \"vec2 ndc = (vClipSpace.xy / vClipSpace.w) / 2.0 + 0.5;\\r\\n\"+\n        // grab depth value (0 to 1) at ndc for object behind water\n        \"float depthOfObjectBehindWater = texture2D(depthTex, vec2(ndc.x, ndc.y)+waveNoise).r;\\r\\n\"+\n        // get depth of water plane\n        \"float linearWaterDepth = (vClipSpace.z + camMinZ) / (camMaxZ + camMinZ);\\r\\n\"+\n        // calculate water depth scaled to camMaxZ since camMaxZ >> camMinZ\n        \"float waterDepth = camMaxZ*(depthOfObjectBehindWater - linearWaterDepth);\\r\\n\"+\n        // get water depth as a ratio of maxDepth\n        \"float wdepth = clamp((waterDepth/maxDepth), 0.0, 1.0);\\r\\n\"+\n        // mix water colors based on depth\n        \"baseColor = mix(wShallowColor, wDeepColor, wdepth);\\r\\n\"+\n        // mix colors with scene render\n        \"vec4 refractiveColor = texture2D(refractionSampler, vec2(ndc.x, ndc.y)+waveNoise);\\r\\n\"+\n        \"baseColor = mix(refractiveColor, baseColor, baseColor.a);\\r\\n\"+\n        // decide the amount of foam \n        \"float foam = 1.0-smoothstep(0.1, 0.2, wdepth);\\r\\n\"+\n        // make the foam effect using noise\n        \"float foamEffect = smoothstep( 0.1, 0.2, noise(vec3(0., time, 0.)+vPosition*fNoiseScale*0.3)*foam);\\r\\n\"+\n        \"baseColor.rgba += vec4(foamEffect);\\r\\n\"+\n        // final result\n        \"gl_FragColor = baseColor;\\r\\n\"+\n        \n    \"}\\r\\n\";\n\n    var shaderMaterial = new BABYLON.ShaderMaterial(\"shader\", scene, {vertex: \"custom\",fragment: \"custom\"},\n    {\n    attributes: [\"position\", \"normal\", \"uv\"],\n    uniforms: [\"world\", \"worldView\", \"worldViewProjection\", \"view\", \"projection\"],\n    });\n \n    // linear depth only!! I dun want to work with non-linear depth map!\n    var depthRenderer = scene.enableDepthRenderer(scene.activeCamera,false);\n    var depthTex = depthRenderer.getDepthMap();\n    depthTex.renderList = [ ground];\n    \n    var _refractionRTT = new BABYLON.RenderTargetTexture(\"water_refraction\", { width: 8, height: 8 }, scene, false, true);\n    _refractionRTT.wrapU = BABYLON.Constants.TEXTURE_MIRROR_ADDRESSMODE;\n    _refractionRTT.wrapV = BABYLON.Constants.TEXTURE_MIRROR_ADDRESSMODE;\n    _refractionRTT.ignoreCameraViewport = true;\n    _refractionRTT.renderList.push( ground);\n    _refractionRTT.refreshRate = 4;\n\n    scene.customRenderTargets.push(_refractionRTT);\n    \n    // set shader parameters\n    shaderMaterial.setTexture(\"depthTex\", depthTex);\n    shaderMaterial.setTexture(\"refractionSampler\", _refractionRTT);\n    shaderMaterial.setFloat(\"camMinZ\", scene.activeCamera.minZ);\n    shaderMaterial.setFloat(\"camMaxZ\", scene.activeCamera.maxZ);\n    shaderMaterial.setFloat(\"time\", 0);\n    shaderMaterial.setFloat(\"wNoiseScale\", 6.0);\n    shaderMaterial.setFloat(\"wNoiseOffset\", 0.01);\n    shaderMaterial.setFloat(\"fNoiseScale\", 10.0);\n    shaderMaterial.setFloat(\"maxDepth\", 0.5);\n    shaderMaterial.setVector4(\"wDeepColor\", new BABYLON.Vector4(0.0,0.2,0.5,0.8));\n    shaderMaterial.setVector4(\"wShallowColor\", new BABYLON.Vector4(0.3,0.4,0.8,0.5));\n\n    var time = 0;\n    scene.registerBeforeRender(function() {\n        time += scene.getEngine().getDeltaTime() * 0.001;\n        shaderMaterial.setFloat(\"time\", time);\n    });\n    \n    waterMesh.material = shaderMaterial;\n\n    waterMesh.receiveShadows = true;\n\n    function update(){\n\n    }\n    function setPosition(position){\n        waterMesh.position = position;\n    }\n    function addReflected(subject){\n        //water.addToRenderList(subject);\n    }\n    return {\n        update,\n        setPosition,\n        addReflected\n    }\n\n}*/\n\n/*  export default function scene(scene, camera, size = 1024) {\n\n\t// Water\n    // Our built-in 'ground' shape.\n    var waterMesh = BABYLON.MeshBuilder.CreateGround(\"water\", { width: 2, height: 2, subdivisions: 64 }, scene);\n    waterMesh.scaling = new BABYLON.Vector3(size/2, 5, size/2);\n    waterMesh.rotation.y = Math.PI*2;\n    //waterMesh.position.y = -10.8;\n\n    BABYLON.NodeMaterial.ParseFromSnippetAsync(\"#3FU5FG#1\", scene).then((mat) => {\n        waterMesh.material = mat;\n        //window.mat = mat;\n    });\n    let addPostEffects = ()=>{\n        var pipeline = new BABYLON.DefaultRenderingPipeline(\n            \"defaultPipeline\", // The name of the pipeline\n            false, // Do you want the pipeline to use HDR texture?\n            scene, // The scene instance\n            [camera] // The list of cameras to be attached to\n        );\n        pipeline.bloomEnabled   = false;\n\n        pipeline.grainEnabled = false;\n        pipeline.grain.animated = false;\n\n        pipeline.chromaticAberrationEnabled = false;\n\n        pipeline.sharpenEnabled = false;\n\n    }\n    addPostEffects();\n\n    waterMesh.receiveShadows = true;\n\n    function update(){\n\n    }\n    function setPosition(position){\n        waterMesh.position = position;\n    }\n    function addReflected(subject){\n        //water.addToRenderList(subject);\n    }\n    return {\n        update,\n        setPosition,\n        addReflected\n    }\n\n}*/\n\n/*export default function scene(scene, size = 1024) {\n\n\t// Water\n\tvar waterMesh = BABYLON.Mesh.CreateGround(\"waterMesh\", size, size, 16, scene, false);\n    waterMesh.receiveShadows = true;\n\tvar water = new WaterMaterial(\"water\", scene, new BABYLON.Vector2(1024, 1024));\n\twater.backFaceCulling = false;\n\twater.bumpTexture = new BABYLON.Texture(\"textures/waterbump.png\", scene);\n\twater.windForce = -10;\n\twater.waveHeight = 0.5;\n\twater.bumpHeight = 0.2;\n\twater.windDirection = new BABYLON.Vector2(1, 1);\n\twater.waterColor = new BABYLON.Color3(0, 0, 221 / 255);\n\twater.colorBlendFactor = 0.0;\n    water.alpha = 0.7;\n\t\n\twaterMesh.material = water;\n\n    function update(){\n\n    }\n    function setPosition(position){\n        waterMesh.position = position;\n    }\n    function addReflected(subject){\n        water.addToRenderList(subject);\n    }\n    return {\n        update,\n        setPosition,\n        addReflected\n    }\n\n}*/\n\nexport default function scene(scene, size = 1024) {\n    var camWaterMask = maskProjectionCam(scene,size);\n    var gmat = createMaskMaterial(scene, camWaterMask);\n    var ocean = null;\n    const checkDepthMapCreated = () => {\n        const ok = gmat.diffuseTexture._currentRefreshId !== -1;\n        if (!ok) {\n            window.setTimeout(checkDepthMapCreated, 10);\n        } else {\n            //var ocean = new BumpWaves(wsize, scene, gmat);\n            ocean = new ProceduralHeightMap(size, scene, gmat);\n        }\n    };\n\n    checkDepthMapCreated();\n\n\n    //var ocean = new ProceduralHeightMap(size, scene, gmat);\n    function update(){\n\n    }\n    function getMesh(){\n        return ocean;\n    }\n    function setPosition(position){\n        //waterMesh.position = position;\n    }\n\n    return {\n        update,\n        setPosition,\n        getMesh\n    }\n\n}\n\nclass ProceduralHeightMap{\n\n    constructor(wsize, scene, gmat){\n\n\n\n\n        let detail = 64;\n        let res = 512;\n\n        var sdfRes = gmat.diffuseTexture.getSize().width;\n        var sdfTexture = this.generateDistanceField(sdfRes, gmat.diffuseTexture, 24, scene);\n        let flowHeight = this.distortionFlow( 0.5, sdfRes, scene);\n        var water = BABYLON.MeshBuilder.CreateGround(\"waterMesh\", {width: wsize, height: wsize, subdivisions:4}, scene);\n        //water.convertToFlatShadedMesh();\n        water.material = new CustomMaterial('waterMaterial', scene);\n        water.material.backFaceCulling = false;\n        water.position.y  = 0;//55;\n        \n        let bumpTexture = new BABYLON.CustomProceduralTexture(\"waterBump\", 'height2Normal', flowHeight._texture.baseWidth, scene, false, true);\n        bumpTexture.wrapU = bumpTexture.wrapV = 1;\n        bumpTexture.setVector2('resolution', new BABYLON.Vector2(res,res));\n        bumpTexture.setTexture('textureSampler', flowHeight);\n        bumpTexture.refreshRate = 3;\n        bumpTexture.level = 0.5;\n        bumpTexture.vScale = 20;\n        bumpTexture.uScale = 20;\n        //bumpTexture.vScale = -1;\n        water.material.bumpTexture = bumpTexture;\n        water.material.specularPower = 60;\n        var waterColorTexture = this.generateShallowWaterGradient(sdfRes,sdfTexture,0.9,scene);\n        water.material.diffuseTexture = waterColorTexture;   \n        water.material.diffuseTexture.uScale = -1;\n        \n        water.receiveShadows = true;\n\n    }\n    \n    ///////////// SDF //////////\n    generateDistanceField(res,occlusionTexture, iter1 =24, scene){\n        var uid = Date.now();  \n        var iter =iter1.toFixed(1).toString();\n        //console.log(\"iter\",iter);\n        BABYLON.Effect.ShadersStore[uid+'SdfPixelShader'] = \n        `\n        varying vec2 vUV;\n        uniform sampler2D occlusionMap;\n        uniform float res;\n        \n        bool isIn(vec2 uv)\n        {\n            //vec4 texColor = texture(occlusionMap, uv);\n            float x = step(0.99,texture(occlusionMap, uv).r); //treshold the map\n            x = 1. -x;  //reverse color\n            //vec3 color = vec3(x,x,x);\n            if (x != 1.)\n                return false;\n            else\n                return true;\n        }\n\n        float squaredDistanceBetween(vec2 uv1, vec2 uv2)\n        {\n            vec2 delta = uv1 - uv2;\n            float dist = (delta.x * delta.x) + (delta.y * delta.y);\n            return dist;\n        }\n        void main(){\n            vec2 iResolution = vec2(res);\n            const float range = ${iter};\n            const int iRange = int(range);\n            float halfRange = range / 2.0;\n            vec2 startPosition = vec2(gl_FragCoord.x - halfRange, gl_FragCoord.y - halfRange);\n            bool fragIsIn = isIn(vUV);\n            float squaredDistanceToEdge = (halfRange*halfRange)*2.0;\n\n            if (!fragIsIn)\n                for(int dx=0; dx < iRange; dx++)\n                {\n                    for(int dy=0; dy < iRange; dy++)\n                    {\n                        vec2 scanPositionUV = startPosition + vec2(dx, dy);\n                        \n                        bool scanIsIn = isIn(scanPositionUV / iResolution.xy);\n                        if (scanIsIn != fragIsIn)\n                        {\n                            float scanDistance = squaredDistanceBetween(vec2(gl_FragCoord.x,gl_FragCoord.y), scanPositionUV);\n                            //float scanDistance = squaredDistanceBetween(gl_FragCoord, scanPositionUV);\n                            if (scanDistance < squaredDistanceToEdge)\n                                squaredDistanceToEdge = scanDistance;\n                        }\n                    }\n                }\n            float normalised = squaredDistanceToEdge / ((halfRange*halfRange)*2.0);\n            float distanceToEdge = sqrt(normalised);\n            if (fragIsIn)\n                distanceToEdge = -distanceToEdge ;\n            normalised = 0.5 - distanceToEdge;\n\n            gl_FragColor = vec4(normalised, normalised, normalised, 1.0);\n            /*float x = step(0.99,texture2D(occlusionMap, vUV).r); //treshold the map\n            x = 1. -x;  //reverse color\n            vec3 color = vec3(x,x,x);*/\n\n            //vec3 color = vec3(0.,1.,0.);\n            //gl_FragColor = vec4(color, 1.0);\n\n        }\n        `\n        let texture = new BABYLON.CustomProceduralTexture(uid+\"SdfDt\", uid+\"Sdf\", res , scene, false, false);\n        //texture.wrapU = texture.wrapV = 1;  \n        texture.refreshRate = 0;        \n        texture.setTexture('occlusionMap', occlusionTexture, scene);//params.flowMap)\n        texture.setFloat('res', res);\n        //texture.uScale = 1;\n        //texture.vScale = 1;\n\n        return texture\n    }\n\n    /////////// SDF END /////\n\n    ///////////shallow water map /////\n    generateShallowWaterGradient(res, depfthField,clipDepth=0.5, scene){\n        var uid = Date.now();  \n        var deepColor = new BABYLON.Color3(0.05, 0.098, 0.168);//0.13, 0.27, 0.57);\n        var shallowColor = new BABYLON.Color3(0.02, 0.72, 0.77);//(0.1, 0.54, 0.68);;//new BABYLON.Color3(0.02, 0.72, 0.77);\n        var clip =clipDepth.toFixed(1).toString();\n        BABYLON.Effect.ShadersStore[uid+'ShallowWaterPixelShader'] = \n        `\n        varying vec2 vUV;\n        uniform sampler2D depthField;\n        uniform float res;\n        uniform vec3 deep;\n        uniform vec3 shallow;\n        void main(){\n            vec2 iResolution = vec2(res);\n            float depth = smoothstep(0.,${clip},texture(depthField, vUV).r);\n            vec3 gradient = mix(deep,shallow, depth);\n            gl_FragColor = vec4(gradient,1.0);\n        }\n        `\n        let texture = new BABYLON.CustomProceduralTexture(uid+\"ShallowWaterDt\", uid+\"ShallowWater\", res , scene, false, false);\n        //texture.wrapU = texture.wrapV = 1;  \n        texture.refreshRate = 0;        \n        texture.setTexture('depthField', depfthField, scene);//params.flowMap)\n        texture.setFloat('res', res);\n        texture.setColor3('deep', deepColor);\n        texture.setColor3('shallow', shallowColor);\n        //texture.uScale = 1;\n        //texture.vScale = 1;\n        return texture\n    }\n/////////////\n\n    distortionFlow(wspeed, res, scene ){\n        var uid = Date.now()\n        //this.params = params\n         \n        var speed = wspeed.toFixed(1).toString();    \n        BABYLON.Effect.ShadersStore[uid+'DistortionFlowPixelShader'] = \n        `\n        varying vec2 vUV;\n        uniform sampler2D textureSampler;\n        //uniform sampler2D flowMap;\n        uniform float uTime;\n\n        vec2 flowUV (vec2 uv, float time) {\n            return uv + time;\n        }\n        //https://www.shadertoy.com/view/MtfBRN\n        void main(){\n            vec2 uv = vec2(vUV.x,-vUV.y);\n            float intensity = ${speed};\n            float timescale = uTime *.0174;\n            //vec2 distortion = (texture2D(flowMap, -uv).rg -1.3) * intensity;\n            float flow_t0 = fract(timescale);\n            float flow_t1 = fract(timescale + .5);\n            float alternate = abs((flow_t0 -.5) * 10.);\n\n            vec4 samp0 = texture2D(textureSampler, uv + flow_t0); \n            vec4 samp1 = texture2D(textureSampler, uv - flow_t1); \n            vec4 Flow = mix(samp0, samp1, alternate);\n            gl_FragColor = vec4(1.,Flow.g,1.,1.);\n        }\n        `\n        let texture = new BABYLON.CustomProceduralTexture(uid+\"DistortionFlowDt\", uid+\"DistortionFlow\", res || 256, scene, false, false)\n        texture.wrapU = texture.wrapV = 1;  \n        texture.refreshRate = 3;        \n\n        texture.onGeneratedObservable.add(()=>{           \n            texture.setFloat('uTime', texture._time)\n        })\n\n        texture.setFloat('uTime', 0); //Must do this or it wont update later on Genderated. \n        //waveTexture.uAng = Math.PI/2;\n        //waveTexture.wAng = Math.PI/2;\n        var waveNoiseTexture = new BABYLON.Texture(\"https://raw.githubusercontent.com/kristosb/assets/main/WavesDt.png\");\n\n        texture.setTexture('textureSampler', waveNoiseTexture);\n        texture.uScale = 1\n        texture.vScale = 1\n\n        return texture\n    }\n////////////\n    get scene(){\n        return this.params.scene\n    }\n\n    get res(){\n        return this.params.res\n    }\n\n}\n\n\nBABYLON.Effect.ShadersStore['height2NormalPixelShader']  =\n`varying vec2 vUV;\nuniform vec2 resolution;\nuniform sampler2D textureSampler;\n\nvoid main(){\n    vec2 unit = vec2(1.0)/resolution*2.;\n    float x = ((texture2D(textureSampler, vUV+(unit*vec2(-1.,0.))).g-texture2D(textureSampler, vUV+(unit*vec2(1.,0.))).g)+1.)*0.5;\n    float y = ((texture2D(textureSampler, vUV+(unit*vec2(0.,1.))).g-texture2D(textureSampler, vUV+(unit*vec2(0.,-1.))).g)+1.)*0.5;\n    float a = 1.;//texture(textureSampler, vUV).r;\n\n#if defined(invertDepth)\n    \tgl_FragColor = vec4(x, y, 1.0, a);\n#else\n\tgl_FragColor = vec4(1.0-x, y, 1.0, a);\n#endif\n\n}`;\n\nfunction subjectMeshes(scene,wsize){\n    var cube = BABYLON.MeshBuilder.CreateBox(\"Cube\", {size:wsize/4}, scene);\n    cube.position.copyFromFloats(wsize/4, wsize/8, wsize/4);\n    var sphere = BABYLON.MeshBuilder.CreateSphere(\"Ball\", {diameter:wsize/4}, scene);\n    sphere.position.copyFromFloats(wsize/4, -2+ wsize/8, -wsize/4);\n    sphere.material = new BABYLON.SimpleMaterial(\"sp\",scene);\n    //sphere.material.wireframe = true;\n    //sphere.material.alpha = 0.9;\n    var torus = BABYLON.MeshBuilder.CreateTorus(\"Torus\", { thickness:wsize/10, diameter: wsize/4}, scene);\n    torus.position.copyFromFloats(-wsize/4, wsize/20, wsize/4);\n    var cylinder = BABYLON.MeshBuilder.CreateCylinder(\"Cyclinder\", {diameter:wsize/4}, scene);\n    cylinder.position.copyFromFloats(-wsize/4, 1, -wsize/4);\n}\n\nfunction createGui(camWaterMask, wsize){\n    var displayFValue = function(value) {\n        return Math.floor(value * 10) / 10;\n    }\n    var frictionBox = function(value) {\n        camWaterMask.position.x = value\n        //console.log(\"value=\",value);\n    }\n    var advancedTexture = BABYLON.GUI.AdvancedDynamicTexture.CreateFullscreenUI(\"UI\");\n\n    var selectFrictionBox = new BABYLON.GUI.SelectionPanel(\"spi\");\n    selectFrictionBox.width = 0.25;\n    selectFrictionBox.height = 0.25;\n    selectFrictionBox.background = \"#1388AF\";\n    selectFrictionBox.horizontalAlignment = BABYLON.GUI.Control.HORIZONTAL_ALIGNMENT_LEFT;\n    selectFrictionBox.verticalAlignment = BABYLON.GUI.Control.VERTICAL_ALIGNMENT_BOTTOM;\n\n    advancedTexture.addControl(selectFrictionBox);\n\n    var frictionGroup = new BABYLON.GUI.SliderGroup(\"orth cam pos\", \"S\");\n\tfrictionGroup.addSlider(\"x\", frictionBox, \"units\", -wsize/20, wsize/20, 0, displayFValue);\n    selectFrictionBox.addGroup(frictionGroup);\n}\n\nfunction maskProjectionCam(scene, size){\n    var zdist = -10;\n    var cameraOrth = new BABYLON.FreeCamera(\"camWaterMask\", new BABYLON.Vector3(0, zdist, 0), scene);\n    cameraOrth.setTarget(BABYLON.Vector3.Zero());\n    var cameraZoom  = size/2; \n    cameraOrth.mode = BABYLON.Camera.ORTHOGRAPHIC_CAMERA;\n    cameraOrth.orthoTop = cameraZoom ;\n    cameraOrth.orthoBottom = -cameraZoom;\n    cameraOrth.orthoLeft = -cameraZoom ;\n    cameraOrth.orthoRight = cameraZoom ;\n    cameraOrth.minZ = -zdist-2;\n    cameraOrth.maxZ = -zdist+5;\n    return cameraOrth\n}\nfunction createMaskMaterial(scene, camWaterMask){\n    var depthMap = scene.enableDepthRenderer(camWaterMask).getDepthMap();\n    depthMap.scale(0.2);    //reduce resolution\n    const size = depthMap.getSize();\n    depthMap._refreshRate = 0;\n    console.log(size);\n    var groundMat = new BABYLON.StandardMaterial(\"waterOcclMask\", scene);\n    groundMat.diffuseTexture = depthMap;\n    groundMat.specularColor.copyFromFloats(0, 0, 0);\n\n    camWaterMask.dispose();\n    return groundMat;\n}","import * as BABYLON from 'babylonjs';\n\n/*export default function scene(shadowlight) {    \n    //var groundshadowGenerator = simpleShadowGenerator(shadowlight);\n    var groundshadowGenerator = cascadingShadowGenerator(shadowlight);\n\n    function ShadowGenerator(light, camera){\n        \n        //light.position = new BABYLON.Vector3(0, 1500, 0);\n        //light.diffuse = BABYLON.Color3.White();\n        //light.specular = new BABYLON.Color3(0.3, 0.3, 0.3);\n        //light.intensity = 1.0;\n\n        var shadowGeneratorDynamic = new BABYLON.ShadowGenerator(1024, light);\n        shadowGeneratorDynamic.usePercentageCloserFiltering = true;\n        shadowGeneratorDynamic.getShadowMap().renderList.push(torus);\n        return shadowGeneratorDynamic;\n    }\n    function updateOnce(){\n        //groundshadowGenerator.getShadowMap().refreshRate = BABYLON.RenderTargetTexture.REFRESHRATE_RENDER_ONCE;\n        //shadowlight.autoUpdateExtends = false;\n    }\n    function addMesh(mesh){\n        //groundshadowGenerator.getShadowMap().renderList.push(mesh);\n        //groundshadowGenerator.addShadowCaster(mesh);\n        //shadowGenerator.getShadowMap().renderList.push(torus);\n        //console.log(\"exist\",mesh);\n        groundshadowGenerator.getShadowMap().renderList.push(mesh);\n    }\n    return {\n        updateOnce,\n        addMesh\n    }\n}*/\n\nexport default function scene(shadowlight) {    \n    //var groundshadowGenerator = simpleShadowGenerator(shadowlight);\n    var groundshadowGenerator = cascadingShadowGenerator(shadowlight);\n\n    function simpleShadowGenerator(light){\n        var simpleShadows = new BABYLON.ShadowGenerator(1024, light);\n        //simpleShadows.getShadowMap().renderList.push(m1);\n        //simpleShadows.getShadowMap().renderList.push(m2);\n        simpleShadows.useBlurCloseExponentialShadowMap = true;\n        simpleShadows.getShadowMap().refreshRate = BABYLON.RenderTargetTexture.REFRESHRATE_RENDER_ONCE;\n        //light.autoUpdateExtends = true;\n        light.autoCalcShadowZBounds = true;\n        return simpleShadows;\n    }\n    function cascadingShadowGenerator(light, camera){\n        \n        light.position = new BABYLON.Vector3(0, 150, 0); //1500\n        //light.diffuse = BABYLON.Color3.White();\n        //light.specular = new BABYLON.Color3(0.3, 0.3, 0.3);\n        //light.intensity = 1.0;\n\n        var csmShadowGenerator = new BABYLON.CascadedShadowGenerator(1024, light);\n        //csmShadowGenerator.stabilizeCascades = true;\n        //csmShadowGenerator.forceBackFacesOnly = true;\n        //csmShadowGenerator.shadowMaxZ = 100;\n        //csmShadowGenerator.autoCalcDepthBounds = true;\n        //csmShadowGenerator.lambda = 0.5;\n        //csmShadowGenerator.depthClamp = true;\n        //csmShadowGenerator.penumbraDarkness = 0.8;\n        //csmShadowGenerator.usePercentageCloserFiltering = true;\n        //csmShadowGenerator.filteringQuality = BABYLON.ShadowGenerator.QUALITY_HIGH;\n        csmShadowGenerator.forceBackFacesOnly = true;\n        //csmShadowGenerator.numCascades = 2;\n        csmShadowGenerator.filteringQuality = BABYLON.ShadowGenerator.QUALITY_MEDIUM;\n\n        csmShadowGenerator.lambda = 1;     //0 -full lin, 1 full log\n        //csmShadowGenerator.shadowMaxZ = camera.maxZ;\n        csmShadowGenerator.shadowMaxZ = 500;\n        csmShadowGenerator.cascadeBlendPercentage = 0;\n        csmShadowGenerator.depthClamp = false;\n        csmShadowGenerator.splitFrustum();\n        //csmShadowGenerator.getShadowMap().refreshRate = BABYLON.RenderTargetTexture.REFRESHRATE_RENDER_ONEVERYTWOFRAMES;\n        //console.log(\"refresh\",csmShadowGenerator.getShadowMap().refreshRate);\n        return csmShadowGenerator;\n    }\n    function updateOnce(){\n        //groundshadowGenerator.getShadowMap().refreshRate = BABYLON.RenderTargetTexture.REFRESHRATE_RENDER_ONCE;\n        //shadowlight.autoUpdateExtends = false;\n    }\n    function addMesh(mesh){\n        //groundshadowGenerator.getShadowMap().renderList.push(mesh);\n        //groundshadowGenerator.addShadowCaster(mesh);\n        //shadowGenerator.getShadowMap().renderList.push(torus);\n        //console.log(\"exist\",mesh);\n        groundshadowGenerator.getShadowMap().renderList.push(mesh);\n    }\n    return {\n        updateOnce,\n        addMesh\n    }\n}\n\n\n","import * as BABYLON from 'babylonjs';\nimport * as CANNON from 'cannon';\n\nBABYLON.Mesh.prototype.getAbsoluteSize = function() {\n    if(!this.__size){\n        this.__size = BABYLON.Vector3.Zero();\n    }\n    let scaling = this.scaling;\n    //console.log(scaling);\n    let bounds = this.getBoundingInfo();\n    this.__size.x = Math.abs(bounds.minimum.x - bounds.maximum.x)*scaling.x;\n    this.__size.y = Math.abs(bounds.minimum.y - bounds.maximum.y)*scaling.y;\n    this.__size.z = Math.abs(bounds.minimum.z - bounds.maximum.z)*scaling.z;\n\n    return this.__size;\n};\n\n\n/**    \n     * Projects a point to a plane along a ray starting from the camera origin and directed towards the point. \n     * @param {BABYLON.Vector3} point      \n     * @param {BABYLON.Plane} plane\n     * @return {BABYLON.Vector3} The projection of the point p on the plane\n     */\n function projectOnPlane(point, plane) {        \n    let n = plane.normal;        \n    let d = plane.d;\n\n    let p0 = new BABYLON.Vector3().copyFrom(point);//camera.position;\n    \n    // ray direction\n    let V = new BABYLON.Vector3.Up();//point.subtract(p0).normalize();\n    let denom = BABYLON.Vector3.Dot(V, n);\n    \n    let t = -(BABYLON.Vector3.Dot(p0, n) + d)/denom;\n\n    // P = P0 + t*V\n    return p0.add(V.scale(t));\n}\n/**    \n     * Projects a point to a plane along a ray starting from the camera origin and directed towards the point. \n     * @param {BABYLON.Mesh} chassis      \n     * @param {BABYLON.Vector3[]} wheelPosition\n     * @return {BABYLON.Vector3[]} The projection of the point p on the plane\n     */\nfunction getWheelConnectionPoint(chassis, wheelPosition){\n    chassis.computeWorldMatrix(true); \n    //var norm = new BABYLON.Vector3(0,1,0);\n    //norm.rotateByQuaternionToRef(chassis.absoluteRotationQuaternion, norm);\n    //norm.normalize();\n    //var abstractPlane = BABYLON.Plane.FromPositionAndNormal(chassis.getAbsolutePosition(), norm);\n\n    var wheelsConnection = wheelPosition.map((pos,index)=>{\n        var con = new BABYLON.Vector3();\n        con.copyFrom(pos); //projectOnPlane(pos,abstractPlane);\n        con.subtractInPlace(chassis.getAbsolutePosition());\n        con.y = pos.y- chassis.getAbsolutePosition().y\n        return con;\n    });\n    return wheelsConnection;   \n}\n\nexport class CannonUtils {\n\n    static cannon2babylonVec3(cannonVector){\n        var babylonVector = new BABYLON.Vector3();\n        babylonVector.copyFromFloats(cannonVector.x, cannonVector.y, cannonVector.z);\n        return babylonVector;\n    }\n    static cannon2babylonQuat(cannonQuat){\n        const babylonQuat = new BABYLON.Quaternion(cannonQuat.x, cannonQuat.y, cannonQuat.z, cannonQuat.w );\n        //babylonQuat.copyFromFloats( cannonQuat.x, cannonQuat.y, cannonQuat.z, cannonQuat.w );\n        return babylonQuat;\n    }\n    static babylon2cannonVec3(babylonVector){\n        var cannonVector = new CANNON.Vec3(babylonVector.x, babylonVector.y, babylonVector.z);\n        return cannonVector; \n    }\n    static babylon2cannonQuat(babylonQuat){\n        var cannonQuat = new CANNON.Quaternion(babylonQuat.x, babylonQuat.y, babylonQuat.z, babylonQuat.w);\n        return cannonQuat;\n    }\n\n}","import * as BABYLON from 'babylonjs';\nimport * as CANNON from 'cannon';\nimport {CannonUtils} from './CannonUtils.js';\nimport {CarFromBoxesData, ThreeWheelCar} from './VehiclesData.js';\n\nexport default class Vehicle{\n    constructor(scene, carData){\n        this.scene = scene;\n        //this.physics = physics;\n        this.vehicle = null;\n        this.chassisBody = null;\n        //const carData = new ThreeWheelCar(scene);\n        this.carData = carData;\n        this.chassisMesh = carData.chassisMesh;\n        this.wheelMeshes = carData.wheelsMesh;\n        this.powerWheels = carData.powerWheelsIndex;\n        this.steeringwheels = carData.steeringWheelsIndex;\n        this.breakWheels = carData.brakeWheelsIndex;\n        this.carDataBody = carData.chassisBody;\n        this.carDataWheelBodies = carData.wheelBodies;\n        this.createVehicle();\n        \n    }\n    createVehicle(){\n        var world = this.scene.getPhysicsEngine().getPhysicsPlugin().world;\n        console.log(\"rotations\");\n        this.chassisBody = this.carDataBody;\n\n        var options = {\n            radius: 0.3,\n            directionLocal: new CANNON.Vec3(0, -1, 0),\n            suspensionStiffness: 150,\n            suspensionRestLength: 0.25,//04\n            frictionSlip: 5,\n            dampingRelaxation: 2.3,\n            dampingCompression: 4.5,\n            maxSuspensionForce: 200000,\n            rollInfluence:  0.01,\n            axleLocal: new CANNON.Vec3(-1, 0, 0),\n            chassisConnectionPointLocal: new CANNON.Vec3(1, 1, 0),\n            maxSuspensionTravel: 0.25,\n            customSlidingRotationalSpeed: -30,\n            useCustomSlidingRotationalSpeed: true,\n            };\n\n        // Create the vehicle\n        this.vehicle = new CANNON.RaycastVehicle({\n            chassisBody: this.chassisBody,\n\t\t\tindexUpAxis: 1,\n\t\t\tindexRightAxis: 0,\n\t\t\tindexForwardAxis: 2,\n        });\n\n        var that = this;\n    \n        /*this.wheelMeshes.forEach((wheelMesh, index)=>{\n        //this.carData.wheels.forEach((wheel, index)=>{\n            options.radius = 0.25;//0.5*wheelMesh.getAbsoluteSize().y;//y\n            var pos= new BABYLON.Vector3(\n                wheelMesh.getPositionExpressedInLocalSpace().x,\n                wheelMesh.getPositionExpressedInLocalSpace().y-that.chassisMesh.getAbsolutePosition().y,\n                wheelMesh.getPositionExpressedInLocalSpace().z\n                );\n            console.log(pos);\n            options.chassisConnectionPointLocal.copy(CannonUtils.babylon2cannonVec3( pos )); \n\n            that.vehicle.addWheel(options); \n        });*/\n        this.carData.wheels.forEach((wheel, index)=>{\n            options.radius = wheel.radius;\n            options.chassisConnectionPointLocal.copy(CannonUtils.babylon2cannonVec3( new BABYLON.Vector3(wheel.pos.x, wheel.pos.y, wheel.pos.z) )); \n            that.vehicle.addWheel(options); \n        });\n        this.vehicle.addToWorld(world);\n\n        this.scene.registerBeforeRender(function () {\n            for (var i = 0; i < that.vehicle.wheelInfos.length; i++) {\n                that.vehicle.updateWheelTransform(i);\n                var t = that.vehicle.wheelInfos[i].worldTransform; \n                \n                that.wheelMeshes[i].position.copyFrom( CannonUtils.cannon2babylonVec3(t.position) );\n                that.wheelMeshes[i].rotationQuaternion.copyFrom( CannonUtils.cannon2babylonQuat(t.quaternion) );\n            }\n        });\n\n    }\n\n\n    forward(force){\n        this.powerWheels.forEach(x=> this.vehicle.applyEngineForce(-force, x));\n    }\n    backward(force){\n        this.powerWheels.forEach(x=> this.vehicle.applyEngineForce(force, x));\n    }\n    right(force){\n        this.steeringwheels.forEach(x => this.vehicle.setSteeringValue(force, x));\n    }\n    left(force){\n        this.steeringwheels.forEach(x => this.vehicle.setSteeringValue(-force, x));\n    }\n    brake(force){\n        this.breakWheels.forEach(x => this.vehicle.setBrake(force, x));\n    }\n    unbrake(){\n        this.breakWheels.forEach(x => this.vehicle.setBrake(0, x));\n    }\n\n}","import * as BABYLON from 'babylonjs';\nimport * as YUKA from 'yuka';\nimport * as CANNON from 'cannon';\nimport { GridMaterial} from 'babylonjs-materials';\n\nexport default class BattleShip {\n    /**    \n     * Projects a point to a plane along a ray starting from the camera origin and directed towards the point. \n     * @param {BABYLON.Scene} scene      \n     * @param {BABYLON.Mesh} visualMesh \n     *    \n     */\n    constructor(scene, visualMesh,options){\n        options = options || {};\n        var initPosition = new BABYLON.Vector3(260, 4, 350);\n        this.vehicleMesh = BABYLON.MeshBuilder.CreateBox(\"yukaMesh\",{width:12, height:3, depth:54},scene);\n        var groundMat = new BABYLON.StandardMaterial(\"groundMat\", scene);\n        groundMat.specularColor = new BABYLON.Color3(0, 0, 0);\n        groundMat.diffuseColor = new BABYLON.Color3(0.29, 0.26, 0.26);\n        groundMat.backFaceCulling = false;\n        this.vehicleMesh.material = new GridMaterial(\"groundMaterial\", scene);//groundMat;\n        this.vehicleMesh.position.copyFrom(initPosition);\n        this.vehicleMesh.position.z +=14;\n        this.vehicleMesh.position.x -=4.3;\n        this.vehicleMesh.physicsImpostor = new BABYLON.PhysicsImpostor(this.vehicleMesh, BABYLON.PhysicsImpostor.BoxImpostor, { mass: 100000, friction: 1, restitution: 0.9 }, scene);\n        this.vehicleMesh.isVisible = false;\n        //console.log(this.vehicleMesh.physicsImpostor.physicsBody.angularVelocity);\n        this.entityManager = new YUKA.EntityManager();\n        this.time = new YUKA.Time();\n        this.vehicle = new YUKA.Vehicle();\n        this.vehicle.maxSpeed = 1;\n        this.vehicle.mass = 0.1;\n        //vehicle.maxSpeed = 2;\n        //vehicle.setRenderComponent(vehicleMesh, sync);\n        const path = new YUKA.Path();\n        path.loop = true;\n        path.add(new YUKA.Vector3(290, 0, 340));\n        path.add(new YUKA.Vector3(100, 0, 350));\n        path.add(new YUKA.Vector3(0, 0, 300));\n        path.add(new YUKA.Vector3(20, 0, 180));\n        path.add(new YUKA.Vector3(140, 0, 140));\n        path.add(new YUKA.Vector3(300, 0, 200));\n        \n        //path.add(new YUKA.Vector3(250, 0, 340));\n    \n        this.vehicle.position.copy(path.current());\n        this.vehicle.active = false;\n        const followPathBehavior = new YUKA.FollowPathBehavior(path, 0.5);\n        this.vehicle.steering.add(followPathBehavior);\n        this.onPathBehavior = new YUKA.OnPathBehavior(path);\n        this.vehicle.steering.add(this.onPathBehavior);\n        this.entityManager.add(this.vehicle);\n        \n        path._waypoints.push(path._waypoints[0]);\n\n        if(options.debug){\n        var lines = BABYLON.MeshBuilder.CreateLines('lines', {\n            points: path._waypoints,\n            updatable: true,\n        })\n        lines.color = BABYLON.Color3.Teal()\n        }\n        this.onPathBehavior.active = false;\n        //onPathBehavior.radius = 10;\n        this.entityManager.update(this.time.update().getDelta())\n        //console.log(this.vehicle.velocity);\n\n       // var visualMesh = BABYLON.MeshBuilder.CreateBox(\"battleshipMesh\",{width:10, height:20, depth:10},scene);\n        visualMesh.position.copyFrom(initPosition);\n        visualMesh.position.y +=3.37;\n        this.vehicleMesh.addChild(visualMesh);\n        this.vehicleMesh.rotate(new BABYLON.Vector3.Up(), -Math.PI/2);\n        this.altOffset = new BABYLON.Vector3(0,-2.3,0);\n        //console.log(\"q\",this.vehicleMesh.physicsImpostor.physicsBody.quaternion);\n        this.vehicle.rotation = new YUKA.Quaternion(this.vehicleMesh.rotationQuaternion.x,this.vehicleMesh.rotationQuaternion.y,this.vehicleMesh.rotationQuaternion.z,this.vehicleMesh.rotationQuaternion.w);\n    }\n    update(){\n        \n        const delta = this.time.update().getDelta();\n        //console.log(\"entity\", entityManager.entities[0].velocity);\n        this.entityManager.update(delta);\n        //var vy = vehicleMesh.physicsImpostor.physicsBody.velocity.y\n        var vy = -(this.vehicleMesh.position.y+this.altOffset.y);\n        var meshVelocity = new BABYLON.Vector3(this.vehicle.velocity.x,vy,this.vehicle.velocity.z);\n        //var meshVelocity = new BABYLON.Vector3(-1,vy,0);//this.vehicle.velocity.x,vy,this.vehicle.velocity.z)\n        this.vehicleMesh.physicsImpostor.setLinearVelocity(meshVelocity);\n        this.vehicleMesh.physicsImpostor.physicsBody.angularVelocity = new CANNON.Vec3(0,0,0);\n        \n        //var yukaRotation = this.vehicle.rotation;//.toEuler(new YUKA.Quaternion());\n        var rotC = new CANNON.Quaternion(this.vehicle.rotation.x, this.vehicle.rotation.y, this.vehicle.rotation.z,this.vehicle.rotation.w);\n        var rotE = new CANNON.Vec3();\n        var con = rotC.conjugate(); //find angle between quaternions\n        var rotated = con.mult(this.vehicleMesh.physicsImpostor.physicsBody.quaternion);    \n        var res = new CANNON.Vec3();\n        rotated.toEuler(res);\n        //console.log(\"rot\",res );\n        this.vehicleMesh.physicsImpostor.physicsBody.angularVelocity = new CANNON.Vec3(0,-res.y/10,0);\n        \n    }\n    set pause(val){\n        this.vehicle.active = val;\n    }\n    get pause(){\n        return this.vehicle.active;\n    }\n}\n","import * as BABYLON from 'babylonjs';\nimport * as YUKA from 'yuka';\nimport { GridMaterial} from 'babylonjs-materials';\nimport { createVehicle } from './ActorsShapes.js'\nconst inverse = new YUKA.Matrix4();\nconst localPositionOfLimitBox= new YUKA.Vector3();\nclass LimitBoxBehavior extends YUKA.SteeringBehavior {\n\n    constructor( limitBox ) {\n      super();\n      console.log(\"Limit Box\");\n      this.limitBox = limitBox;\n              /**\n          * This factor determines how much the vehicle decelerates if an intersection occurs.\n          * @type {Number}\n          * @default 0.2\n          */\n          this.brakingWeight = 0.2;\n  \n          /**\n          * Minimum length of the detection box used for intersection tests.\n          * @type {Number}\n          * @default 4\n          */\n          this.dBoxMinLength = 4; //\n    }\n      /**\n    * Calculates the steering force for a single simulation step.\n    *\n    * @param {YUKA.Vehicle} vehicle - The game entity the force is produced for.\n    * @param {YUKA.Vector3} force - The force/result vector.\n    * @param {Number} delta - The time delta.\n    * @return {YUKA.Vector3} The force/result vector.\n    */\n    calculate( vehicle, force /*, delta */ ) {\n        const limitBox = this.limitBox;\n        vehicle.worldMatrix.getInverse( inverse );\n        const dBoxLength = this.dBoxMinLength + ( vehicle.getSpeed() / vehicle.maxSpeed ) * this.dBoxMinLength;\n        // calculate this obstacle's position in local space of the vehicle\n        localPositionOfLimitBox.copy( limitBox.position ).applyMatrix4( inverse );\n        //console.log(localPositionOfLimitBox.length());\n        if ( localPositionOfLimitBox.z < 0 ){//&& Math.abs( localPositionOfObstacle.z ) < dBoxLength ) {\n          const expandedRadius = limitBox.boundingRadius;// + vehicle.boundingRadius;\n            var vehicleSphereDitsance = expandedRadius -localPositionOfLimitBox.length();\n            if ( vehicleSphereDitsance < 0) {\n              //console.log(intersectionPoint);\n              var multiplier = -vehicleSphereDitsance*20;\n              force.x = localPositionOfLimitBox.x * multiplier;\n              force.y = localPositionOfLimitBox.y * multiplier/10;\n              // apply a braking force proportional to the obstacles distance from the vehicle\n              force.z = -10*multiplier;//( limitBox.boundingRadius + localPositionOfLimitBox.z ) * this.brakingWeight;\n        \n              // finally, convert the steering vector from local to world space (just apply the rotation)\n              //console.log(force );\n              force.applyRotation( vehicle.rotation );\n              \n            }\n          }\n        //const vehicleOrientation = new YUKA.Vector3();\n        const speed = 6*(1.5+(vehicle.rotation.toEuler(new YUKA.Vector3()).x/ (Math.PI/4)));\n        //console.log(vehicle.rotation.toEuler(new YUKA.Vector3()).x,speed);\n        vehicle.maxSpeed = speed;\n        //if ( vehicle.rotation.toEuler(new YUKA.Vector3()).x > 0 ) vehicle.maxSpeed = 12; else vehicle.maxSpeed = 5;\n        return force;\n      }\n  \n    /**\n      * Transforms this instance into a JSON object.\n      *\n      * @return {Object} The JSON object.\n      */\n      toJSON() {\n  \n          const json = super.toJSON();\n  \n          json.brakingWeight = this.brakingWeight;\n          json.dBoxMinLength = this.dBoxMinLength;\n  \n  \n          return json;\n  \n      }\n  \n      /**\n      * Restores this instance from the given JSON object.\n      *\n      * @param {Object} json - The JSON object.\n      * @return {ObstacleAvoidanceBehavior} A reference to this behavior.\n      */\n      fromJSON( json ) {\n  \n          super.fromJSON( json );\n  \n          this.brakingWeight = json.brakingWeight;\n          this.dBoxMinLength = json.dBoxMinLength;\n  \n          return this;\n  \n      }\n  \n  }\n  \n/*const entityMatrix = new BABYLON.Matrix();\nfunction sync(entity, renderComponent) {\n    entity.worldMatrix.toArray(entityMatrix.m);\n    entityMatrix.markAsUpdated();\n    //console.log(\"sync\");\n    const matrix = renderComponent.getWorldMatrix();\n    matrix.copyFrom(entityMatrix);\n  }\n*/\n//var target = new YUKA.Vector3(0,0,0);\nexport default class Birds {\n    /**    \n     * Projects a point to a plane along a ray starting from the camera origin and directed towards the point. \n     * @param {BABYLON.Scene} scene      \n     *    \n     */\n    constructor(scene, meshes,options){\n        options = options || {};\n        this.entityMatrix = new BABYLON.Matrix();\n        this.entityManager = new YUKA.EntityManager();\n        this.time = new YUKA.Time();\n        var initPosition = new BABYLON.Vector3(150, 35, 240);\n        var limitBox = null;\n        limitBox = setupLimitBox(scene, 100, new BABYLON.Vector3(initPosition.x, initPosition.y+50, initPosition.z), options.debug);\n        this.entityManager.add(limitBox);\n        //console.log(\"bird\",mesh);\n        //const vehicleMeshPrefab = //createVehicle(scene, { size: 5 });\n        //vehicleMeshPrefab.setEnabled(false);\n        const alignmentBehavior = new YUKA.AlignmentBehavior();\n        const cohesionBehavior = new YUKA.CohesionBehavior();\n        const separationBehavior = new YUKA.SeparationBehavior();\n        \n        alignmentBehavior.weight = 1.9;\n        cohesionBehavior.weight = 2.5;\n        separationBehavior.weight = 0.15;\n        \n\n        this.enemy = new YUKA.Vector3();\n\n        //for (let i = 0; i < 1; i++) {\n        meshes.forEach( mesh =>{\n            const vehicleMesh =  mesh;//vehicleMeshPrefab.clone('bird_'+i.toString());\n            //vehicleMesh.setEnabled(true);\n            vehicleMesh.position.copyFrom(initPosition);\n\n            const vehicle = new YUKA.Vehicle();\n            vehicle.maxSpeed = 10;//13\n            vehicle.updateNeighborhood = true;\n            vehicle.neighborhoodRadius = 30;\n\n            \n            vehicle.setRenderComponent(vehicleMesh, sync);\n        \n            vehicle.boundingRadius = vehicleMesh.getBoundingInfo().boundingSphere.radius;\n            vehicle.smoother = new YUKA.Smoother(20);\n            vehicle.position = new YUKA.Vector3(initPosition.x, initPosition.y, initPosition.z);\n            vehicle.position.x = vehicle.position.x - Math.random() * 5;\n            vehicle.position.z = vehicle.position.z - Math.random() * 5;\n            vehicle.active = false;\n            \n            vehicle.steering.add(alignmentBehavior);\n            vehicle.steering.add(cohesionBehavior);\n            vehicle.steering.add(separationBehavior);\n\n            const wanderBehavior = new YUKA.WanderBehavior(1,5,5);\n            wanderBehavior.weight = 1.2;\n            vehicle.steering.add(wanderBehavior);\n\n            const LimitBehavior = new LimitBoxBehavior(limitBox);\n            vehicle.steering.add(LimitBehavior);\n\n            const fleeBehavior = new YUKA.FleeBehavior(this.enemy , 5);\n            fleeBehavior.weight = 5;\n            vehicle.steering.add(fleeBehavior);\n            this.entityManager.add(vehicle);\n        });\n        //vehicleMeshPrefab.setEnabled(false);\n    }\n\n    update(){\n        const delta = this.time.update().getDelta();\n        this.entityManager.update(delta);\n\n        //this.vehicleMesh.position = new BABYLON.Vector3(this.vehicle.position.x,this.vehicle.position.y,this.vehicle.position.z);\n        //this.vehicleMesh.rotationQuaternion = new BABYLON.Quaternion(this.vehicle.rotation.x, this.vehicle.rotation.y, this.vehicle.rotation.z,this.vehicle.rotation.w);\n    }\n    set pause(val){\n        this.entityManager.entities.forEach(x=>x.active = val);\n        //this.vehicle.active = val;\n    }\n    get pause(){\n        return false;//this.vehicle.active;\n    }\n    set enemyPosition(pos){\n        this.enemy.copy( new YUKA.Vector3(pos.x, pos.y, pos.z));\n    }\n}\n\nfunction setupLimitBox(scene, size, pos, debug) {\n    const mesh1 = BABYLON.MeshBuilder.CreateBox('limitBox', { size: size }, scene)\n    \n    const meshMat = new BABYLON.StandardMaterial('meshMat', scene)\n    meshMat.disableLighting = true\n    meshMat.emissiveColor = BABYLON.Color3.Red()\n    meshMat.wireframe = true;\n  \n    mesh1.material = meshMat;\n    mesh1.position.copyFrom(pos);\n    mesh1.visibility = debug;\n    var limitBox = new YUKA.GameEntity();\n    limitBox.position.copy(mesh1.position);\n    limitBox.boundingRadius = mesh1.getBoundingInfo().boundingSphere.radius * 1;\n    return limitBox;\n  }\n\n\nYUKA.WanderBehavior.prototype.calculate = function(vehicle, force, delta ) {\n\n    // this behavior is dependent on the update rate, so this line must be\n    // included when using time independent frame rate\n    const targetWorld = new YUKA.Vector3();\n    const jitterThisTimeSlice = this.jitter * delta;\n  \n    // prepare random vector\n    const randomDisplacement = new YUKA.Vector3();\n    randomDisplacement.x = YUKA.MathUtils.randFloat( - 1, 1 ) * jitterThisTimeSlice;\n    randomDisplacement.y = YUKA.MathUtils.randFloat( - 1, 1 ) * jitterThisTimeSlice/10;\n    randomDisplacement.z = YUKA.MathUtils.randFloat( - 1, 1 ) * jitterThisTimeSlice;\n    // add random vector to the target's position\n  \n    this._targetLocal.add( randomDisplacement );\n  \n    // re-project this new vector back onto a unit sphere\n  \n    this._targetLocal.normalize();\n  \n    // increase the length of the vector to the same as the radius of the wander sphere\n  \n    this._targetLocal.multiplyScalar( this.radius );\n  \n    // move the target into a position wanderDist in front of the agent\n  \n    targetWorld.copy( this._targetLocal );\n    targetWorld.z += this.distance;\n  \n    // project the target into world space\n  \n    targetWorld.applyMatrix4( vehicle.worldMatrix );\n  \n    // and steer towards it\n  \n    force.subVectors( targetWorld, vehicle.position );\n  \n    return force;\n  \n  }\n  function sync(entity, renderComponent) {\n    renderComponent.position = new BABYLON.Vector3(entity.position.x,entity.position.y,entity.position.z);\n    renderComponent.rotationQuaternion = new BABYLON.Quaternion(entity.rotation.x, entity.rotation.y, entity.rotation.z,entity.rotation.w);\n  }","//import * as BABYLON from \"@babylonjs/core\";\nimport * as BABYLON from 'babylonjs';\nimport 'babylonjs-loaders';\n//import 'babylonjs-materials';\n//import { ShadowOnlyMaterial } from \"babylonjs-materials\";\nimport * as Ammo from 'ammojs';\n//import * as CANNON from './cannon.js';\nimport * as CANNON from 'cannon';\n//import * as YUKA from 'yuka';\n\nimport SceneSubject from './SceneSubject';\nimport Airplane from './Airplane';\n//import { CarFromBoxesData, ThreeWheelCar } from './VehiclesData';\n//import VehicleAmmo from './VehicleAmmo';\nimport { AirplaneChassis, AirplaneFromMesh, AirplaneWW2} from './VehiclesData.js';\nimport DebugUI from './DebugUI.js';\nimport HudPanel from './Hud';\nimport {Clock} from './Clock';\nimport SkySim from './SkySimulator.js';\nimport OceanSim from './OceanSimulator.js';\nimport ShadowManager from './sahdowManager';\nimport Inspector from './instrumentation';\nimport Suspension from './Vehicle';\nimport Battleship from './BattleShip';\nimport Birds from './Birds';\nimport { createVehicle } from './ActorsShapes.js'\n\nconst DIR = {UP:1, DOWN:2,LEFT:3, RIGHT:4,  TILT_LEFT:5, TILT_RIGHT:6, BRAKE:7, LEFT_RESET:8, RIGHT_RESET:9, POWER_UP:10, POWER_DOWN:11, LEFT_HOLD:12, RIGHT_HOLD:13, UNBRAKE:14};\nclass vehicleParts{\n    constructor(){\n        this.bluePrint = null;\n        this.suspension = null;\n        this.avionics = null;\n        this.hud = null;\n        this.clock = new Clock();\n    }\n    set position(pos){\n        this.bluePrint.chassisMesh.setAbsolutePosition(pos);\n    }\n    get position(){\n        return this.bluePrint.chassisMesh.position;\n    }\n    get ready(){\n        return this.suspension!==null\n    }\n    \n    steer(dir){\n        switch(dir){\n            case DIR.UP:\n                //console.log(\"up\");\n                this.avionics.pitch = -1;\n                break;\n            case DIR.DOWN:\n                //console.log(\"up\");\n                this.avionics.pitch = 1;\n                break;\n            case DIR.LEFT:\n                //console.log(\"left\");\n                this.avionics.yaw = -1;\n                this.suspension.left(0.5);\n                break;\n            case DIR.RIGHT:\n                //console.log(\"right\");\n                this.avionics.yaw = 1;\n                this.suspension.right(0.5);\n                break;\n            case DIR.LEFT_RESET:\n                //console.log(\"left reset\");\n                this.suspension.left(0);\n                break;\n            case DIR.RIGHT_RESET:\n                //console.log(\"right reset\");\n                this.suspension.right(0);\n                break;\n            case DIR.LEFT_HOLD:\n                //console.log(\"left hold\");\n                this.avionics.yaw = -1;\n                break;\n            case DIR.RIGHT_HOLD:\n                //console.log(\"right hold\");\n                this.avionics.yaw = 1;\n                break;\n            case DIR.TILT_LEFT:\n                //console.log(\"tilt left\");\n                this.avionics.roll = -1;\n                break;\n            case DIR.TILT_RIGHT:\n                //console.log(\"tilt right\");\n                this.avionics.roll = 1;\n                break;\n            default:\n                console.log(\"vehicle invalid direction\");\n        }\n    }\n    power(val){\n        switch(val){\n            case DIR.POWER_UP:\n                //console.log(\"power up\");\n                this.avionics.enginePower = this.avionics.enginePower + 0.005;\n                this.avionics.speedModifier = 0.12;\n                break;\n            case DIR.POWER_DOWN:\n                //console.log(\"power down\");\n                this.avionics.enginePower = this.avionics.enginePower - 0.005;\n                break;\n            default:\n                console.log(\"vehicle invalid power\");\n        }\n    }\n    brake(val){\n        switch(val){\n            case DIR.BRAKE:\n                this.suspension.brake(5);\n                break;\n            case DIR.UNBRAKE:\n                this.suspension.unbrake();\n                break;\n            default:\n                console.log(\"vehicle invalid power\");\n        }\n    }\n\n    update(){\n        if(this.avionics!=null && this.hud!=null){ //console.error(\"airplane modlel mesh error\");\n            const elapsedTime = this.clock.getElapsedTime();\n            //console.log(elapsedTime);\n            this.hud.setRotation(new BABYLON.Vector3( 180 +BABYLON.Tools.ToDegrees(this.avionics.rotation.y),\n                                                -BABYLON.Tools.ToDegrees(this.avionics.rotation.x),\n                                                BABYLON.Tools.ToDegrees(this.avionics.rotation.z)));\n            this.hud.setSpeed(this.avionics.velocity.z);\n            this.hud.setPower(this.avionics.enginePower);\n            this.hud.setAltitude(this.avionics.collision.position.y);\n            this.hud.update(elapsedTime);\n        }//else {console.log(\"nohud\")}\n\n    }\n}\n\nexport default function canvas(canvas)  {\n    var preserveSize = true;\n\n    const screenDimensions = {\n        width: canvas.width,\n        height: canvas.height\n    }\n    \n    const mousePosition = {\n        x: 0,\n        y: 0\n    }\n    //const clock = new Clock();\n    const engine = new BABYLON.Engine(canvas, true, {preserveDrawingBuffer: true, stencil: true});\n    engine.loadingUIText = \"Loading world and airplane...\";\n    engine.loadingUIBackgroundColor = \"Purple\";\n    const scene = buildScene();\n    //const debugUI = null;//new Inspector(engine);\n    var sceneLoaded = false;\n    const physics = buildGravity();\n    const physicsViewer = new BABYLON.PhysicsViewer(scene);\n    const camera = followCameraCreate();//buildCamera(screenDimensions);//\n    const lights = buildLight(scene);\n    const worldSize = 800;\n    // yuka\n    var nimitzCarrier = null;\n    var birdFlock = null;\n\n    const sky = new SkySim(scene, lights.sunLight, lights.ambientlight, camera, worldSize);\n    sky.makeClouds(worldSize);\n\n    camera.maxZ = worldSize*1.4;\n    var ocean = null;//new OceanSim(scene, worldSize);\n    var ground = null;\n    var groundShadow = null;\n    groundShadow = new ShadowManager(lights.sunLight);\n    var inputMap = {};\n    const keys = [\"w\", \"s\", \"a\", \"d\", \"q\", \"e\", \"p\", \"o\", \"m\", \"n\", \"1\", \"2\", \"k\", \"b\"];\n    keys.forEach(key=>inputMap[key] = {type:false,keyState:\"up\"});\n\n    var assetsManager = new BABYLON.AssetsManager(scene);\n\n    /*assetsManager.addContainerTask = function (taskName, meshesNames, rootUrl, sceneFilename) {\n        var task = new ContainerAssetTask(taskName, meshesNames, rootUrl, sceneFilename);\n        this._tasks.push(task);\n        return task;\n    };*/\n\n    var meshWorldTask = assetsManager.addMeshTask(\"world task\", \"\", process.env.PUBLIC_URL+\"/assets//\", \"achil_2.glb\");\n    var meshAirplaneTask = assetsManager.addMeshTask(\"airplane\", \"\", process.env.PUBLIC_URL+\"/assets/\", \"airplane-ww2-collision-scaled.glb\");\n    var meshCarrierTask = assetsManager.addMeshTask(\"nimitz\", \"\", process.env.PUBLIC_URL+\"/assets/\", \"nimitz_single_mesh.glb\");\n    var meshBirdTask = assetsManager.addMeshTask(\"bird\", \"\", process.env.PUBLIC_URL+\"/assets/\", \"flying-gull.glb\");\n    //var meshBirdTask = assetsManager.addContainerTask(\"bird\", \"\", process.env.PUBLIC_URL+\"/assets/\", \"bird.glb\");\n    meshWorldTask.onSuccess = function (task) {   \n        var meshAll = task.loadedMeshes;\n        meshAll[0].removeChild(meshAll[1]);\n        const ground = meshAll[1]; \n        ground.setParent(null);  \n        meshAll[0].dispose(); \n        ground.scaling = ground.scaling.multiplyByFloats(8,8,8); \n        ground.position.y = -1.2;\n        ground.name = \"terrain\";\n        /*ground.physicsImpostor = new BABYLON.PhysicsImpostor(\n            ground, BABYLON.PhysicsImpostor.MeshImpostor, { mass: 0, restitution: 0.3 }, scene\n        );*/\n        \n        //optimization\n        ground.material.freeze();\n        ground.freezeWorldMatrix();\n        ground.doNotSyncBoundingInfo = true;\n        groundShadow.addMesh(ground);\n        ground.receiveShadows = true;\n        console.log(\"world finished\");\n        \n    }\n    var aircraft = new vehicleParts();\n\n    meshAirplaneTask.onSuccess = function (task) {\n        aircraft.bluePrint = new AirplaneWW2(scene, task.loadedMeshes, new BABYLON.Vector3(275, 6.5, 364),new BABYLON.Vector3(0,-Math.PI/2,0));\n        aircraft.suspension = new Suspension(scene, aircraft.bluePrint);\n        aircraft.avionics = new Airplane(scene, aircraft.bluePrint.chassisBody, aircraft.bluePrint.controls);\n        aircraft.hud = new HudPanel(scene, canvas);\n        aircraft.hud.linkWithMesh(aircraft.bluePrint.chassisMesh); \n        camera.lockedTarget =  aircraft.bluePrint.chassisMesh; \n        aircraft.position = new BABYLON.Vector3(-10,5.7,-5);\n        groundShadow.addMesh(aircraft.bluePrint.visualMeshes[0]);\n\n        console.log(\"airplane finished\");\n    }\n    meshCarrierTask.onSuccess = function (task) {\n        var nimitzMesh = task.loadedMeshes[0];\n        nimitzCarrier = new Battleship(scene,nimitzMesh);\n    }\n    meshBirdTask.onSuccess = function (task) {\n        const gullModel = task.loadedMeshes[0];\n        gullModel.scaling = new BABYLON.Vector3(0.015,0.015,0.015);\n        console.log(\"gull\",gullModel);\n        var birds = [];\n        //const vehicleMeshPrefab = createVehicle(scene, { size: 1 });\n        for (let i = 0; i < 10; i++){\n            const gull = gullModel.clone('gull_'+i.toString());\n            gull.setEnabled(true);\n            //let firstPlane = task.loadedContainer.instantiateModelsToScene(name => name + \"_\"+i.toString(), false);\n            //console.log(\"b\",firstPlane);\n            //firstPlane.rootNodes[0].scaling = new BABYLON.Vector3(0.02, 0.02, 0.02);\n            //firstPlane.animationGroups[0].start(true);      \n            //birds.push(firstPlane.rootNodes[0]);\n            //const birdMesh = vehicleMeshPrefab.clone('bird_'+i.toString());\n            birds.push(gull);\n        }\n        //camera.lockedTarget =  birds[0]; \n        birdFlock = new Birds(scene, birds);\n        gullModel.dispose();\n\n    }\n    assetsManager.onFinish= function (task){\n        registerActions(scene);\n        ocean = new OceanSim(scene, worldSize);\n        sceneLoaded = true;\n        console.log(\"manager finished\");\n    }\n    assetsManager.load();\n\n\n    function buildScene() {  \n        // Create a basic BJS Scene object\n        const scene = new BABYLON.Scene(engine);\n        return scene;\n    }\n    function buildLight(scene){\n        // Light\n        var sunLight = new BABYLON.DirectionalLight(\"light\", new BABYLON.Vector3(0.7, -0.3, 0.7), scene);\n        sunLight.position = new BABYLON.Vector3(50,100,100);//new BABYLON.Vector3(0, 50, 0);\n        sunLight.intensity = 2.3;\n        sunLight.setEnabled(true);   \n\n        var ambientlight = new BABYLON.HemisphericLight(\"ambient\", new BABYLON.Vector3(-0.7, 0.3, -0.7), scene);\n        ambientlight.position = new BABYLON.Vector3(0, 55, 5);\n        ambientlight.intensity =0.8;\n        ambientlight.diffuse = new BABYLON.Color3(0.96, 0.97, 0.93);\n        ambientlight.groundColor = new BABYLON.Color3(0.1, 0.1, 0.1);\n        ambientlight.setEnabled(true);\n\n        return {sunLight, ambientlight};\n    }\n\n    function buildGravity() {\n        var gravityVector = new BABYLON.Vector3(0,-9.81, 0);\n        //var physicsPlugin = new BABYLON.AmmoJSPlugin(undefined, Ammo, undefined);\n        //var physicsPlugin = new BABYLON.AmmoJSPlugin(false, Ammo, undefined);\n        //physicsPlugin.setTimeStep(16);\n        \n        //physicsPlugin.setTimeStep(1/10);\n        var physicsPlugin = new BABYLON.CannonJSPlugin(false,undefined,CANNON);\n        scene.enablePhysics(gravityVector, physicsPlugin);\n        var physicsEngine = scene.getPhysicsEngine();\n        scene.physicsEnabled = false;\n        //physicsEngine.setSubTimeStep(1);\n\n        return physicsPlugin;\n    }\n\n    function followCameraCreate(mesh){\n        var followCamera = new BABYLON.FollowCamera(\"followcamera\", new BABYLON.Vector3(0,0,-100), scene);\n        followCamera.heightOffset = 1;\n        //followCamera.rotationOffset = 180;\n        followCamera.cameraAcceleration = 0.05   ;//0.06 \n        followCamera.maxCameraSpeed = 1800;//1800\n        followCamera.inertia = 20.0;//20\n        followCamera.radius = -5;\n        //followCamera.lockedTarget = mesh;\n        followCamera.attachControl(canvas, false);\n        \n        scene.activeCamera = followCamera;\n        return followCamera;\n    }\n    function firstPersonCamera(mesh){\n        var targetCam = new BABYLON.TargetCamera(\"playerCamera\", new BABYLON.Vector3(0, 2, -5), scene);\n        targetCam.parent = mesh;\n        scene.activeCamera = targetCam;\n    }\n\n    function createSceneSubjects(scene) {\n        const sceneSubjects = new SceneSubject(scene);\n        return sceneSubjects;\n    }\n\n    function registerActions(scene){\n        // Keyboard events\n        scene.actionManager = new BABYLON.ActionManager(scene);\n        scene.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyDownTrigger, function (evt) {\n            if(inputMap[evt.sourceEvent.key]) inputMap[evt.sourceEvent.key].type=evt.sourceEvent.type === \"keydown\";// evt.sourceEvent.type == \"keydown\";//{key: evt.sourceEvent.type == \"keydown\", trigger:true};// +(evt.sourceEvent.type == \"keydown\")+(inputMap[evt.sourceEvent.key]==1);//\n        }));\n        scene.actionManager.registerAction(new BABYLON.ExecuteCodeAction(BABYLON.ActionManager.OnKeyUpTrigger, function (evt) {\n            if(inputMap[evt.sourceEvent.key]) inputMap[evt.sourceEvent.key].type= false;//if(inputMap[evt.sourceEvent.key]) inputMap[evt.sourceEvent.key] = {type:false,keyState:\"up\"};//+(evt.sourceEvent.type == \"keydown\");//-(inputMap[evt.sourceEvent.key]==1);//evt.sourceEvent.type == \"keydown\";//{key: evt.sourceEvent.type == \"keydown\", trigger:true};\n        }));\n\n    }\n    function actions(){\n        if(aircraft.ready){\n            keyAction(\"q\", ()=>aircraft.steer(DIR.TILT_LEFT));\n            keyAction(\"e\", ()=>aircraft.steer(DIR.TILT_RIGHT));\n            keyAction(\"w\", ()=>aircraft.steer(DIR.DOWN));\n            keyAction(\"s\", ()=>aircraft.steer(DIR.UP));\n            keyActionTrig(\"d\", ()=>aircraft.steer(DIR.LEFT),\n                               ()=>aircraft.steer(DIR.LEFT_RESET),\n                               ()=>aircraft.steer(DIR.LEFT_HOLD));\n            keyActionTrig(\"a\", ()=>aircraft.steer(DIR.RIGHT),\n                               ()=>aircraft.steer(DIR.RIGHT_RESET),\n                               ()=>aircraft.steer(DIR.RIGHT_HOLD));   \n            keyAction(\"m\", ()=>aircraft.power(DIR.POWER_UP));    \n            keyAction(\"n\", ()=>aircraft.power(DIR.POWER_DOWN));     \n            keyActionTrig(\"b\", ()=> aircraft.brake(DIR.BRAKE),\n                               ()=> aircraft.brake(DIR.UNBRAKE),\n                               ()=> aircraft.brake(DIR.BRAKE));   \n        }\n\n        keyActionTrig(\"o\", ()=> scene.debugLayer.show());\n        keyActionTrig(\"1\", ()=> {\n            sky.transitionSunInclination(0.025);\n            groundShadow.updateOnce();\n        });\n        keyActionTrig(\"2\",()=> {\n            sky.transitionSunInclination(-0.025);\n            groundShadow.updateOnce();\n        });\n        keyActionTrig(\"p\", ()=> {\n            scene.physicsEnabled = !scene.physicsEnabled;\n            nimitzCarrier.pause = scene.physicsEnabled;\n            birdFlock.pause = scene.physicsEnabled;\n        });\n        \n        //keyActionTrig(\"k\", ()=> console.log(\"down\"));//, x=>console.log(\"hold\"));\n            \n    }\n\n    function keyAction(key, onKeyFunc ){//= () => {}\n        if(inputMap[key].type) {\n            onKeyFunc();\n        }\n    }\n\n    function keyActionTrig(key, onKeyDownFunc = () => {},onKeyUpFunc = () => {}, onKeyHoldFunc = () => {} ){\n        if(inputMap[key].type) {\n            if(inputMap[key].keyState == \"up\") {\n                inputMap[key].keyState = \"down\"; \n                onKeyDownFunc();\n            }\n            else {\n                inputMap[key].keyState = \"hold\";\n                onKeyHoldFunc();\n            }\n        }else{\n            if(inputMap[key].keyState != \"up\") {\n                inputMap[key].keyState = \"up\";\n                onKeyUpFunc();\n            }\n            \n        }\n    \n    }\n\n    function update() {\n\n    }\n\n    function onWindowResize() {\n        engine.resize();\n    }\n\n    function animate(){\n        //assetsManager.onFinish = function (tasks) {\n            engine.runRenderLoop(function () {\n                if (sceneLoaded){\n                    actions();\n                    aircraft.update();\n                    nimitzCarrier.update();\n                    birdFlock.update();\n                    //console.log(aircraft.position);\n                    birdFlock.enemyPosition  = aircraft.position;\n                    //if (debugUI) debugUI.update();\n                    scene.render();\n                }\n            });\n        //}\n    }\n\n    function onMouseMove(x, y) {\n\n    }\n    return {\n        update,\n        onWindowResize,\n        onMouseMove,\n        animate\n    }\n}\n/*class ContainerAssetTask extends BABYLON.AbstractAssetTask{\n    constructor(\n        name,\n        meshesNames,\n        rootUrl,\n        sceneFilename) {\n        super(name);\n        this.name = name;\n        this.meshesNames = meshesNames;\n        this.rootUrl = rootUrl;\n        this.sceneFilename = sceneFilename;           \n    }\n    runTask(scene, onSuccess, onError) {\n        var _this = this;\n        BABYLON.SceneLoader.LoadAssetContainer(this.rootUrl, this.sceneFilename, scene, function (container) {\n            _this.loadedContainer = container;\n            _this.loadedMeshes = container.meshes;\n            _this.loadedParticleSystems = container.particleSystems;\n            _this.loadedSkeletons = container.skeletons;\n            _this.loadedAnimationGroups = container.animationGroups;\n            onSuccess();\n        }, null, function (scene, message, exception) {\n            onError(message, exception);\n        });\n    };\n\n}\nBABYLON.AssetsManager.prototype.addContainerTask = function (taskName, meshesNames, rootUrl, sceneFilename) {\n    var task = new ContainerAssetTask(taskName, meshesNames, rootUrl, sceneFilename);\n    this._tasks.push(task);\n    return task;\n};*/","import SceneManager from './SceneManager';\n\nexport default container => {\n    let canvasHalfWidth;\n    let canvasHalfHeight;\n    const canvas = createCanvas(document, container);\n    canvas.style.width = '100%';\n    canvas.style.height= '100%';\n    canvas.width  = canvas.offsetWidth;\n    canvas.height = canvas.offsetHeight;\n    const sceneManager = new SceneManager(canvas);\n    \n    bindEventListeners();\n    resizeCanvas();\n    sceneManager.animate();\n     \n    function createCanvas(document, container) {\n        const canvas = document.createElement(\"canvas\");    \n        container.appendChild(canvas);   \n        return canvas;\n    }\n\n    function bindEventListeners() {\n        window.onresize = resizeCanvas;\n        resizeCanvas();\t\n    }\n\n    function resizeCanvas() {        \n        canvas.style.width = '100%';\n        canvas.style.height= '100%';\n        canvas.width  = canvas.offsetWidth;\n        canvas.height = canvas.offsetHeight;\n\n        canvasHalfWidth = Math.round(canvas.offsetWidth/2);\n        canvasHalfHeight = Math.round(canvas.offsetHeight/2);\n\n        sceneManager.onWindowResize();\n    }\n\n}\n","import React, { Component } from 'react';\n\nimport threeEntryPoint from \"./babylonjs/babylonEntryPoint\"\nimport \"./viewer.css\"\n\nexport default class Viewer extends Component {\n    \n    componentDidMount() {\n        threeEntryPoint(this.threeRootElement);\n    }\n\n    render () {\n        return (\n            <div className=\"viewer-viewer\" ref={element => this.threeRootElement = element} />\n        );\n    }\n}","import './App.css';\nimport Viewer from './Components/Viewer/Viewer';\n\nfunction App() {\n  return (\n    <div className=\"App\">\n      <Viewer />\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n"],"sourceRoot":""}